<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StudyHub Pro ‚Äî Learning Dashboard</title>
<meta name="description" content="Personal learning dashboard for students. Study tools, AI tutor, focus music and academic resources.">
<meta name="keywords" content="study, homework, learning, education, academic, student tools">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   COVER SCREEN ‚Äî looks like a stuck loading page
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#cover {
  position: fixed;
  inset: 0;
  background: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 18px;
  z-index: 99999;
  font-family: 'Google Sans', Arial, sans-serif;
}

.cover-spinner {
  width: 48px;
  height: 48px;
  border: 4px solid #e0e0e0;
  border-top-color: #4285f4;
  border-radius: 50%;
  animation: cspin 0.9s linear infinite;
}
@keyframes cspin { to { transform: rotate(360deg); } }

.cover-text {
  font-size: 14px;
  color: #5f6368;
  letter-spacing: 0.2px;
}

/* Hidden password field ‚Äî type password on cover, nothing shows */
#coverPass {
  position: absolute;
  opacity: 0;
  pointer-events: none;
  width: 1px;
  height: 1px;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MAIN APP ‚Äî hidden until unlocked
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#app {
  display: none;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;
}

:root {
  --g: #00ff88;
  --b: #00cfff;
  --p: #ff00aa;
  --y: #ffcc00;
  --dark: #060910;
  --card: #0c1220;
  --card2: #0f1628;
  --border: rgba(0,255,136,0.15);
  --text: #a0b8cc;
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  background: var(--dark);
  font-family: 'Share Tech Mono', monospace;
  color: var(--text);
}

body::after {
  content:'';
  position:fixed;
  inset:0;
  background: repeating-linear-gradient(transparent,transparent 2px,rgba(0,0,0,0.1) 2px,rgba(0,0,0,0.1) 4px);
  pointer-events:none;
  z-index:9998;
  opacity:.3;
}
body::before {
  content:'';
  position:fixed;
  inset:0;
  background-image: linear-gradient(rgba(0,255,136,.02) 1px,transparent 1px),linear-gradient(90deg,rgba(0,255,136,.02) 1px,transparent 1px);
  background-size:44px 44px;
  pointer-events:none;
  z-index:0;
}

/* ‚îÄ‚îÄ NEON LOADING BAR ‚îÄ‚îÄ */
#neonLoader {
  position:fixed;
  top:0;left:0;
  height:3px;
  width:0%;
  background:linear-gradient(90deg,var(--g),var(--b),var(--p));
  box-shadow:0 0 12px var(--g),0 0 24px var(--b);
  z-index:99997;
  transition:width .3s ease,opacity .4s ease;
  pointer-events:none;
}
#neonLoader.done { width:100%!important; opacity:0; }

/* ‚îÄ‚îÄ NOTIFICATION TOAST ‚îÄ‚îÄ */
#toastContainer {
  position:fixed;
  bottom:24px;right:24px;
  display:flex;flex-direction:column;gap:10px;
  z-index:99996;
  pointer-events:none;
}
.toast {
  background:rgba(6,9,16,.95);
  border:1px solid var(--g);
  border-radius:6px;
  padding:12px 18px;
  font-family:'Share Tech Mono',monospace;
  font-size:.7rem;
  color:#c0d8ff;
  letter-spacing:1px;
  box-shadow:0 0 20px rgba(0,255,136,.2);
  animation:toastIn .3s ease,toastOut .3s ease 3.7s both;
  pointer-events:auto;
  max-width:280px;
  line-height:1.6;
}
@keyframes toastIn{from{opacity:0;transform:translateX(40px)}to{opacity:1;transform:translateX(0)}}
@keyframes toastOut{from{opacity:1;transform:translateX(0)}to{opacity:0;transform:translateX(40px)}}
.toast .toast-title{color:var(--g);font-family:'Orbitron',sans-serif;font-size:.6rem;letter-spacing:2px;margin-bottom:4px;}

/* ‚îÄ‚îÄ SPLASH SCREEN ‚îÄ‚îÄ */
#splashScreen {
  position:fixed;inset:0;
  background:var(--dark);
  z-index:99995;
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  gap:24px;
  opacity:1;
  transition:opacity .5s ease;
}
.splash-logo {
  font-family:'Orbitron',sans-serif;
  font-weight:900;
  font-size:clamp(2.5rem,8vw,5rem);
  letter-spacing:12px;
  color:var(--g);
  text-shadow:0 0 40px var(--g),0 0 80px rgba(0,255,136,.4);
  animation:splashPulse 1s ease-in-out infinite alternate;
}
@keyframes splashPulse{from{text-shadow:0 0 30px var(--g),0 0 60px rgba(0,255,136,.3)}to{text-shadow:0 0 60px var(--g),0 0 120px rgba(0,255,136,.6),0 0 200px rgba(0,255,136,.2)}}
.splash-logo span{color:var(--b);text-shadow:0 0 40px var(--b);}
.splash-sub{font-family:'Share Tech Mono',monospace;font-size:.8rem;color:#446688;letter-spacing:6px;text-transform:uppercase;}
.splash-bar-wrap{width:260px;height:3px;background:rgba(0,255,136,.1);border-radius:2px;overflow:hidden;}
.splash-bar{height:100%;width:0%;background:linear-gradient(90deg,var(--g),var(--b));border-radius:2px;box-shadow:0 0 10px var(--g);transition:width .05s linear;}
.splash-ver{font-family:'Share Tech Mono',monospace;font-size:.6rem;color:#223322;letter-spacing:3px;}

/* ‚îÄ‚îÄ MATRIX CANVAS ‚îÄ‚îÄ */
#matrixCanvas{position:fixed;inset:0;z-index:0;pointer-events:none;opacity:.18;}

/* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
#topbar {
  position:relative;
  z-index:100;
  display:flex;
  align-items:center;
  height:52px;
  background:rgba(6,9,16,.97);
  border-bottom:1px solid rgba(0,255,136,.12);
  flex-shrink:0;
}

.logo {
  font-family:'Orbitron',sans-serif;
  font-weight:900;
  font-size:1.1rem;
  letter-spacing:4px;
  color:var(--g);
  text-shadow:0 0 20px var(--g);
  padding:0 24px;
  white-space:nowrap;
  animation:flicker 6s infinite;
}
.logo span{color:var(--b);}
@keyframes flicker{0%,94%,100%{opacity:1}95%{opacity:.6}97%{opacity:.9}98%{opacity:.5}99%{opacity:1}}

#navtabs { display:flex; height:100%; flex:1; }

.navtab {
  display:flex; align-items:center; gap:7px;
  padding:0 20px;
  font-size:.72rem; letter-spacing:2px; text-transform:uppercase;
  color:#556677; cursor:pointer; border:none; background:none;
  font-family:'Share Tech Mono',monospace; height:100%;
  border-bottom:2px solid transparent; transition:all .2s; white-space:nowrap;
}
.navtab:hover { color:var(--g); background:rgba(0,255,136,.04); }
.navtab.active { color:var(--g); border-bottom-color:var(--g); background:rgba(0,255,136,.06); }

.badge-online {
  font-size:.6rem; letter-spacing:1px; color:var(--g);
  background:rgba(0,255,136,.1); border:1px solid rgba(0,255,136,.3);
  border-radius:2px; padding:4px 10px; white-space:nowrap; margin-right:16px;
}

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
#main { display:flex; flex:1; overflow:hidden; position:relative; z-index:1; }

.page { display:none; flex:1; overflow:hidden; flex-direction:column; }
.page.active { display:flex; }

/* ‚îÄ‚îÄ GAMES ‚îÄ‚îÄ */
#page-games { flex-direction:row; }
#gamesSidebar {
  width:155px; background:rgba(12,18,32,.8); border-right:1px solid var(--border);
  display:flex; flex-direction:column; gap:4px; padding:14px 8px; overflow-y:auto; flex-shrink:0;
}
.cat-pill {
  background:none; border:none; color:#446688; font-family:'Share Tech Mono',monospace;
  font-size:.63rem; letter-spacing:2px; text-transform:uppercase; padding:8px 10px;
  border-radius:3px; cursor:pointer; text-align:left; transition:all .2s;
}
.cat-pill:hover { color:var(--g); background:rgba(0,255,136,.06); }
.cat-pill.active { color:var(--g); background:rgba(0,255,136,.1); border-left:2px solid var(--g); }

#gamesMain { flex:1; overflow:hidden; display:flex; flex-direction:column; }

.games-back {
  display:none; align-items:center; gap:12px; padding:10px 16px;
  background:rgba(0,0,0,.5); border-bottom:1px solid var(--border);
}
.games-back button {
  background:none; border:1px solid rgba(255,0,170,.3); color:var(--p);
  padding:5px 14px; font-family:'Share Tech Mono',monospace; font-size:.65rem;
  letter-spacing:2px; border-radius:2px; cursor:pointer;
}
.games-back span { font-size:.75rem; color:#aaa; }

#searchBar {
  padding:12px 16px; border-bottom:1px solid var(--border); display:flex; gap:10px;
}
#gameSearch {
  flex:1; background:rgba(0,255,136,.04); border:1px solid var(--border);
  border-radius:3px; color:var(--g); font-family:'Share Tech Mono',monospace;
  font-size:.73rem; padding:8px 12px; outline:none; letter-spacing:1px;
}
#gameSearch::placeholder { color:#334455; }
#gameSearch:focus { border-color:var(--g); box-shadow:0 0 12px rgba(0,255,136,.12); }

#gamesContent { flex:1; overflow-y:auto; padding:18px; }
#gamesFrame { flex:1; border:none; width:100%; background:#000; display:none; }

.games-grid {
  display:grid; grid-template-columns:repeat(auto-fill,minmax(155px,1fr)); gap:13px;
}
.game-card {
  background:var(--card); border:1px solid rgba(0,255,136,.08); border-radius:6px;
  overflow:hidden; cursor:pointer; transition:transform .2s, border-color .2s, box-shadow .2s;
  position:relative;
}
.game-card:hover { transform:translateY(-4px) scale(1.02); border-color:var(--g); box-shadow:0 8px 30px rgba(0,255,136,.2),0 0 0 1px rgba(0,255,136,.1); }
.game-card::before {
  content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,rgba(0,255,136,.06),transparent,rgba(0,207,255,.06));
  opacity:0;transition:opacity .3s;pointer-events:none;z-index:1;
}
.game-card:hover::before{opacity:1;}
.game-thumb {
  width:100%; aspect-ratio:16/9; display:flex; align-items:center; justify-content:center;
  font-size:2rem; position:relative; overflow:hidden; background:linear-gradient(135deg,#0a1020,#060b18);
}
@keyframes screenShake{0%,100%{transform:translate(0)}10%{transform:translate(-4px,-2px)}20%{transform:translate(4px,2px)}30%{transform:translate(-3px,3px)}40%{transform:translate(3px,-3px)}50%{transform:translate(-2px,2px)}60%{transform:translate(2px,-1px)}70%{transform:translate(-1px,2px)}80%{transform:translate(1px,-2px)}90%{transform:translate(-1px,1px)}}
@keyframes flashIn{0%{opacity:0}50%{opacity:.6}100%{opacity:0}}
.shake{animation:screenShake .4s ease both;}
#flashOverlay{position:fixed;inset:0;background:#00ff88;pointer-events:none;z-index:9999;opacity:0;}
.game-thumb::after {
  content:'‚ñ∂ PLAY'; position:absolute; inset:0; background:rgba(0,255,136,.88);
  display:flex; align-items:center; justify-content:center; font-family:'Orbitron',sans-serif;
  font-size:.72rem; font-weight:900; color:#050810; letter-spacing:3px; opacity:0; transition:opacity .2s;
}
.game-card:hover .game-thumb::after { opacity:1; }
.game-info { padding:9px 11px; }
.game-name { font-family:'Orbitron',sans-serif; font-size:.6rem; font-weight:700; color:#c0d8ff; letter-spacing:1px; margin-bottom:3px; }
.game-meta { display:flex; justify-content:space-between; font-size:.57rem; color:#446688; }
.game-rating { color:#ffcc44; }

/* ‚îÄ‚îÄ NEON PULSE borders ‚îÄ‚îÄ */
@keyframes neonPulse {
  0%,100%{box-shadow:0 0 6px var(--g),0 0 12px rgba(0,255,136,.3),inset 0 0 6px rgba(0,255,136,.05)}
  50%{box-shadow:0 0 14px var(--g),0 0 28px rgba(0,255,136,.5),inset 0 0 14px rgba(0,255,136,.1)}
}
@keyframes neonPulseB {
  0%,100%{box-shadow:0 0 6px var(--b),0 0 12px rgba(0,207,255,.3)}
  50%{box-shadow:0 0 14px var(--b),0 0 28px rgba(0,207,255,.5)}
}
.game-card:hover { animation:neonPulse .9s ease-in-out infinite; }
.app-card:hover { animation:neonPulseB .9s ease-in-out infinite; }

/* ‚îÄ‚îÄ LOADING BAR ‚îÄ‚îÄ */
#neonBar {
  position:fixed; top:0; left:0; height:3px; width:0%;
  background:linear-gradient(to right,var(--g),var(--b),var(--p));
  box-shadow:0 0 10px var(--g),0 0 20px var(--b);
  z-index:99998; transition:width .3s ease; pointer-events:none;
  border-radius:0 3px 3px 0;
}
#neonBar::after {
  content:''; position:absolute; right:0; top:-4px;
  width:12px; height:12px; border-radius:50%;
  background:var(--b); box-shadow:0 0 14px var(--b),0 0 28px var(--b);
  animation:neonPulseB .4s ease-in-out infinite;
}

/* ‚îÄ‚îÄ TOAST NOTIFICATIONS ‚îÄ‚îÄ */
#toastContainer {
  position:fixed; bottom:24px; right:24px; z-index:99997;
  display:flex; flex-direction:column; gap:8px; pointer-events:none;
}
.toast {
  background:rgba(6,9,16,.97); border-radius:6px; padding:12px 18px;
  font-family:'Share Tech Mono',monospace; font-size:.68rem; letter-spacing:1px;
  color:#c0d8ff; pointer-events:auto; cursor:pointer;
  animation:toastIn .3s ease both;
  display:flex; align-items:center; gap:10px; min-width:220px;
  backdrop-filter:blur(12px);
}
.toast.green  { border:1px solid rgba(0,255,136,.4); box-shadow:0 0 18px rgba(0,255,136,.15); }
.toast.blue   { border:1px solid rgba(0,207,255,.4); box-shadow:0 0 18px rgba(0,207,255,.15); }
.toast.pink   { border:1px solid rgba(255,0,170,.4); box-shadow:0 0 18px rgba(255,0,170,.15); }
.toast.yellow { border:1px solid rgba(255,204,0,.4); box-shadow:0 0 18px rgba(255,204,0,.15); }
@keyframes toastIn {
  from{opacity:0;transform:translateX(40px) scale(.9)}
  to{opacity:1;transform:translateX(0) scale(1)}
}
@keyframes toastOut {
  from{opacity:1;transform:translateX(0) scale(1)}
  to{opacity:0;transform:translateX(40px) scale(.9)}
}

/* ‚îÄ‚îÄ PARTICLES CANVAS ‚îÄ‚îÄ */
#particleCanvas {
  position:fixed; inset:0; pointer-events:none; z-index:0; opacity:.55;
}

/* ‚îÄ‚îÄ CONFETTI CANVAS ‚îÄ‚îÄ */
#confettiCanvas {
  position:fixed; inset:0; pointer-events:none; z-index:9990;
}

/* ‚îÄ‚îÄ SPLASH SCREEN ‚îÄ‚îÄ */
#splashScreen {
  position:fixed; inset:0; z-index:99990;
  background:#060910;
  display:flex; flex-direction:column; align-items:center; justify-content:center; gap:14px;
}
.splash-logo {
  font-family:'Orbitron',sans-serif; font-weight:900; font-size:3.5rem;
  letter-spacing:12px; color:var(--g);
  text-shadow:0 0 30px var(--g),0 0 60px rgba(0,255,136,.5),0 0 120px rgba(0,255,136,.2);
  animation:splashPulse 1.2s ease-in-out infinite alternate;
}
.splash-logo span{color:var(--b);text-shadow:0 0 30px var(--b);}
@keyframes splashPulse{from{text-shadow:0 0 20px var(--g)}to{text-shadow:0 0 50px var(--g),0 0 100px rgba(0,255,136,.4)}}
.splash-sub {
  font-size:.75rem; letter-spacing:6px; color:#446688;
  animation:fadeIn 1s ease .5s both;
}
.splash-bar-wrap {
  width:280px; height:3px; background:rgba(255,255,255,.06);
  border-radius:3px; overflow:hidden; margin-top:20px;
  animation:fadeIn .5s ease .8s both;
}
.splash-bar-fill {
  height:100%; background:linear-gradient(to right,var(--g),var(--b));
  box-shadow:0 0 10px var(--g); border-radius:3px;
  animation:splashLoad 1.8s cubic-bezier(.4,0,.2,1) 1s both forwards;
  width:0%;
}
@keyframes splashLoad{to{width:100%}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.splash-scanline {
  position:absolute; inset:0; pointer-events:none;
  background:repeating-linear-gradient(transparent,transparent 3px,rgba(0,255,136,.03) 3px,rgba(0,255,136,.03) 4px);
}

/* ‚îÄ‚îÄ MUSIC ‚îÄ‚îÄ */
#page-music { flex-direction:row; }
#musicSidebar {
  width:235px; background:rgba(8,12,26,.9); border-right:1px solid rgba(0,207,255,.12);
  display:flex; flex-direction:column; overflow:hidden; flex-shrink:0;
}
.music-sidebar-header { padding:18px 14px 10px; font-family:'Orbitron',sans-serif; font-size:.63rem; color:var(--b); letter-spacing:3px; border-bottom:1px solid rgba(0,207,255,.1); }
#musicSearch {
  margin:10px; background:rgba(0,207,255,.05); border:1px solid rgba(0,207,255,.15);
  border-radius:3px; color:var(--b); font-family:'Share Tech Mono',monospace; font-size:.7rem;
  padding:8px 10px; outline:none; letter-spacing:1px; width:calc(100% - 20px);
}
#musicSearch::placeholder { color:#334455; }
#musicResults { flex:1; overflow-y:auto; padding:0 6px 6px; }
.music-result {
  display:flex; align-items:center; gap:9px; padding:8px 10px; border-radius:4px; cursor:pointer; transition:background .2s;
}
.music-result:hover { background:rgba(0,207,255,.08); }
.music-result.playing { background:rgba(0,207,255,.12); border-left:2px solid var(--b); }
.result-num { font-size:.58rem; color:#334455; width:14px; text-align:center; flex-shrink:0; }
.result-info { flex:1; overflow:hidden; }
.result-title { font-size:.66rem; color:#c0d8ff; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.result-artist { font-size:.58rem; color:#446688; }
.result-dur { font-size:.58rem; color:#446688; flex-shrink:0; }

#musicMain { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:space-between; padding:30px 30px 0; overflow:hidden; }

.now-playing-art {
  width:190px; height:190px; border-radius:8px; background:linear-gradient(135deg,#0a1020,#060b18);
  display:flex; align-items:center; justify-content:center; font-size:4rem;
  border:1px solid rgba(0,207,255,.2); box-shadow:0 0 50px rgba(0,207,255,.1),0 20px 50px rgba(0,0,0,.5);
  position:relative; overflow:hidden; flex-shrink:0;
}
.now-playing-art::before {
  content:''; position:absolute; inset:-100%;
  background:conic-gradient(from 0deg,transparent,rgba(0,207,255,.08),transparent,rgba(0,255,136,.05),transparent);
  animation:spinart 10s linear infinite;
}
@keyframes spinart{to{transform:rotate(360deg)}}
#nowArtwork { position:relative; z-index:1; }

.now-track-info { text-align:center; padding:16px 0; flex-shrink:0; }
.now-title { font-family:'Orbitron',sans-serif; font-size:.95rem; color:#fff; letter-spacing:2px; margin-bottom:5px; }
.now-artist { font-size:.72rem; color:#6688aa; letter-spacing:2px; }

#lyricsPanel { flex:1; overflow-y:auto; width:100%; max-width:480px; padding:0 0 16px; text-align:center; }
.lyric-placeholder { color:#334455; font-size:.72rem; letter-spacing:2px; margin-top:16px; }

#musicPlayer { width:100%; background:rgba(8,12,26,.95); border-top:1px solid rgba(0,207,255,.12); padding:14px 30px; flex-shrink:0; position:relative; }
.progress-wrap { display:flex; align-items:center; gap:10px; margin-bottom:10px; }
#progressBar { flex:1; height:4px; background:rgba(0,207,255,.15); border-radius:2px; cursor:pointer; }
#progressFill { height:100%; background:linear-gradient(to right,var(--g),var(--b)); border-radius:2px; width:0%; transition:width .5s linear; position:relative; }
#progressFill::after { content:''; position:absolute; right:-5px; top:-4px; width:11px; height:11px; background:var(--b); border-radius:50%; box-shadow:0 0 7px var(--b); }
.time-label { font-size:.58rem; color:#446688; width:34px; text-align:center; }
.waveform { display:flex; gap:3px; align-items:flex-end; height:20px; margin-left:10px; }
.wave-bar { width:3px; background:var(--b); border-radius:2px; animation:wv .7s ease-in-out infinite alternate; box-shadow:0 0 4px var(--b); }
.wave-bar:nth-child(1){animation-delay:0s;height:8px}.wave-bar:nth-child(2){animation-delay:.1s;height:14px}.wave-bar:nth-child(3){animation-delay:.2s;height:20px}.wave-bar:nth-child(4){animation-delay:.15s;height:12px}.wave-bar:nth-child(5){animation-delay:.05s;height:17px}.wave-bar:nth-child(6){animation-delay:.25s;height:8px}
@keyframes wv{from{transform:scaleY(.2)}to{transform:scaleY(1)}}
.waveform.paused .wave-bar{animation-play-state:paused}
.music-controls-row { display:flex; align-items:center; justify-content:center; gap:14px; }
.mc-btn { background:none; border:none; color:#446688; font-size:1.1rem; cursor:pointer; padding:6px; transition:color .2s,transform .1s; line-height:1; }
.mc-btn:hover { color:var(--b); transform:scale(1.15); }
.mc-btn.play { background:var(--b); color:#050810; width:42px; height:42px; border-radius:50%; font-size:.95rem; display:flex; align-items:center; justify-content:center; box-shadow:0 0 18px rgba(0,207,255,.4); }
.mc-btn.play:hover { transform:scale(1.08); color:#050810; opacity:.9; }
.vol-row { display:flex; align-items:center; gap:7px; position:absolute; right:30px; bottom:20px; }
.vol-row span { font-size:.63rem; color:#334455; }
input[type=range].vol { -webkit-appearance:none; width:65px; height:3px; background:rgba(0,207,255,.2); border-radius:2px; outline:none; }
input[type=range].vol::-webkit-slider-thumb { -webkit-appearance:none; width:10px; height:10px; background:var(--b); border-radius:50%; box-shadow:0 0 5px var(--b); cursor:pointer; }

/* ‚îÄ‚îÄ AI ‚îÄ‚îÄ */
#page-ai { flex-direction:row; }
.ai-sidebar { width:190px; background:rgba(12,18,32,.8); border-right:1px solid rgba(255,0,170,.1); padding:14px 8px; display:flex; flex-direction:column; gap:4px; flex-shrink:0; }
.ai-tool-btn { display:flex; align-items:center; gap:9px; background:none; border:none; color:#556677; font-family:'Share Tech Mono',monospace; font-size:.63rem; letter-spacing:1px; padding:9px 10px; border-radius:3px; cursor:pointer; text-align:left; transition:all .2s; }
.ai-tool-btn:hover { color:var(--p); background:rgba(255,0,170,.06); }
.ai-tool-btn.active { color:var(--p); background:rgba(255,0,170,.1); border-left:2px solid var(--p); }
#aiMain { flex:1; display:flex; flex-direction:column; overflow:hidden; }
.ai-tool-content { display:none; flex:1; flex-direction:column; overflow:hidden; }
.ai-tool-content.active { display:flex; }

#chatMessages { flex:1; overflow-y:auto; padding:18px; display:flex; flex-direction:column; gap:13px; }
.msg { display:flex; gap:11px; animation:fadeUp .3s ease; }
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.msg.user { flex-direction:row-reverse; }
.msg-avatar { width:30px; height:30px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:.85rem; flex-shrink:0; }
.msg.ai .msg-avatar { background:rgba(255,0,170,.15); border:1px solid rgba(255,0,170,.3); }
.msg.user .msg-avatar { background:rgba(0,255,136,.15); border:1px solid rgba(0,255,136,.3); }
.msg-bubble { max-width:70%; padding:11px 14px; border-radius:6px; font-size:.73rem; line-height:1.7; letter-spacing:.4px; }
.msg.ai .msg-bubble { background:rgba(255,0,170,.06); border:1px solid rgba(255,0,170,.12); color:#c0c8dd; }
.msg.user .msg-bubble { background:rgba(0,255,136,.06); border:1px solid rgba(0,255,136,.12); color:#c0ddc0; text-align:right; }

.chat-input-row { display:flex; padding:14px; border-top:1px solid rgba(255,0,170,.1); }
.chat-input-row input { flex:1; background:rgba(255,0,170,.04); border:1px solid rgba(255,0,170,.18); border-right:none; border-radius:3px 0 0 3px; color:#c0d8ff; font-family:'Share Tech Mono',monospace; font-size:.73rem; padding:11px 14px; outline:none; letter-spacing:1px; }
.chat-input-row button { background:var(--p); border:none; color:#fff; padding:11px 18px; font-family:'Orbitron',monospace; font-size:.63rem; font-weight:700; letter-spacing:2px; border-radius:0 3px 3px 0; cursor:pointer; }

.imggen-wrap { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:18px; padding:30px; }
.imggen-wrap h2 { font-family:'Orbitron',sans-serif; font-size:.95rem; color:var(--p); letter-spacing:3px; }
.imggen-input-row { display:flex; width:100%; max-width:560px; }
.imggen-input-row input { flex:1; background:rgba(255,0,170,.04); border:1px solid rgba(255,0,170,.2); border-right:none; border-radius:3px 0 0 3px; color:#c0d8ff; font-family:'Share Tech Mono',monospace; font-size:.73rem; padding:11px 14px; outline:none; }
.imggen-input-row button { background:var(--p); border:none; color:#fff; padding:11px 18px; font-family:'Orbitron',monospace; font-size:.63rem; font-weight:700; letter-spacing:2px; border-radius:0 3px 3px 0; cursor:pointer; }
#imgOutput { width:100%; max-width:380px; aspect-ratio:1; background:rgba(255,0,170,.04); border:1px dashed rgba(255,0,170,.2); border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:.73rem; color:#446688; text-align:center; flex-direction:column; gap:8px; overflow:hidden; }
#imgOutput img { width:100%; height:100%; object-fit:cover; border-radius:8px; }

/* ‚îÄ‚îÄ APPS ‚îÄ‚îÄ */
#page-apps { flex-direction:column; overflow-y:auto; }
.apps-header { padding:24px 26px 16px; font-family:'Orbitron',sans-serif; font-size:.68rem; color:#446688; letter-spacing:4px; border-bottom:1px solid var(--border); display:flex; align-items:center; gap:14px; }
.apps-header::after { content:''; flex:1; height:1px; background:linear-gradient(to right,var(--border),transparent); }
.apps-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(170px,1fr)); gap:14px; padding:20px 26px; }
.app-card { background:var(--card2); border:1px solid rgba(0,207,255,.08); border-radius:8px; padding:18px 14px; cursor:pointer; transition:all .2s; display:flex; flex-direction:column; gap:9px; text-decoration:none; }
.app-card:hover { border-color:var(--b); box-shadow:0 4px 18px rgba(0,207,255,.12); transform:translateY(-2px); }
.app-card.featured { border-color:rgba(255,204,0,.3); background:rgba(255,204,0,.04); box-shadow:0 0 20px rgba(255,204,0,.08); }
.app-card.featured:hover { border-color:var(--y); box-shadow:0 4px 24px rgba(255,204,0,.2); }
.app-icon { font-size:1.8rem; }
.app-name { font-family:'Orbitron',sans-serif; font-size:.63rem; color:#c0d8ff; letter-spacing:1px; }
.app-desc { font-size:.58rem; color:#446688; line-height:1.6; }
.app-tag { display:inline-block; font-size:.53rem; letter-spacing:2px; padding:3px 7px; border-radius:2px; margin-top:auto; }
.app-tag.free { background:rgba(0,255,136,.1); color:var(--g); border:1px solid rgba(0,255,136,.2); }
.app-tag.proxy { background:rgba(0,207,255,.1); color:var(--b); border:1px solid rgba(0,207,255,.2); }
.app-tag.unblock { background:rgba(255,204,0,.12); color:var(--y); border:1px solid rgba(255,204,0,.3); }
.app-tag.blocked { background:rgba(0,207,255,.08); color:var(--b); border:1px solid rgba(0,207,255,.2); }

/* ‚îÄ‚îÄ GAMES built-in ‚îÄ‚îÄ */
#page-builtin { flex-direction:column; overflow:hidden; }
#builtinFrame { flex:1; border:none; width:100%; }

/* scrollbars */
::-webkit-scrollbar{width:4px;height:4px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:rgba(0,255,136,.2);border-radius:3px}

.spinner { width:18px; height:18px; border:2px solid rgba(0,207,255,.2); border-top-color:var(--b); border-radius:50%; animation:cspin .8s linear infinite; display:inline-block; }
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     COVER SCREEN
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="cover">
  <div style="display:flex;flex-direction:column;align-items:center;width:100%;min-height:100vh;background:#fff;justify-content:space-between;padding:28px 0 16px;">

    <!-- Google logo top left -->
    <div style="width:100%;padding:0 24px;display:flex;align-items:center;">
      <svg width="74" height="24" viewBox="0 0 74 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.24 8.19v2.46h5.88c-.18 1.38-.64 2.39-1.34 3.1-.86.86-2.2 1.8-4.54 1.8-3.62 0-6.45-2.92-6.45-6.54s2.83-6.54 6.45-6.54c1.95 0 3.38.77 4.43 1.76L15.4 2.5C13.86 1.05 11.8 0 9.24 0 4.28 0 .11 4.04.11 9s4.17 9 9.13 9c2.68 0 4.7-.88 6.28-2.52 1.62-1.62 2.13-3.91 2.13-5.75 0-.57-.04-1.1-.13-1.54H9.24z" fill="#4285F4"/><path d="M25 6.19c-3.21 0-5.83 2.44-5.83 5.81 0 3.34 2.62 5.81 5.83 5.81s5.83-2.46 5.83-5.81c0-3.37-2.62-5.81-5.83-5.81zm0 9.33c-1.76 0-3.28-1.45-3.28-3.52 0-2.09 1.52-3.52 3.28-3.52s3.28 1.43 3.28 3.52c0 2.07-1.52 3.52-3.28 3.52z" fill="#EA4335"/><path d="M53.58 7.49h-.09c-.57-.68-1.67-1.3-3.06-1.3C47.53 6.19 45 8.72 45 12c0 3.26 2.53 5.81 5.43 5.81 1.39 0 2.49-.62 3.06-1.32h.09v.81c0 2.22-1.19 3.41-3.1 3.41-1.56 0-2.53-1.12-2.93-2.07l-2.22.92c.64 1.54 2.33 3.43 5.15 3.43 2.99 0 5.52-1.76 5.52-6.05V6.49h-2.42v1zm-2.93 8.03c-1.76 0-3.1-1.5-3.1-3.52 0-2.05 1.34-3.52 3.1-3.52 1.74 0 3.1 1.5 3.1 3.54.01 2.03-1.36 3.5-3.1 3.5z" fill="#4285F4"/><path d="M38 6.19c-3.21 0-5.83 2.44-5.83 5.81 0 3.34 2.62 5.81 5.83 5.81s5.83-2.46 5.83-5.81c0-3.37-2.62-5.81-5.83-5.81zm0 9.33c-1.76 0-3.28-1.45-3.28-3.52 0-2.09 1.52-3.52 3.28-3.52s3.28 1.43 3.28 3.52c0 2.07-1.52 3.52-3.28 3.52z" fill="#FBBC05"/><path d="M58.77 1h2.55v16.8h-2.55z" fill="#34A853"/><path d="M63.81 12.18c-.06-3.77 2.93-5.99 5.09-5.99 1.7 0 3.14.85 3.62 2.07l-8.71 3.92zm8.86 2.67c-.53 1.41-1.91 2.22-3.6 2.22-2.14 0-3.99-1.58-4.06-3.96l10.95-4.52-.37-.93c-.68-1.84-2.76-5.23-7.02-5.23-4.23 0-7.75 3.33-7.75 7.69 0 4.31 3.48 7.69 8.15 7.69 3.77 0 5.95-2.3 6.86-3.64l-2.16-1.32z" fill="#EA4335"/></svg>
    </div>

    <!-- Center card -->
    <div style="display:flex;flex-direction:column;align-items:center;width:100%;max-width:448px;padding:0 16px;">
      <!-- Avatar circle -->
      <div style="width:52px;height:52px;border-radius:50%;background:#4285f4;display:flex;align-items:center;justify-content:center;margin-bottom:16px;">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="#fff"><path d="M12 12c2.7 0 4.8-2.1 4.8-4.8S14.7 2.4 12 2.4 7.2 4.5 7.2 7.2 9.3 12 12 12zm0 2.4c-3.2 0-9.6 1.6-9.6 4.8v2.4h19.2v-2.4c0-3.2-6.4-4.8-9.6-4.8z"/></svg>
      </div>

      <div style="font-size:24px;font-weight:400;color:#202124;margin-bottom:8px;font-family:'Google Sans',Arial,sans-serif;">Welcome back</div>
      <div style="display:flex;align-items:center;gap:8px;background:#f1f3f4;border-radius:20px;padding:6px 14px;margin-bottom:28px;cursor:pointer;">
        <div style="width:20px;height:20px;border-radius:50%;background:#4285f4;display:flex;align-items:center;justify-content:center;"><svg width="12" height="12" viewBox="0 0 24 24" fill="#fff"><path d="M12 12c2.7 0 4.8-2.1 4.8-4.8S14.7 2.4 12 2.4 7.2 4.5 7.2 7.2 9.3 12 12 12zm0 2.4c-3.2 0-9.6 1.6-9.6 4.8v2.4h19.2v-2.4c0-3.2-6.4-4.8-9.6-4.8z"/></svg></div>
        <span style="font-size:14px;color:#202124;font-family:Arial,sans-serif;">student@gmail.com</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="#5f6368"><path d="M7 10l5 5 5-5z"/></svg>
      </div>

      <div style="font-size:16px;color:#202124;margin-bottom:6px;font-family:Arial,sans-serif;align-self:flex-start;">Enter your password</div>
      <div style="font-size:13px;color:#5f6368;margin-bottom:24px;align-self:flex-start;font-family:Arial,sans-serif;">to continue to Google</div>

      <!-- Password input ‚Äî THIS IS THE REAL ONE -->
      <div style="width:100%;position:relative;margin-bottom:8px;">
        <input id="coverPass" type="password" autocomplete="current-password" placeholder="Enter password"
          style="width:100%;padding:14px 48px 14px 16px;border:1px solid #dadce0;border-radius:4px;font-size:16px;color:#202124;font-family:Arial,sans-serif;outline:none;box-sizing:border-box;background:#fff;"
          onfocus="this.style.borderColor='#4285f4';this.style.boxShadow='0 0 0 2px rgba(66,133,244,0.2)'"
          onblur="this.style.borderColor='#dadce0';this.style.boxShadow='none'"
        >
        <div onclick="var i=document.getElementById('coverPass');i.type=i.type==='password'?'text':'password'" style="position:absolute;right:14px;top:50%;transform:translateY(-50%);cursor:pointer;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="#5f6368"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
        </div>
      </div>

      <div id="coverError" style="display:none;color:#d93025;font-size:12px;align-self:flex-start;margin-bottom:8px;font-family:Arial,sans-serif;">Wrong password. Try again.</div>

      <div style="font-size:13px;color:#4285f4;cursor:pointer;align-self:flex-start;margin-bottom:32px;font-family:Arial,sans-serif;">Forgot password?</div>

      <!-- Buttons row -->
      <div style="display:flex;justify-content:space-between;align-items:center;width:100%;">
        <button onclick="" style="background:none;border:none;color:#4285f4;font-size:14px;font-family:'Google Sans',Arial,sans-serif;font-weight:500;cursor:pointer;padding:10px 16px;border-radius:4px;">Create account</button>
        <button id="googleNextBtn" onclick="tryGoogleLogin()"
          style="background:#1a73e8;color:#fff;border:none;border-radius:4px;padding:10px 24px;font-size:14px;font-family:'Google Sans',Arial,sans-serif;font-weight:500;cursor:pointer;">
          Next
        </button>
      </div>
    </div>

    <!-- Footer -->
    <div style="display:flex;gap:24px;font-size:12px;color:#5f6368;font-family:Arial,sans-serif;">
      <span>English (United States)</span>
      <span>Help</span>
      <span>Privacy</span>
      <span>Terms</span>
    </div>

  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MAIN APP
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="app">

  <!-- MATRIX CANVAS -->
  <canvas id="matrixCanvas"></canvas>

  <!-- FLASH OVERLAY -->
  <div id="flashOverlay"></div>

  <!-- NEON LOADER BAR -->
  <div id="neonLoader"></div>

  <!-- TOAST CONTAINER -->
  <div id="toastContainer"></div>

  <!-- SPLASH SCREEN -->
  <div id="splashScreen">
    <div class="splash-logo">StudyHub<span>.</span>Pro</div>
    <div class="splash-sub">Learning Dashboard</div>
    <div class="splash-bar-wrap"><div class="splash-bar" id="splashBar"></div></div>
    <div class="splash-ver">v2.0 ¬∑ LOADING SYSTEMS</div>
  </div>

  <!-- PANIC OVERLAY -->
  <div id="panicOverlay" style="display:none;position:fixed;inset:0;z-index:99999;background:#fff;font-family:Arial,sans-serif;">
    <!-- content injected by JS -->
  </div>

  <!-- TOPBAR -->
  <div id="topbar">
    <div class="logo">StudyHub<span>.</span>Pro</div>
    <div id="navtabs">
      <button class="navtab active" onclick="switchPage('games',this)">üìã ACTIVITIES</button>
      <button class="navtab" onclick="switchPage('music',this)">üéµ FOCUS MUSIC</button>
      <button class="navtab" onclick="switchPage('ai',this)">ü§ñ TUTOR AI</button>
      <button class="navtab" onclick="switchPage('apps',this)">üìö RESOURCES</button>
      <button class="navtab" onclick="switchPage('settings',this)">‚öôÔ∏è SETTINGS</button>
      <button class="navtab" onclick="switchPage('chat',this)">üí¨ STUDY CHAT</button>
    </div>
    <div style="display:flex;align-items:center;gap:10px;padding-right:16px;">
      <div id="weatherBadge" style="font-size:.62rem;color:var(--b);letter-spacing:1px;display:none;background:rgba(0,207,255,.08);border:1px solid rgba(0,207,255,.2);border-radius:2px;padding:3px 10px;"></div>
      <div id="panicHint" style="font-size:.58rem;color:#334455;letter-spacing:1px;" title="Press Escape to hide">ESC = HIDE</div>
      <div class="badge-online">üü¢ UNLOCKED</div>
    </div>
  </div>

  <!-- MAIN -->
  <div id="main">

    <!-- GAMES -->
    <div class="page active" id="page-games">
      <div id="gamesMain">
        <div class="games-back" id="gamesBack">
          <button onclick="closeGameFrame()">‚Üê BACK</button>
          <span id="currentGameName"></span>
        </div>
        <div id="searchBar">
          <input id="gameSearch" type="text" placeholder="Search activities..." oninput="filterGames(this.value)">
        </div>
        <div id="gamesContent">
          <div class="games-grid" id="gamesGrid"></div>
        </div>
        <div id="gamesFrame" style="flex:1;border:none;width:100%;background:#000;display:none;position:relative;overflow:hidden;"></div>
      </div>
      <div id="gamesSidebar">
        <button class="cat-pill active" onclick="setGameCat(this,'all')">ALL</button>
        <button class="cat-pill" onclick="setGameCat(this,'action')">üìå FEATURED</button>
        <button class="cat-pill" onclick="setGameCat(this,'puzzle')">üß© PUZZLE</button>
        <button class="cat-pill" onclick="setGameCat(this,'racing')">üèéÔ∏è RACING</button>
        <button class="cat-pill" onclick="setGameCat(this,'shooter')">üéØ CHALLENGE</button>
        <button class="cat-pill" onclick="setGameCat(this,'sports')">‚öΩ SPORTS</button>
        <button class="cat-pill" onclick="setGameCat(this,'io')">üåê ONLINE</button>
        <button class="cat-pill" onclick="setGameCat(this,'classic')">üïπÔ∏è CLASSIC</button>
      </div>
    </div>

    <!-- MUSIC -->
    <div class="page" id="page-music">
      <iframe src="https://vapor.my/page/music/index.html" style="flex:1;border:none;width:100%;height:100%;" allow="autoplay; clipboard-write; fullscreen"></iframe>
    </div>

    <!-- AI -->
    <div class="page" id="page-ai">
      <div class="ai-sidebar">
        <button class="ai-tool-btn active" onclick="setAITool('chat',this)">üí¨ AI CHAT</button>
        <button class="ai-tool-btn" onclick="setAITool('imggen',this)">üé® IMAGE GEN</button>
        <button class="ai-tool-btn" onclick="setAITool('translate',this)">üåê TRANSLATE</button>
        <button class="ai-tool-btn" onclick="setAITool('summarize',this)">üìù SUMMARIZE</button>
      </div>
      <div id="aiMain">
        <!-- CHAT -->
        <div class="ai-tool-content active" id="aitool-chat">
          <div id="chatMessages"></div>
          <div class="chat-input-row">
            <input id="chatInput" type="text" placeholder="Ask the AI anything..." onkeydown="if(event.key==='Enter')sendChat()">
            <button onclick="sendChat()">SEND</button>
          </div>
        </div>
        <!-- IMAGE GEN -->
        <div class="ai-tool-content" id="aitool-imggen">
          <div class="imggen-wrap">
            <h2>üé® AI IMAGE GENERATOR</h2>
            <p style="font-size:.7rem;color:#446688;letter-spacing:1px;">Describe an image and AI will generate it</p>
            <div class="imggen-input-row">
              <input id="imgPrompt" type="text" placeholder="A neon cyberpunk city at night..." onkeydown="if(event.key==='Enter')generateImage()">
              <button onclick="generateImage()">GENERATE</button>
            </div>
            <div id="imgOutput">
              <span style="font-size:2rem;">üñºÔ∏è</span>
              <span>Your image will appear here</span>
            </div>
          </div>
        </div>
        <!-- TRANSLATE -->
        <div class="ai-tool-content" id="aitool-translate">
          <div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;padding:30px;">
            <h2 style="font-family:'Orbitron',sans-serif;font-size:.95rem;color:var(--p);letter-spacing:3px;">üåê TRANSLATOR</h2>
            <div style="display:flex;gap:10px;width:100%;max-width:680px;">
              <div style="flex:1;display:flex;flex-direction:column;gap:7px;">
                <select id="fromLang" style="background:rgba(255,0,170,.04);border:1px solid rgba(255,0,170,.2);color:var(--p);font-family:'Share Tech Mono',monospace;font-size:.63rem;padding:6px 10px;border-radius:3px;outline:none;">
                  <option value="auto">Auto Detect</option><option value="en">English</option><option value="es">Spanish</option>
                  <option value="fr">French</option><option value="de">German</option><option value="ja">Japanese</option>
                  <option value="zh">Chinese</option><option value="ar">Arabic</option><option value="pt">Portuguese</option>
                </select>
                <textarea id="translateIn" rows="8" placeholder="Enter text to translate..." style="flex:1;background:rgba(255,0,170,.04);border:1px solid rgba(255,0,170,.15);border-radius:4px;color:#c0d8ff;font-family:'Share Tech Mono',monospace;font-size:.73rem;padding:11px;outline:none;resize:none;line-height:1.7;width:100%;"></textarea>
              </div>
              <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;">
                <button onclick="doTranslate()" style="background:var(--p);border:none;color:#fff;padding:11px 14px;font-family:'Orbitron',monospace;font-size:.58rem;font-weight:700;letter-spacing:2px;border-radius:3px;cursor:pointer;">‚Üí</button>
              </div>
              <div style="flex:1;display:flex;flex-direction:column;gap:7px;">
                <select id="toLang" style="background:rgba(255,0,170,.04);border:1px solid rgba(255,0,170,.2);color:var(--p);font-family:'Share Tech Mono',monospace;font-size:.63rem;padding:6px 10px;border-radius:3px;outline:none;">
                  <option value="es">Spanish</option><option value="en">English</option><option value="fr">French</option>
                  <option value="de">German</option><option value="ja">Japanese</option><option value="zh">Chinese</option>
                  <option value="ar">Arabic</option><option value="pt">Portuguese</option>
                </select>
                <textarea id="translateOut" rows="8" readonly placeholder="Translation..." style="flex:1;background:rgba(0,0,0,.3);border:1px solid rgba(255,0,170,.1);border-radius:4px;color:var(--g);font-family:'Share Tech Mono',monospace;font-size:.73rem;padding:11px;outline:none;resize:none;line-height:1.7;width:100%;"></textarea>
              </div>
            </div>
          </div>
        </div>
        <!-- SUMMARIZE -->
        <div class="ai-tool-content" id="aitool-summarize">
          <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:14px;padding:30px;">
            <h2 style="font-family:'Orbitron',sans-serif;font-size:.95rem;color:var(--p);letter-spacing:3px;">üìù SUMMARIZER</h2>
            <textarea id="summarizeIn" rows="8" placeholder="Paste any long text here..." style="width:100%;max-width:680px;background:rgba(255,0,170,.04);border:1px solid rgba(255,0,170,.15);border-radius:4px;color:#c0d8ff;font-family:'Share Tech Mono',monospace;font-size:.73rem;padding:12px;outline:none;resize:none;line-height:1.7;"></textarea>
            <button onclick="doSummarize()" style="background:var(--p);border:none;color:#fff;padding:11px 26px;font-family:'Orbitron',monospace;font-size:.68rem;font-weight:700;letter-spacing:3px;border-radius:3px;cursor:pointer;">SUMMARIZE</button>
            <div id="summarizeOut" style="width:100%;max-width:680px;background:rgba(0,0,0,.3);border:1px solid rgba(0,255,136,.1);border-radius:4px;color:var(--g);font-family:'Share Tech Mono',monospace;font-size:.73rem;padding:12px;line-height:1.8;min-height:70px;"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- APPS -->
    <div class="page" id="page-apps">
      <div id="appsListView" style="display:flex;flex-direction:column;overflow-y:auto;">
        <div class="apps-header">STUDY RESOURCES</div>
        <div class="apps-grid" id="appsGrid"></div>
      </div>
      <div id="appViewer" style="display:none;flex:1;flex-direction:column;overflow:hidden;">
        <div style="display:flex;align-items:center;gap:12px;padding:10px 16px;background:rgba(0,0,0,.7);border-bottom:1px solid var(--border);flex-shrink:0;">
          <button onclick="closeAppViewer()" style="background:none;border:1px solid rgba(255,0,170,.3);color:var(--p);padding:5px 14px;font-family:'Share Tech Mono',monospace;font-size:.65rem;letter-spacing:2px;border-radius:2px;cursor:pointer;">‚Üê BACK</button>
          <span id="appViewerName" style="font-family:'Orbitron',sans-serif;font-size:.7rem;color:#c0d8ff;letter-spacing:2px;flex:1;"></span>
          <button onclick="openCurrentAppNewTab()" style="background:none;border:1px solid rgba(0,207,255,.3);color:var(--b);padding:5px 14px;font-family:'Share Tech Mono',monospace;font-size:.65rem;letter-spacing:2px;border-radius:2px;cursor:pointer;">‚Üó NEW TAB</button>
        </div>
        <div id="appBlockedMsg" style="display:none;align-items:center;justify-content:center;flex-direction:column;gap:16px;padding:40px;text-align:center;flex:1;">
          <div style="font-size:3rem;">üö´</div>
          <div style="font-family:'Orbitron',sans-serif;font-size:.9rem;color:var(--p);letter-spacing:3px;">CONTENT UNAVAILABLE</div>
          <div style="font-size:.73rem;color:#556677;letter-spacing:1px;max-width:420px;line-height:1.8;">This resource requires a different viewer. Try opening in a new tab.</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;">
            <button onclick="proxyIndex=0;showAppBlocked();document.getElementById('appBlockedMsg').style.display='none';document.getElementById('appFrame').style.display='block';loadInFrame(currentAppUrl);" style="background:rgba(0,255,136,.1);border:1px solid var(--g);color:var(--g);padding:10px 20px;font-family:'Orbitron',monospace;font-size:.63rem;font-weight:700;letter-spacing:2px;border-radius:3px;cursor:pointer;">üîÑ RETRY</button>
            <button onclick="openCurrentAppNewTab()" style="background:var(--b);border:none;color:#050810;padding:10px 20px;font-family:'Orbitron',monospace;font-size:.63rem;font-weight:700;letter-spacing:3px;border-radius:3px;cursor:pointer;">‚Üó NEW TAB</button>
          </div>
        </div>
        <iframe id="appFrame" style="flex:1;border:none;width:100%;background:#000;" allow="fullscreen *; autoplay *; clipboard-write *"></iframe>
      </div>
    </div>

    <!-- SETTINGS -->
    <div class="page" id="page-settings">
      <div style="overflow-y:auto;flex:1;padding:30px 40px;display:flex;flex-direction:column;gap:28px;max-width:700px;">

        <div style="font-family:'Orbitron',sans-serif;font-size:1rem;color:var(--g);letter-spacing:4px;text-shadow:0 0 20px var(--g);">‚öôÔ∏è SETTINGS</div>

        <!-- UNBLOCKER URL -->
        <div style="background:var(--card2);border:1px solid rgba(255,204,0,.2);border-radius:8px;padding:20px;">
          <div style="font-family:'Orbitron',sans-serif;font-size:.68rem;color:var(--y);letter-spacing:3px;margin-bottom:6px;">üîó RESOURCE URL</div>
          <div style="font-size:.65rem;color:#446688;letter-spacing:1px;margin-bottom:12px;">Change the resource portal link ‚Äî password required</div>
          <div style="display:flex;flex-direction:column;gap:8px;">
            <input id="settingUnblocker" type="text" value="https://outerspace.is-a.software/&" style="background:rgba(255,204,0,.04);border:1px solid rgba(255,204,0,.2);border-radius:3px;color:var(--y);font-family:'Share Tech Mono',monospace;font-size:.7rem;padding:10px 14px;outline:none;letter-spacing:1px;width:100%;" placeholder="New unblocker URL...">
            <div style="display:flex;gap:0;">
              <input id="unblockerPassInput" type="password" placeholder="Enter your password to save..." style="flex:1;background:rgba(255,204,0,.04);border:1px solid rgba(255,204,0,.2);border-right:none;border-radius:3px 0 0 3px;color:var(--y);font-family:'Share Tech Mono',monospace;font-size:.7rem;padding:10px 14px;outline:none;letter-spacing:2px;" onkeydown="if(event.key==='Enter')saveUnblocker()">
              <button onclick="saveUnblocker()" style="background:var(--y);border:none;color:#050810;padding:10px 18px;font-family:'Orbitron',monospace;font-size:.63rem;font-weight:700;letter-spacing:2px;border-radius:0 3px 3px 0;cursor:pointer;">SAVE</button>
            </div>
          </div>
          <div id="unblockerSaved" style="display:none;font-size:.63rem;color:var(--g);margin-top:8px;letter-spacing:1px;">‚úÖ Resource URL saved!</div>
          <div id="unblockerError" style="display:none;font-size:.63rem;color:var(--p);margin-top:8px;letter-spacing:1px;">‚ùå Wrong password ‚Äî only the admin can change this</div>
        </div>

        <!-- PASSWORD -->
        <div style="background:var(--card2);border:1px solid rgba(0,255,136,.15);border-radius:8px;padding:20px;">
          <div style="font-family:'Orbitron',sans-serif;font-size:.68rem;color:var(--g);letter-spacing:3px;margin-bottom:6px;">üîí CHANGE PASSWORD</div>
          <div style="font-size:.65rem;color:#446688;letter-spacing:1px;margin-bottom:12px;">Change the password for the loading screen</div>
          <div style="display:flex;flex-direction:column;gap:8px;">
            <input id="settingPassOld" type="password" placeholder="Current password" style="background:rgba(0,255,136,.04);border:1px solid rgba(0,255,136,.15);border-radius:3px;color:var(--g);font-family:'Share Tech Mono',monospace;font-size:.7rem;padding:10px 14px;outline:none;letter-spacing:2px;">
            <input id="settingPassNew" type="password" placeholder="New password" style="background:rgba(0,255,136,.04);border:1px solid rgba(0,255,136,.15);border-radius:3px;color:var(--g);font-family:'Share Tech Mono',monospace;font-size:.7rem;padding:10px 14px;outline:none;letter-spacing:2px;">
            <button onclick="savePassword()" style="background:var(--g);border:none;color:#050810;padding:10px 18px;font-family:'Orbitron',monospace;font-size:.63rem;font-weight:700;letter-spacing:2px;border-radius:3px;cursor:pointer;width:fit-content;">SAVE PASSWORD</button>
          </div>
          <div id="passSaved" style="display:none;font-size:.63rem;color:var(--g);margin-top:8px;letter-spacing:1px;">‚úÖ Password changed!</div>
          <div id="passError" style="display:none;font-size:.63rem;color:var(--p);margin-top:8px;letter-spacing:1px;">‚ùå Wrong current password</div>
        </div>

        <!-- THEME -->
        <div style="background:var(--card2);border:1px solid rgba(0,207,255,.15);border-radius:8px;padding:20px;">
          <div style="font-family:'Orbitron',sans-serif;font-size:.68rem;color:var(--b);letter-spacing:3px;margin-bottom:6px;">üé® THEME COLOR</div>
          <div style="font-size:.65rem;color:#446688;letter-spacing:1px;margin-bottom:14px;">Pick your accent color</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;">
            <div class="theme-btn" onclick="setTheme('#00ff88','#00cfff')" style="background:linear-gradient(135deg,#00ff88,#00cfff);width:44px;height:44px;border-radius:50%;cursor:pointer;border:2px solid #fff;box-shadow:0 0 12px #00ff88;" title="Green/Blue"></div>
            <div class="theme-btn" onclick="setTheme('#ff00aa','#ff6600')" style="background:linear-gradient(135deg,#ff00aa,#ff6600);width:44px;height:44px;border-radius:50%;cursor:pointer;border:2px solid transparent;" title="Pink/Orange"></div>
            <div class="theme-btn" onclick="setTheme('#a855f7','#ec4899')" style="background:linear-gradient(135deg,#a855f7,#ec4899);width:44px;height:44px;border-radius:50%;cursor:pointer;border:2px solid transparent;" title="Purple/Pink"></div>
            <div class="theme-btn" onclick="setTheme('#f59e0b','#ef4444')" style="background:linear-gradient(135deg,#f59e0b,#ef4444);width:44px;height:44px;border-radius:50%;cursor:pointer;border:2px solid transparent;" title="Amber/Red"></div>
            <div class="theme-btn" onclick="setTheme('#06b6d4','#3b82f6')" style="background:linear-gradient(135deg,#06b6d4,#3b82f6);width:44px;height:44px;border-radius:50%;cursor:pointer;border:2px solid transparent;" title="Cyan/Blue"></div>
            <div class="theme-btn" onclick="setTheme('#10b981','#14b8a6')" style="background:linear-gradient(135deg,#10b981,#14b8a6);width:44px;height:44px;border-radius:50%;cursor:pointer;border:2px solid transparent;" title="Emerald/Teal"></div>
          </div>
          <div id="themeSaved" style="display:none;font-size:.63rem;color:var(--g);margin-top:10px;letter-spacing:1px;">‚úÖ Theme applied!</div>
        </div>

        <!-- COVER SCREEN -->
        <div style="background:var(--card2);border:1px solid rgba(255,0,170,.15);border-radius:8px;padding:20px;">
          <div style="font-family:'Orbitron',sans-serif;font-size:.68rem;color:var(--p);letter-spacing:3px;margin-bottom:6px;">üé≠ COVER SCREEN</div>
          <div style="font-size:.65rem;color:#446688;letter-spacing:1px;margin-bottom:14px;">Choose what the page looks like before the password is entered</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button onclick="setCover('loading')" class="cover-opt active-cover" id="cover-loading" style="background:rgba(255,0,170,.08);border:1px solid rgba(255,0,170,.3);color:var(--p);padding:8px 16px;font-family:'Share Tech Mono',monospace;font-size:.63rem;letter-spacing:1px;border-radius:3px;cursor:pointer;">‚è≥ Loading Spinner</button>
            <button onclick="setCover('classroom')" class="cover-opt" id="cover-classroom" style="background:none;border:1px solid rgba(255,0,170,.15);color:#556677;padding:8px 16px;font-family:'Share Tech Mono',monospace;font-size:.63rem;letter-spacing:1px;border-radius:3px;cursor:pointer;">üìö Google Classroom</button>
            <button onclick="setCover('docs')" class="cover-opt" id="cover-docs" style="background:none;border:1px solid rgba(255,0,170,.15);color:#556677;padding:8px 16px;font-family:'Share Tech Mono',monospace;font-size:.63rem;letter-spacing:1px;border-radius:3px;cursor:pointer;">üìù Google Docs</button>
            <button onclick="setCover('blank')" class="cover-opt" id="cover-blank" style="background:none;border:1px solid rgba(255,0,170,.15);color:#556677;padding:8px 16px;font-family:'Share Tech Mono',monospace;font-size:.63rem;letter-spacing:1px;border-radius:3px;cursor:pointer;">‚¨ú Blank White</button>
          </div>
        </div>

        <!-- PANIC BUTTON -->
        <div style="background:var(--card2);border:1px solid rgba(255,0,170,.3);border-radius:8px;padding:20px;">
          <div style="font-family:'Orbitron',sans-serif;font-size:.68rem;color:var(--p);letter-spacing:3px;margin-bottom:6px;">üîí QUICK LOCK</div>
          <div style="font-size:.65rem;color:#446688;letter-spacing:1px;margin-bottom:14px;">Press <strong style="color:var(--p)">ESC</strong> to instantly lock your screen. Choose what it shows:</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;">
            <button onclick="setPanic('blank')" id="panic-blank" class="panic-opt" style="background:rgba(255,0,170,.08);border:1px solid rgba(255,0,170,.3);color:var(--p);padding:7px 14px;font-family:'Share Tech Mono',monospace;font-size:.63rem;letter-spacing:1px;border-radius:3px;cursor:pointer;">‚¨ú Blank White</button>
            <button onclick="setPanic('classroom')" id="panic-classroom" class="panic-opt" style="background:none;border:1px solid rgba(255,0,170,.15);color:#556677;padding:7px 14px;font-family:'Share Tech Mono',monospace;font-size:.63rem;letter-spacing:1px;border-radius:3px;cursor:pointer;">üìö Google Classroom</button>
            <button onclick="setPanic('docs')" id="panic-docs" class="panic-opt" style="background:none;border:1px solid rgba(255,0,170,.15);color:#556677;padding:7px 14px;font-family:'Share Tech Mono',monospace;font-size:.63rem;letter-spacing:1px;border-radius:3px;cursor:pointer;">üìù Google Docs</button>
            <button onclick="setPanic('search')" id="panic-search" class="panic-opt" style="background:none;border:1px solid rgba(255,0,170,.15);color:#556677;padding:7px 14px;font-family:'Share Tech Mono',monospace;font-size:.63rem;letter-spacing:1px;border-radius:3px;cursor:pointer;">üîç Google Search</button>
          </div>
          <button onclick="triggerPanic()" style="background:var(--p);border:none;color:#fff;padding:9px 20px;font-family:'Orbitron',monospace;font-size:.63rem;font-weight:700;letter-spacing:2px;border-radius:3px;cursor:pointer;">üö® TEST PANIC</button>
        </div>

        <!-- WALLPAPER -->
        <div style="background:var(--card2);border:1px solid rgba(0,207,255,.2);border-radius:8px;padding:20px;">
          <div style="font-family:'Orbitron',sans-serif;font-size:.68rem;color:var(--b);letter-spacing:3px;margin-bottom:6px;">üé® BACKGROUND / WALLPAPER</div>
          <div style="font-size:.65rem;color:#446688;letter-spacing:1px;margin-bottom:14px;">Pick a background for the site</div>
          <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:8px;margin-bottom:12px;">
            <div onclick="setWallpaper('none')" style="height:56px;background:#060910;border:2px solid rgba(0,207,255,.3);border-radius:6px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.55rem;color:#446688;letter-spacing:1px;transition:all .2s;" onmouseover="this.style.borderColor='var(--b)'" onmouseout="this.style.borderColor='rgba(0,207,255,.3)'">DEFAULT</div>
            <div onclick="setWallpaper('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?w=1920&q=80')" style="height:56px;background:url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?w=400&q=60') center/cover;border:2px solid transparent;border-radius:6px;cursor:pointer;transition:all .2s;" onmouseover="this.style.borderColor='var(--b)'" onmouseout="this.style.borderColor='transparent'"></div>
            <div onclick="setWallpaper('https://images.unsplash.com/photo-1542831371-29b0f74f9713?w=1920&q=80')" style="height:56px;background:url('https://images.unsplash.com/photo-1542831371-29b0f74f9713?w=400&q=60') center/cover;border:2px solid transparent;border-radius:6px;cursor:pointer;transition:all .2s;" onmouseover="this.style.borderColor='var(--b)'" onmouseout="this.style.borderColor='transparent'"></div>
            <div onclick="setWallpaper('https://images.unsplash.com/photo-1506318137071-a8e063b4bec0?w=1920&q=80')" style="height:56px;background:url('https://images.unsplash.com/photo-1506318137071-a8e063b4bec0?w=400&q=60') center/cover;border:2px solid transparent;border-radius:6px;cursor:pointer;transition:all .2s;" onmouseover="this.style.borderColor='var(--b)'" onmouseout="this.style.borderColor='transparent'"></div>
            <div onclick="setWallpaper('https://images.unsplash.com/photo-1519681393784-d120267933ba?w=1920&q=80')" style="height:56px;background:url('https://images.unsplash.com/photo-1519681393784-d120267933ba?w=400&q=60') center/cover;border:2px solid transparent;border-radius:6px;cursor:pointer;transition:all .2s;" onmouseover="this.style.borderColor='var(--b)'" onmouseout="this.style.borderColor='transparent'"></div>
            <div onclick="setWallpaper('https://images.unsplash.com/photo-1475274047050-1d0c0975c63e?w=1920&q=80')" style="height:56px;background:url('https://images.unsplash.com/photo-1475274047050-1d0c0975c63e?w=400&q=60') center/cover;border:2px solid transparent;border-radius:6px;cursor:pointer;transition:all .2s;" onmouseover="this.style.borderColor='var(--b)'" onmouseout="this.style.borderColor='transparent'"></div>
            <div onclick="setWallpaper('https://images.unsplash.com/photo-1483489571097-0ca295ba3d08?w=1920&q=80')" style="height:56px;background:url('https://images.unsplash.com/photo-1483489571097-0ca295ba3d08?w=400&q=60') center/cover;border:2px solid transparent;border-radius:6px;cursor:pointer;transition:all .2s;" onmouseover="this.style.borderColor='var(--b)'" onmouseout="this.style.borderColor='transparent'"></div>
            <div onclick="setWallpaper('https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=1920&q=80')" style="height:56px;background:url('https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=400&q=60') center/cover;border:2px solid transparent;border-radius:6px;cursor:pointer;transition:all .2s;" onmouseover="this.style.borderColor='var(--b)'" onmouseout="this.style.borderColor='transparent'"></div>
          </div>
          <div style="display:flex;gap:0;">
            <input id="wallpaperUrl" type="text" placeholder="Or paste any image URL..." style="flex:1;background:rgba(0,207,255,.04);border:1px solid rgba(0,207,255,.2);border-right:none;border-radius:3px 0 0 3px;color:var(--b);font-family:'Share Tech Mono',monospace;font-size:.68rem;padding:9px 12px;outline:none;letter-spacing:1px;">
            <button onclick="setWallpaper(document.getElementById('wallpaperUrl').value)" style="background:var(--b);border:none;color:#050810;padding:9px 16px;font-family:'Orbitron',monospace;font-size:.6rem;font-weight:700;letter-spacing:2px;border-radius:0 3px 3px 0;cursor:pointer;">SET</button>
          </div>
        </div>

        <!-- WEATHER -->
        <div style="background:var(--card2);border:1px solid rgba(0,207,255,.15);border-radius:8px;padding:20px;">
          <div style="font-family:'Orbitron',sans-serif;font-size:.68rem;color:var(--b);letter-spacing:3px;margin-bottom:6px;">üå§Ô∏è WEATHER WIDGET</div>
          <div style="font-size:.65rem;color:#446688;letter-spacing:1px;margin-bottom:12px;">Shows weather in the top bar. Enter your city:</div>
          <div style="display:flex;gap:0;margin-bottom:10px;">
            <input id="weatherCity" type="text" placeholder="New York, London, Tokyo..." style="flex:1;background:rgba(0,207,255,.04);border:1px solid rgba(0,207,255,.2);border-right:none;border-radius:3px 0 0 3px;color:var(--b);font-family:'Share Tech Mono',monospace;font-size:.68rem;padding:9px 12px;outline:none;letter-spacing:1px;" onkeydown="if(event.key==='Enter')fetchWeather()">
            <button onclick="fetchWeather()" style="background:var(--b);border:none;color:#050810;padding:9px 16px;font-family:'Orbitron',monospace;font-size:.6rem;font-weight:700;letter-spacing:2px;border-radius:0 3px 3px 0;cursor:pointer;">GET</button>
          </div>
          <div id="weatherResult" style="font-size:.68rem;color:#446688;letter-spacing:1px;"></div>
        </div>

        <!-- ABOUT -->
        <div style="background:var(--card2);border:1px solid rgba(0,255,136,.08);border-radius:8px;padding:20px;">
          <div style="font-family:'Orbitron',sans-serif;font-size:.68rem;color:#446688;letter-spacing:3px;margin-bottom:10px;">‚ÑπÔ∏è ABOUT</div>
          <div style="font-size:.65rem;color:#334455;letter-spacing:1px;line-height:2;">StudyHub.Pro ‚Äî Personal Learning Dashboard<br>Password protected ¬∑ Study tools ¬∑ AI Tutor ¬∑ Focus music</div>
        </div>

      </div>
    </div>

    <!-- CHAT PAGE -->
    <div class="page" id="page-chat">
      <div style="display:flex;flex-direction:column;height:100%;position:relative;">
        <div style="padding:14px 20px;border-bottom:1px solid rgba(255,0,170,.1);display:flex;align-items:center;gap:14px;background:rgba(0,0,0,.3);flex-shrink:0;">
          <div style="font-family:'Orbitron',sans-serif;font-size:.7rem;color:var(--p);letter-spacing:3px;">üí¨ SECRET CHAT</div>
          <div id="chatRoomName" style="font-size:.65rem;color:#446688;letter-spacing:1px;flex:1;"></div>
          <div style="display:flex;gap:8px;align-items:center;">
            <span style="font-size:.6rem;color:#334455;letter-spacing:1px;">ROOM:</span>
            <input id="roomCodeInput" type="text" maxlength="20" placeholder="enter room code..." style="background:rgba(255,0,170,.06);border:1px solid rgba(255,0,170,.2);border-radius:3px;color:var(--p);font-family:'Share Tech Mono',monospace;font-size:.65rem;padding:5px 10px;outline:none;width:140px;letter-spacing:1px;" onkeydown="if(event.key==='Enter')joinRoom()">
            <button onclick="joinRoom()" style="background:var(--p);border:none;color:#fff;padding:5px 12px;font-family:'Orbitron',monospace;font-size:.58rem;font-weight:700;letter-spacing:1px;border-radius:3px;cursor:pointer;">JOIN</button>
          </div>
          <div style="display:flex;gap:8px;align-items:center;">
            <span style="font-size:.6rem;color:#334455;letter-spacing:1px;">NAME:</span>
            <input id="chatNameInput" type="text" maxlength="16" placeholder="your name..." style="background:rgba(255,0,170,.06);border:1px solid rgba(255,0,170,.2);border-radius:3px;color:var(--p);font-family:'Share Tech Mono',monospace;font-size:.65rem;padding:5px 10px;outline:none;width:120px;letter-spacing:1px;">
          </div>
        </div>
        <div id="chatLog" style="flex:1;overflow-y:auto;padding:16px 20px;display:flex;flex-direction:column;gap:10px;">
          <div style="text-align:center;font-size:.63rem;color:#334455;letter-spacing:2px;padding:20px;">Enter a room code and your name to start chatting with friends üîí</div>
        </div>
        <div style="display:flex;gap:0;padding:14px 16px;border-top:1px solid rgba(255,0,170,.1);background:rgba(0,0,0,.3);">
          <input id="chatMsgInput" type="text" placeholder="Type a message... (Enter to send)" maxlength="200" style="flex:1;background:rgba(255,0,170,.04);border:1px solid rgba(255,0,170,.18);border-right:none;border-radius:3px 0 0 3px;color:#c0d8ff;font-family:'Share Tech Mono',monospace;font-size:.73rem;padding:11px 14px;outline:none;letter-spacing:1px;" onkeydown="if(event.key==='Enter')sendChatMsg()">
          <button onclick="sendChatMsg()" style="background:var(--p);border:none;color:#fff;padding:11px 20px;font-family:'Orbitron',monospace;font-size:.63rem;font-weight:700;letter-spacing:2px;border-radius:0 3px 3px 0;cursor:pointer;">SEND</button>
        </div>
      </div>
    </div>

  </div><!-- /main -->
</div><!-- /app -->

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PASSWORD / COVER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentPassword = 'Jesus247'; // will be overridden by settings
let typed = '';

// Google login style ‚Äî press Enter or click Next to submit
document.getElementById('coverPass').addEventListener('keydown', function(e) {
  if (e.key === 'Enter') tryGoogleLogin();
});

function tryGoogleLogin() {
  const inp = document.getElementById('coverPass');
  const err = document.getElementById('coverError');
  const btn = document.getElementById('googleNextBtn');
  if (!inp) return;
  if (inp.value === currentPassword) {
    err.style.display = 'none';
    inp.style.borderColor = '#34a853';
    btn.textContent = '‚úì';
    btn.style.background = '#34a853';
    setTimeout(() => unlock(), 400);
  } else {
    err.style.display = 'block';
    inp.style.borderColor = '#d93025';
    inp.style.boxShadow = '0 0 0 2px rgba(217,48,37,0.2)';
    inp.value = '';
    inp.focus();
    setTimeout(() => { inp.style.borderColor = '#dadce0'; inp.style.boxShadow = 'none'; }, 2000);
  }
}

// Delegation fallback for rebuilt covers
document.getElementById('cover').addEventListener('input', function(e) {
  if (e.target && e.target.id === 'coverPass') {
    document.getElementById('coverError') && (document.getElementById('coverError').style.display = 'none');
  }
});

function unlock() {
  document.getElementById('cover').style.display = 'none';
  document.getElementById('app').style.display = 'flex';
  renderGames(games);
  addMsg('chatMessages','ai','Hey! I\'m StudyBot üìö Ask me anything ‚Äî homework help, essay tips, math problems, or just chat!');
  setTimeout(() => {
    spawnFireworks();
    showToast('üîì UNLOCKED', 'Welcome back to StudyHub', 'var(--g)');
  }, 400);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAV
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function switchPage(id, btn) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.navtab').forEach(b => b.classList.remove('active'));
  document.getElementById('page-' + id).classList.add('active');
  btn.classList.add('active');
  runLoader();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GAMES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BUILT-IN GAMES (no internet needed)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const BUILTIN_GAMES = {

'snake': () => `<!DOCTYPE html><html><head><style>
*{margin:0;padding:0;box-sizing:border-box;}
body{background:#060910;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;font-family:'Courier New',monospace;color:#00ff88;}
canvas{border:2px solid #00ff88;box-shadow:0 0 30px #00ff8844;}
#info{margin-bottom:12px;font-size:14px;letter-spacing:3px;display:flex;gap:30px;}
#msg{margin-top:12px;font-size:13px;color:#446688;letter-spacing:2px;}
</style></head><body>
<div id="info"><span>SCORE: <b id="score">0</b></span><span>BEST: <b id="best">0</b></span></div>
<canvas id="c" width="400" height="400"></canvas>
<div id="msg">ARROW KEYS / WASD TO MOVE</div>
<script>
const c=document.getElementById('c'),ctx=c.getContext('2d'),S=20,W=20,H=20;
let snake=[{x:10,y:10}],dir={x:1,y:0},food={x:5,y:5},score=0,best=0,alive=true,speed=150,last=0;
function rndFood(){food={x:Math.floor(Math.random()*W),y:Math.floor(Math.random()*H)};}
function draw(ts){
  if(!alive){return;}
  if(ts-last<speed){requestAnimationFrame(draw);return;}
  last=ts;
  let head={x:snake[0].x+dir.x,y:snake[0].y+dir.y};
  if(head.x<0||head.x>=W||head.y<0||head.y>=H||snake.some(s=>s.x===head.x&&s.y===head.y)){
    alive=false;ctx.fillStyle='rgba(0,0,0,0.7)';ctx.fillRect(0,0,400,400);
    ctx.fillStyle='#ff00aa';ctx.font='bold 28px Courier New';ctx.textAlign='center';
    ctx.fillText('GAME OVER',200,185);ctx.fillStyle='#00ff88';ctx.font='14px Courier New';
    ctx.fillText('SCORE: '+score,200,215);ctx.fillText('PRESS SPACE TO RESTART',200,240);return;
  }
  snake.unshift(head);
  if(head.x===food.x&&head.y===food.y){score++;speed=Math.max(60,speed-2);document.getElementById('score').textContent=score;if(score>best){best=score;document.getElementById('best').textContent=best;}rndFood();}
  else snake.pop();
  ctx.fillStyle='#060910';ctx.fillRect(0,0,400,400);
  ctx.strokeStyle='#0a1525';ctx.lineWidth=0.5;
  for(let i=0;i<W;i++){ctx.beginPath();ctx.moveTo(i*S,0);ctx.lineTo(i*S,400);ctx.stroke();ctx.beginPath();ctx.moveTo(0,i*S);ctx.lineTo(400,i*S);ctx.stroke();}
  ctx.fillStyle='#ff3366';ctx.shadowColor='#ff3366';ctx.shadowBlur=10;ctx.fillRect(food.x*S+2,food.y*S+2,S-4,S-4);
  snake.forEach((s,i)=>{ctx.fillStyle=i===0?'#00ff88':\`hsl(\${140-i*2},100%,\${50-i*0.5}%)\`;ctx.shadowColor='#00ff88';ctx.shadowBlur=i===0?15:0;ctx.fillRect(s.x*S+1,s.y*S+1,S-2,S-2);});
  ctx.shadowBlur=0;requestAnimationFrame(draw);
}
function reset(){snake=[{x:10,y:10}];dir={x:1,y:0};score=0;speed=150;alive=true;document.getElementById('score').textContent=0;rndFood();requestAnimationFrame(draw);}
document.addEventListener('keydown',e=>{
  const k=e.key;
  if(!alive&&k===' '){reset();return;}
  if(k==='ArrowUp'||k==='w'){if(dir.y!==1)dir={x:0,y:-1};}
  else if(k==='ArrowDown'||k==='s'){if(dir.y!==-1)dir={x:0,y:1};}
  else if(k==='ArrowLeft'||k==='a'){if(dir.x!==1)dir={x:-1,y:0};}
  else if(k==='ArrowRight'||k==='d'){if(dir.x!==-1)dir={x:1,y:0};}
  e.preventDefault();
});
reset();
</script></body></html>`,

'2048': () => `<!DOCTYPE html><html><head><style>
*{margin:0;padding:0;box-sizing:border-box;}
body{background:#060910;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;font-family:'Courier New',monospace;color:#fff;padding:20px;}
h1{color:#00ff88;letter-spacing:8px;font-size:1.4rem;margin-bottom:10px;text-shadow:0 0 20px #00ff88;}
#scorebar{display:flex;gap:20px;margin-bottom:16px;}
.sbox{background:#0a1525;border:1px solid #00ff8833;padding:8px 20px;border-radius:4px;text-align:center;}
.sbox label{display:block;font-size:10px;color:#446688;letter-spacing:2px;}
.sbox span{font-size:1.2rem;color:#00ff88;font-weight:bold;}
#board{display:grid;grid-template-columns:repeat(4,90px);gap:8px;background:#0a1525;padding:12px;border-radius:8px;border:1px solid #00ff8822;}
.cell{width:90px;height:90px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:bold;transition:all .1s;}
#msg{margin-top:14px;color:#446688;font-size:12px;letter-spacing:2px;}
.btn{margin-top:10px;background:#00ff8822;border:1px solid #00ff88;color:#00ff88;padding:8px 24px;font-family:'Courier New';font-size:12px;letter-spacing:2px;border-radius:3px;cursor:pointer;}
</style></head><body>
<h1>2048</h1>
<div id="scorebar"><div class="sbox"><label>SCORE</label><span id="sc">0</span></div><div class="sbox"><label>BEST</label><span id="bs">0</span></div></div>
<div id="board"></div>
<div id="msg">USE ARROW KEYS OR SWIPE</div>
<button class="btn" onclick="init()">NEW GAME</button>
<script>
const COLORS={'0':'#0d1b2a','2':'#0d3b2e','4':'#0d5c37','8':'#1a7a46','16':'#2d9e5a','32':'#45c46e','64':'#00ff88','128':'#ffcc00','256':'#ff9900','512':'#ff6600','1024':'#ff3300','2048':'#ff00aa'};
const TEXTC={'0':'transparent','2':'#a0d8af','4':'#a0d8af','8':'#fff','16':'#fff','32':'#fff','64':'#060910','128':'#060910','256':'#060910','512':'#060910','1024':'#060910','2048':'#060910'};
let grid,score,best=0;
function init(){grid=Array(4).fill(0).map(()=>Array(4).fill(0));score=0;addTile();addTile();render();}
function addTile(){let empty=[];for(let r=0;r<4;r++)for(let c=0;c<4;c++)if(!grid[r][c])empty.push([r,c]);if(!empty.length)return;let[r,c]=empty[Math.floor(Math.random()*empty.length)];grid[r][c]=Math.random()<0.9?2:4;}
function render(){document.getElementById('sc').textContent=score;document.getElementById('bs').textContent=best;let b=document.getElementById('board');b.innerHTML='';grid.forEach(row=>row.forEach(v=>{let d=document.createElement('div');d.className='cell';d.style.background=COLORS[Math.min(v,2048)]||'#ff00aa';d.style.color=TEXTC[Math.min(v,2048)]||'#fff';d.style.fontSize=v>=1000?'1.1rem':v>=100?'1.3rem':'1.5rem';d.textContent=v||'';b.appendChild(d);}));}
function slide(row){let r=row.filter(x=>x);for(let i=0;i<r.length-1;i++)if(r[i]===r[i+1]){score+=r[i]*2;if(score>best)best=score;r[i]*=2;r.splice(i+1,1);i++;}while(r.length<4)r.push(0);return r;}
function move(dir){let moved=false,g=grid.map(r=>[...r]);
if(dir==='left')grid=grid.map(r=>{let s=slide(r);if(s.join()!==r.join())moved=true;return s;});
if(dir==='right')grid=grid.map(r=>{let s=slide([...r].reverse()).reverse();if(s.join()!==r.join())moved=true;return s;});
if(dir==='up'){for(let c=0;c<4;c++){let col=grid.map(r=>r[c]);let s=slide(col);s.forEach((v,r)=>{if(v!==grid[r][c])moved=true;grid[r][c]=v;});}}
if(dir==='down'){for(let c=0;c<4;c++){let col=grid.map(r=>r[c]).reverse();let s=slide(col).reverse();s.forEach((v,r)=>{if(v!==grid[r][c])moved=true;grid[r][c]=v;});}}
if(moved){addTile();render();}}
document.addEventListener('keydown',e=>{const m={ArrowLeft:'left',ArrowRight:'right',ArrowUp:'up',ArrowDown:'down'};if(m[e.key]){move(m[e.key]);e.preventDefault();}});
let tx=0,ty=0;
document.addEventListener('touchstart',e=>{tx=e.touches[0].clientX;ty=e.touches[0].clientY;},{passive:true});
document.addEventListener('touchend',e=>{let dx=e.changedTouches[0].clientX-tx,dy=e.changedTouches[0].clientY-ty;if(Math.abs(dx)>Math.abs(dy))move(dx>0?'right':'left');else move(dy>0?'down':'up');},{passive:true});
init();
</script></body></html>`,

'tetris': () => `<!DOCTYPE html><html><head><style>
*{margin:0;padding:0;box-sizing:border-box;}
body{background:#060910;display:flex;align-items:center;justify-content:center;height:100vh;font-family:'Courier New',monospace;gap:20px;}
canvas{border:2px solid #00cfff;box-shadow:0 0 30px #00cfff44;}
#side{color:#fff;display:flex;flex-direction:column;gap:16px;min-width:120px;}
.panel{background:#0a1525;border:1px solid #00cfff22;padding:12px;border-radius:6px;}
.panel label{display:block;font-size:10px;color:#446688;letter-spacing:2px;margin-bottom:6px;}
.panel span{font-size:1.3rem;color:#00cfff;font-weight:bold;}
#next{display:grid;grid-template-columns:repeat(4,20px);gap:2px;margin-top:8px;}
.nc{width:20px;height:20px;border-radius:2px;}
p{font-size:10px;color:#334455;letter-spacing:1px;line-height:1.8;}
</style></head><body>
<canvas id="c" width="200" height="400"></canvas>
<div id="side">
  <div class="panel"><label>SCORE</label><span id="sc">0</span></div>
  <div class="panel"><label>LINES</label><span id="ln">0</span></div>
  <div class="panel"><label>LEVEL</label><span id="lv">1</span></div>
  <div class="panel"><label>NEXT</label><div id="next"></div></div>
  <div class="panel"><p>‚Üê ‚Üí MOVE<br>‚Üë ROTATE<br>‚Üì SOFT DROP<br>SPACE DROP</p></div>
</div>
<script>
const C=document.getElementById('c'),ctx=C.getContext('2d'),B=20,W=10,H=20;
const PIECES=[[[1,1,1,1]],[[1,1],[1,1]],[[0,1,0],[1,1,1]],[[1,0,0],[1,1,1]],[[0,0,1],[1,1,1]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]]];
const COLS=['#00cfff','#ffcc00','#ff00aa','#ff6600','#00ff88','#ff3366','#a855f7'];
let board,piece,px,py,next,score,lines,level,alive,timer;
function newBoard(){return Array(H).fill(0).map(()=>Array(W).fill(0));}
function rnd(){return Math.floor(Math.random()*PIECES.length);}
function spawn(){let t=next??rnd();next=rnd();piece=PIECES[t].map(r=>[...r]);px=Math.floor(W/2)-Math.floor(piece[0].length/2);py=0;
  if(collide(piece,px,py)){alive=false;clearInterval(timer);ctx.fillStyle='rgba(0,0,0,0.75)';ctx.fillRect(0,0,200,400);ctx.fillStyle='#ff00aa';ctx.font='bold 20px Courier';ctx.textAlign='center';ctx.fillText('GAME OVER',100,190);ctx.fillStyle='#00cfff';ctx.font='12px Courier';ctx.fillText('SCORE: '+score,100,215);ctx.fillText('F5 TO RESTART',100,235);}
  renderNext();}
function renderNext(){let d=document.getElementById('next');d.innerHTML='';let p=PIECES[next];for(let r=0;r<4;r++)for(let c=0;c<4;c++){let el=document.createElement('div');el.className='nc';el.style.background=(p[r]&&p[r][c])?COLS[next]:'#0d1b2a';d.appendChild(el);}}
function collide(p,ox,oy){for(let r=0;r<p.length;r++)for(let c=0;c<p[r].length;c++)if(p[r][c]&&(oy+r>=H||ox+c<0||ox+c>=W||board[oy+r][ox+c]))return true;return false;}
function place(){piece.forEach((r,ri)=>r.forEach((v,ci)=>{if(v)board[py+ri][px+ci]=PIECES.indexOf(piece)+1;}));
  let cleared=0;for(let r=H-1;r>=0;r--)if(board[r].every(c=>c)){board.splice(r,1);board.unshift(Array(W).fill(0));cleared++;r++;}
  if(cleared){lines+=cleared;score+=[0,100,300,500,800][cleared]*level;level=Math.floor(lines/10)+1;clearInterval(timer);timer=setInterval(drop,Math.max(50,500-level*40));document.getElementById('sc').textContent=score;document.getElementById('ln').textContent=lines;document.getElementById('lv').textContent=level;}
  spawn();}
function drop(){if(collide(piece,px,py+1))place();else py++; render();}
function render(){ctx.fillStyle='#060910';ctx.fillRect(0,0,200,400);ctx.strokeStyle='#0a1525';ctx.lineWidth=0.5;for(let i=0;i<=W;i++){ctx.beginPath();ctx.moveTo(i*B,0);ctx.lineTo(i*B,400);ctx.stroke();}for(let i=0;i<=H;i++){ctx.beginPath();ctx.moveTo(0,i*B);ctx.lineTo(200,i*B);ctx.stroke();}
  board.forEach((row,r)=>row.forEach((v,c)=>{if(v){ctx.fillStyle=COLS[v-1];ctx.shadowColor=COLS[v-1];ctx.shadowBlur=6;ctx.fillRect(c*B+1,r*B+1,B-2,B-2);ctx.shadowBlur=0;}}));
  // ghost
  let gy=py;while(!collide(piece,px,gy+1))gy++;
  piece.forEach((row,r)=>row.forEach((v,c)=>{if(v){ctx.fillStyle='rgba(255,255,255,0.08)';ctx.fillRect((px+c)*B+1,(gy+r)*B+1,B-2,B-2);}}));
  piece.forEach((row,r)=>row.forEach((v,c)=>{if(v){let ci=PIECES.findIndex(p=>p===piece);ctx.fillStyle=COLS[ci]||'#fff';ctx.shadowColor=COLS[ci]||'#fff';ctx.shadowBlur=8;ctx.fillRect((px+c)*B+1,(py+r)*B+1,B-2,B-2);ctx.shadowBlur=0;}}));}
function rotate(p){return p[0].map((_,i)=>p.map(r=>r[i]).reverse());}
document.addEventListener('keydown',e=>{if(!alive)return;
  if(e.key==='ArrowLeft'&&!collide(piece,px-1,py))px--;
  else if(e.key==='ArrowRight'&&!collide(piece,px+1,py))px++;
  else if(e.key==='ArrowDown'){if(!collide(piece,px,py+1))py++;}
  else if(e.key==='ArrowUp'){let r=rotate(piece);if(!collide(r,px,py))piece=r;}
  else if(e.key===' '){while(!collide(piece,px,py+1))py++;place();}
  else return;e.preventDefault();render();});
function start(){board=newBoard();score=0;lines=0;level=1;alive=true;document.getElementById('sc').textContent=0;document.getElementById('ln').textContent=0;document.getElementById('lv').textContent=1;next=null;spawn();render();timer=setInterval(drop,500);}
start();
</script></body></html>`,

'flappy': () => `<!DOCTYPE html><html><head><style>
*{margin:0;padding:0;}body{background:#060910;display:flex;align-items:center;justify-content:center;height:100vh;font-family:'Courier New',monospace;}
canvas{cursor:pointer;border:2px solid #00ff8844;}
</style></head><body>
<canvas id="c"></canvas>
<script>
const c=document.getElementById('c'),ctx=c.getContext('2d');
c.width=360;c.height=500;
let bird,pipes,score,best=0,state,frame;
const BX=80,BR=18,G=0.5,JUMP=-9,PW=52,GAP=140,PS=2.2;
function reset(){bird={y:220,v:0};pipes=[];score=0;state='waiting';frame=0;}
function addPipe(){let h=80+Math.random()*180;pipes.push({x:360,top:h,scored:false});}
function update(){
  if(state==='waiting'||state==='dead')return;
  bird.v+=G;bird.y+=bird.v;frame++;
  if(frame%90===0)addPipe();
  pipes.forEach(p=>p.x-=PS);
  pipes=pipes.filter(p=>p.x>-PW);
  pipes.forEach(p=>{
    if(!p.scored&&p.x+PW<BX){p.scored=true;score++;if(score>best)best=score;}
    if(BX+BR>p.x&&BX-BR<p.x+PW&&(bird.y-BR<p.top||bird.y+BR>p.top+GAP))state='dead';
  });
  if(bird.y+BR>500||bird.y-BR<0)state='dead';
}
function draw(){
  ctx.fillStyle='#060910';ctx.fillRect(0,0,360,500);
  // pipes
  pipes.forEach(p=>{
    ctx.fillStyle='#00ff8822';ctx.fillRect(p.x,0,PW,p.top);ctx.fillRect(p.x,p.top+GAP,PW,500);
    ctx.strokeStyle='#00ff88';ctx.lineWidth=2;ctx.strokeRect(p.x,0,PW,p.top);ctx.strokeRect(p.x,p.top+GAP,PW,500);
  });
  // bird
  ctx.save();ctx.translate(BX,bird.y);ctx.rotate(Math.min(Math.max(bird.v*0.08,-0.5),0.5));
  ctx.fillStyle='#ffcc00';ctx.shadowColor='#ffcc00';ctx.shadowBlur=15;
  ctx.beginPath();ctx.arc(0,0,BR,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='#ff6600';ctx.beginPath();ctx.arc(8,0,7,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='#060910';ctx.beginPath();ctx.arc(9,0,3,0,Math.PI*2);ctx.fill();
  ctx.shadowBlur=0;ctx.restore();
  // score
  ctx.fillStyle='#fff';ctx.font='bold 28px Courier';ctx.textAlign='center';ctx.fillText(score,180,50);
  ctx.font='12px Courier';ctx.fillStyle='#446688';ctx.fillText('BEST: '+best,180,70);
  if(state==='waiting'){ctx.fillStyle='#00ff88';ctx.font='16px Courier';ctx.fillText('TAP OR SPACE TO START',180,260);}
  if(state==='dead'){ctx.fillStyle='rgba(0,0,0,0.6)';ctx.fillRect(0,0,360,500);ctx.fillStyle='#ff00aa';ctx.font='bold 28px Courier';ctx.fillText('GAME OVER',180,220);ctx.fillStyle='#fff';ctx.font='16px Courier';ctx.fillText('SCORE: '+score,180,255);ctx.fillStyle='#00ff88';ctx.fillText('TAP TO RESTART',180,290);}
}
function flap(){if(state==='dead'||state==='waiting'){reset();state='playing';return;}bird.v=JUMP;}
c.addEventListener('click',flap);
document.addEventListener('keydown',e=>{if(e.code==='Space'){flap();e.preventDefault();}});
document.addEventListener('touchstart',flap,{passive:true});
function loop(){update();draw();requestAnimationFrame(loop);}
reset();loop();
</script></body></html>`,

'dino': () => `<!DOCTYPE html><html><head><style>
*{margin:0;padding:0;}body{background:#060910;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;font-family:'Courier New',monospace;color:#00ff88;}
#info{display:flex;gap:30px;margin-bottom:16px;font-size:13px;letter-spacing:3px;}
canvas{border:2px solid #00ff8844;}
#msg{margin-top:12px;font-size:12px;color:#446688;letter-spacing:2px;}
</style></head><body>
<div id="info"><span>SCORE <b id="sc">0</b></span><span>BEST <b id="bs">0</b></span></div>
<canvas id="c" width="700" height="200"></canvas>
<div id="msg">SPACE / TAP TO JUMP ‚Äî DOUBLE JUMP AVAILABLE</div>
<script>
const c=document.getElementById('c'),ctx=c.getContext('2d');
let dino,obs,score,best=0,alive,speed,frame,jumps;
function reset(){dino={x:80,y:150,vy:0,h:40,w:30};obs=[];score=0;alive=true;speed=4;frame=0;jumps=0;}
function jump(){if(jumps<2){dino.vy=-13+(jumps*2);jumps++;}}
function update(){
  if(!alive)return;
  frame++;score=Math.floor(frame/6);speed=4+frame/600;
  if(score>best)best=score;
  document.getElementById('sc').textContent=score;document.getElementById('bs').textContent=best;
  dino.vy+=0.8;dino.y+=dino.vy;
  if(dino.y>=150){dino.y=150;dino.vy=0;jumps=0;}
  if(Math.floor(frame)%Math.max(40,80-Math.floor(frame/200))===0)obs.push({x:700,w:20+Math.random()*20,h:30+Math.random()*30,type:Math.random()<0.3&&score>200?'bird':'cactus'});
  obs.forEach(o=>o.x-=speed);
  obs=obs.filter(o=>o.x>-50);
  obs.forEach(o=>{
    let oy=o.type==='bird'?110:170-o.h;
    if(dino.x+dino.w-8>o.x&&dino.x+8<o.x+o.w&&dino.y+dino.h-8>oy&&dino.y+8<oy+o.h){alive=false;}
  });
}
function draw(){
  ctx.fillStyle='#060910';ctx.fillRect(0,0,700,200);
  ctx.strokeStyle='#0a2015';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(0,190);ctx.lineTo(700,190);ctx.stroke();
  // dino
  ctx.fillStyle='#00ff88';ctx.shadowColor='#00ff88';ctx.shadowBlur=10;
  ctx.fillRect(dino.x,dino.y,dino.w,dino.h);
  ctx.fillRect(dino.x+dino.w,dino.y,8,12);// eye area
  ctx.fillStyle='#060910';ctx.fillRect(dino.x+dino.w-2,dino.y+6,6,6);// eye
  ctx.shadowBlur=0;
  obs.forEach(o=>{
    let oy=o.type==='bird'?110:170-o.h;
    ctx.fillStyle=o.type==='bird'?'#ff00aa':'#00cfff';ctx.shadowColor=ctx.fillStyle;ctx.shadowBlur=8;
    ctx.fillRect(o.x,oy,o.w,o.h);ctx.shadowBlur=0;
  });
  if(!alive){ctx.fillStyle='rgba(0,0,0,0.7)';ctx.fillRect(0,0,700,200);ctx.fillStyle='#ff00aa';ctx.font='bold 24px Courier';ctx.textAlign='center';ctx.fillText('GAME OVER ‚Äî SPACE TO RESTART',350,100);}
}
document.addEventListener('keydown',e=>{if(e.code==='Space'){if(!alive)reset();else jump();e.preventDefault();}});
document.addEventListener('touchstart',()=>{if(!alive)reset();else jump();},{passive:true});
function loop(){update();draw();requestAnimationFrame(loop);}
reset();loop();
</script></body></html>`,

'breakout': () => `<!DOCTYPE html><html><head><style>
*{margin:0;padding:0;}body{background:#060910;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;font-family:'Courier New',monospace;color:#fff;}
#hud{display:flex;gap:30px;margin-bottom:12px;font-size:13px;letter-spacing:3px;color:#00cfff;}
canvas{border:2px solid #00cfff44;cursor:none;}
</style></head><body>
<div id="hud"><span>SCORE <b id="sc">0</b></span><span>LIVES <b id="lv">3</b></span><span>LEVEL <b id="ll">1</b></span></div>
<canvas id="c" width="480" height="400"></canvas>
<script>
const c=document.getElementById('c'),ctx=c.getContext('2d');
const COLS=['#ff00aa','#ff6600','#ffcc00','#00ff88','#00cfff','#a855f7'];
let bricks,ball,paddle,score,lives,level,alive;
function initBricks(){bricks=[];let rows=3+level,cols=10;for(let r=0;r<rows;r++)for(let c2=0;c2<cols;c2++)bricks.push({x:c2*46+6,y:r*28+40,w:40,h:22,alive:true,col:COLS[r%COLS.length]});}
function reset(){ball={x:240,y:300,vx:3+level*0.3,vy:-(4+level*0.2),r:8};paddle={x:180,w:80,y:380,h:12};}
function init(){score=0;lives=3;level=1;alive=true;initBricks();reset();}
function update(){
  if(!alive)return;
  ball.x+=ball.vx;ball.y+=ball.vy;
  if(ball.x<=ball.r||ball.x>=480-ball.r)ball.vx*=-1;
  if(ball.y<=ball.r)ball.vy*=-1;
  if(ball.y>500){lives--;document.getElementById('lv').textContent=lives;if(lives<=0){alive=false;return;}reset();return;}
  if(ball.y+ball.r>=paddle.y&&ball.y-ball.r<=paddle.y+paddle.h&&ball.x>=paddle.x&&ball.x<=paddle.x+paddle.w){ball.vy=-(Math.abs(ball.vy));ball.vx+=((ball.x-(paddle.x+paddle.w/2))/paddle.w)*3;}
  bricks.forEach(b=>{if(!b.alive)return;if(ball.x+ball.r>b.x&&ball.x-ball.r<b.x+b.w&&ball.y+ball.r>b.y&&ball.y-ball.r<b.y+b.h){b.alive=false;ball.vy*=-1;score+=10+level*5;document.getElementById('sc').textContent=score;}});
  if(bricks.every(b=>!b.alive)){level++;document.getElementById('ll').textContent=level;initBricks();reset();}
}
function draw(){
  ctx.fillStyle='#060910';ctx.fillRect(0,0,480,400);
  bricks.forEach(b=>{if(!b.alive)return;ctx.fillStyle=b.col;ctx.shadowColor=b.col;ctx.shadowBlur=8;ctx.fillRect(b.x,b.y,b.w,b.h);ctx.shadowBlur=0;});
  ctx.fillStyle='#00cfff';ctx.shadowColor='#00cfff';ctx.shadowBlur=15;
  ctx.beginPath();ctx.arc(ball.x,ball.y,ball.r,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;
  ctx.fillStyle='#00ff88';ctx.shadowColor='#00ff88';ctx.shadowBlur=10;
  ctx.fillRect(paddle.x,paddle.y,paddle.w,paddle.h);ctx.shadowBlur=0;
  if(!alive){ctx.fillStyle='rgba(0,0,0,.8)';ctx.fillRect(0,0,480,400);ctx.fillStyle='#ff00aa';ctx.font='bold 26px Courier';ctx.textAlign='center';ctx.fillText('GAME OVER',240,185);ctx.fillStyle='#fff';ctx.font='14px Courier';ctx.fillText('SCORE: '+score,240,215);ctx.fillStyle='#00ff88';ctx.fillText('CLICK TO RESTART',240,245);}
}
c.addEventListener('mousemove',e=>{let r=c.getBoundingClientRect();paddle.x=e.clientX-r.left-paddle.w/2;paddle.x=Math.max(0,Math.min(480-paddle.w,paddle.x));});
c.addEventListener('touchmove',e=>{let r=c.getBoundingClientRect();paddle.x=e.touches[0].clientX-r.left-paddle.w/2;paddle.x=Math.max(0,Math.min(480-paddle.w,paddle.x));e.preventDefault();},{passive:false});
c.addEventListener('click',()=>{if(!alive){level=1;init();}});
function loop(){update();draw();requestAnimationFrame(loop);}
init();loop();
</script></body></html>`,

'pacman': () => `<!DOCTYPE html><html><head><style>
*{margin:0;padding:0;}body{background:#060910;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;font-family:'Courier New',monospace;color:#ffcc00;}
#hud{display:flex;gap:30px;margin-bottom:10px;font-size:13px;letter-spacing:3px;}
canvas{border:2px solid #ffcc0033;}
</style></head><body>
<div id="hud"><span>SCORE <b id="sc">0</b></span><span>LIVES <span id="lv">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></span></div>
<canvas id="c" width="420" height="420"></canvas>
<script>
const c=document.getElementById('c'),ctx=c.getContext('2d'),T=28;
const MAP=[
[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
[1,2,2,2,2,2,1,2,2,2,2,2,2,2,1],
[1,3,1,2,1,2,1,2,1,2,1,2,1,3,1],
[1,2,1,2,1,2,1,2,1,2,1,2,1,2,1],
[1,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
[1,2,1,2,1,1,2,1,1,2,1,2,1,2,1],
[1,2,2,2,1,2,2,2,2,1,2,2,2,2,1],
[1,1,1,2,1,2,2,0,2,2,1,2,1,1,1],
[1,2,2,2,2,2,1,2,1,2,2,2,2,2,1],
[1,2,1,1,2,1,1,2,1,1,2,1,1,2,1],
[1,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
[1,2,1,2,1,2,1,2,1,2,1,2,1,2,1],
[1,3,2,2,1,2,2,2,2,1,2,2,2,3,1],
[1,2,1,2,2,2,1,2,1,2,2,2,1,2,1],
[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]];
let grid,pac,ghosts,score,lives,dir,ndir,alive,mouthA,ghostTimer;
function initGrid(){grid=MAP.map(r=>[...r]);}
function resetPos(){pac={x:7,y:11,fx:7*T+T/2,fy:11*T+T/2};dir={x:0,y:0};ndir={x:1,y:0};
ghosts=[{x:7,y:7,fx:7*T+T/2,fy:7*T+T/2,col:'#ff0000',dx:1,dy:0},{x:6,y:7,fx:6*T+T/2,fy:7*T+T/2,col:'#ffb8ff',dx:-1,dy:0}];}
function start(){score=0;lives=3;alive=true;mouthA=0;initGrid();resetPos();}
function canMove(x,y){return x>=0&&x<15&&y>=0&&y<15&&grid[y][x]!==1;}
function update(){
  if(!alive)return;
  mouthA+=0.2;
  if(canMove(pac.x+ndir.x,pac.y+ndir.y))dir={...ndir};
  let nx=pac.x+dir.x,ny=pac.y+dir.y;
  if(canMove(nx,ny)){pac.x=nx;pac.y=ny;pac.fx=nx*T+T/2;pac.fy=ny*T+T/2;
    if(grid[ny][nx]===2){grid[ny][nx]=0;score+=10;document.getElementById('sc').textContent=score;}
    if(grid[ny][nx]===3){grid[ny][nx]=0;score+=50;}
  }
  // move ghosts
  ghosts.forEach(g=>{
    const ds=[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}];
    let valid=ds.filter(d=>canMove(g.x+d.x,g.y+d.y)&&!(d.x===-g.dx&&d.y===-g.dy));
    if(!valid.length)valid=ds.filter(d=>canMove(g.x+d.x,g.y+d.y));
    if(valid.length){let d=valid[Math.floor(Math.random()*valid.length)];g.dx=d.x;g.dy=d.y;g.x+=d.x;g.y+=d.y;g.fx=g.x*T+T/2;g.fy=g.y*T+T/2;}
    if(g.x===pac.x&&g.y===pac.y){lives--;document.getElementById('lv').textContent='‚ù§Ô∏è'.repeat(Math.max(0,lives));if(lives<=0)alive=false;else resetPos();}
  });
  if(!grid.flat().some(v=>v===2||v===3)){initGrid();resetPos();}
}
function draw(){
  ctx.fillStyle='#060910';ctx.fillRect(0,0,420,420);
  grid.forEach((row,r)=>row.forEach((v,c)=>{
    let x=c*T,y=r*T;
    if(v===1){ctx.fillStyle='#0a1f3a';ctx.fillRect(x,y,T,T);ctx.strokeStyle='#1a3a6a';ctx.lineWidth=1;ctx.strokeRect(x+1,y+1,T-2,T-2);}
    else if(v===2){ctx.fillStyle='#ffcc00';ctx.shadowColor='#ffcc00';ctx.shadowBlur=4;ctx.beginPath();ctx.arc(x+T/2,y+T/2,3,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;}
    else if(v===3){ctx.fillStyle='#ffcc00';ctx.shadowColor='#ffcc00';ctx.shadowBlur=12;ctx.beginPath();ctx.arc(x+T/2,y+T/2,7,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;}
  }));
  // pacman
  let angle=dir.x<0?Math.PI:dir.y<0?Math.PI*1.5:dir.y>0?Math.PI*0.5:0;
  let mouth=Math.abs(Math.sin(mouthA))*0.4;
  ctx.fillStyle='#ffcc00';ctx.shadowColor='#ffcc00';ctx.shadowBlur=12;
  ctx.beginPath();ctx.moveTo(pac.fx,pac.fy);ctx.arc(pac.fx,pac.fy,T/2-2,angle+mouth,angle+Math.PI*2-mouth);ctx.closePath();ctx.fill();ctx.shadowBlur=0;
  ghosts.forEach(g=>{ctx.fillStyle=g.col;ctx.shadowColor=g.col;ctx.shadowBlur=10;ctx.beginPath();ctx.arc(g.fx,g.fy,T/2-3,Math.PI,0);ctx.lineTo(g.fx+T/2-3,g.fy+T/2-3);for(let i=0;i<3;i++){ctx.lineTo(g.fx+T/2-3-(i*(T-6)/3),g.fy+T/2-8);ctx.lineTo(g.fx+T/2-3-((i+1)*(T-6)/3),g.fy+T/2-3);}ctx.lineTo(g.fx-T/2+3,g.fy+T/2-3);ctx.closePath();ctx.fill();ctx.shadowBlur=0;});
  if(!alive){ctx.fillStyle='rgba(0,0,0,.8)';ctx.fillRect(0,0,420,420);ctx.fillStyle='#ffcc00';ctx.font='bold 26px Courier';ctx.textAlign='center';ctx.fillText('GAME OVER',210,195);ctx.fillStyle='#fff';ctx.font='14px Courier';ctx.fillText('SCORE: '+score,210,225);ctx.fillStyle='#00ff88';ctx.fillText('CLICK TO RESTART',210,255);}
}
document.addEventListener('keydown',e=>{const k=e.key;if(k==='ArrowLeft')ndir={x:-1,y:0};else if(k==='ArrowRight')ndir={x:1,y:0};else if(k==='ArrowUp')ndir={x:0,y:-1};else if(k==='ArrowDown')ndir={x:0,y:1};else return;e.preventDefault();});
c.addEventListener('click',()=>{if(!alive)start();});
let step=0;
function loop(){step++;if(step%8===0)update();draw();requestAnimationFrame(loop);}
start();loop();
</script></body></html>`,

'pong': () => `<!DOCTYPE html><html><head><style>
*{margin:0;padding:0;}body{background:#060910;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;font-family:'Courier New',monospace;}
#msg{color:#446688;font-size:12px;letter-spacing:2px;margin-top:10px;}
</style></head><body>
<canvas id="c" width="600" height="400"></canvas>
<div id="msg">W/S = LEFT PADDLE &nbsp;|&nbsp; ‚Üë‚Üì = RIGHT PADDLE</div>
<script>
const c=document.getElementById('c'),ctx=c.getContext('2d');
let p1={y:160,s:0},p2={y:160,s:0},ball={x:300,y:200,vx:4,vy:3},keys={},alive=true;
const PH=70,PW=12,BR=8;
function reset(dir){ball={x:300,y:200,vx:(4+Math.min(p1.s+p2.s,6)*0.3)*(dir||1),vy:(Math.random()*4-2)};}
function update(){
  if(!alive)return;
  if(keys['w'])p1.y=Math.max(0,p1.y-5);
  if(keys['s'])p1.y=Math.min(400-PH,p1.y+5);
  if(keys['ArrowUp'])p2.y=Math.max(0,p2.y-5);
  if(keys['ArrowDown'])p2.y=Math.min(400-PH,p2.y+5);
  ball.x+=ball.vx;ball.y+=ball.vy;
  if(ball.y<=BR||ball.y>=400-BR)ball.vy*=-1;
  if(ball.x-BR<=PW+10&&ball.y>p1.y&&ball.y<p1.y+PH){ball.vx=Math.abs(ball.vx)*1.05;ball.vy+=((ball.y-(p1.y+PH/2))/PH)*4;}
  if(ball.x+BR>=600-PW-10&&ball.y>p2.y&&ball.y<p2.y+PH){ball.vx=-Math.abs(ball.vx)*1.05;ball.vy+=((ball.y-(p2.y+PH/2))/PH)*4;}
  if(ball.x<0){p2.s++;reset(1);}
  if(ball.x>600){p1.s++;reset(-1);}
  if(p1.s>=7||p2.s>=7)alive=false;
}
function draw(){
  ctx.fillStyle='#060910';ctx.fillRect(0,0,600,400);
  ctx.setLineDash([10,10]);ctx.strokeStyle='#1a2a1a';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(300,0);ctx.lineTo(300,400);ctx.stroke();ctx.setLineDash([]);
  ctx.fillStyle='#fff';ctx.font='bold 48px Courier';ctx.textAlign='center';ctx.fillStyle='#00ff8844';ctx.fillText(p1.s,150,60);ctx.fillStyle='#00cfff44';ctx.fillText(p2.s,450,60);
  ctx.fillStyle='#00ff88';ctx.shadowColor='#00ff88';ctx.shadowBlur=12;ctx.fillRect(10,p1.y,PW,PH);
  ctx.fillStyle='#00cfff';ctx.shadowColor='#00cfff';ctx.fillRect(600-PW-10,p2.y,PW,PH);
  ctx.fillStyle='#fff';ctx.shadowColor='#fff';ctx.shadowBlur=15;ctx.beginPath();ctx.arc(ball.x,ball.y,BR,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;
  if(!alive){ctx.fillStyle='rgba(0,0,0,.8)';ctx.fillRect(0,0,600,400);ctx.fillStyle=p1.s>=7?'#00ff88':'#00cfff';ctx.font='bold 28px Courier';ctx.textAlign='center';ctx.fillText((p1.s>=7?'LEFT':'RIGHT')+' WINS!',300,185);ctx.fillStyle='#fff';ctx.font='14px Courier';ctx.fillText('CLICK TO REMATCH',300,220);}
}
document.addEventListener('keydown',e=>{keys[e.key]=true;if(['ArrowUp','ArrowDown',' '].includes(e.key))e.preventDefault();});
document.addEventListener('keyup',e=>keys[e.key]=false);
c.addEventListener('click',()=>{if(!alive){p1.s=0;p2.s=0;alive=true;reset(1);}});
function loop(){update();draw();requestAnimationFrame(loop);}
loop();
</script></body></html>`,

};

const games = [
  // glacierarcade.xyz ‚Äî 200+ games, no iframe blocking ‚úÖ
  { name:'SLOPE', emoji:'üîµ', cat:'action', url:'https://glacierarcade.xyz/html/slope.html', rating:'4.9', plays:'50M+', gif:'' },
  { name:'SLOPE 2', emoji:'üü£', cat:'action', url:'https://glacierarcade.xyz/html/slope2.html', rating:'4.8', plays:'20M+', gif:'' },
  { name:'SLOPE 3', emoji:'‚ö´', cat:'action', url:'https://glacierarcade.xyz/html/slope3.html', rating:'4.8', plays:'10M+', gif:'' },
  { name:'RUN 3', emoji:'üèÉ', cat:'action', url:'https://glacierarcade.xyz/html/run3.html', rating:'4.9', plays:'40M+', gif:'' },
  { name:'RETRO BOWL', emoji:'üèà', cat:'sports', url:'https://glacierarcade.xyz/html/retro-bowl.html', rating:'4.9', plays:'30M+', gif:'' },
  { name:'RETRO BOWL COLLEGE', emoji:'üèüÔ∏è', cat:'sports', url:'https://glacierarcade.xyz/html/retrobowlcollege.html', rating:'4.8', plays:'10M+', gif:'' },
  { name:'1V1.LOL', emoji:'üéØ', cat:'shooter', url:'https://glacierarcade.xyz/html/1v1lol.html', rating:'4.8', plays:'25M+', gif:'' },
  { name:'KRUNKER.IO', emoji:'üî´', cat:'shooter', url:'https://glacierarcade.xyz/html/krunkerio.html', rating:'4.9', plays:'15M+', gif:'' },
  { name:'SHELL SHOCKERS', emoji:'ü•ö', cat:'shooter', url:'https://glacierarcade.xyz/html/shell-shockers.html', rating:'4.8', plays:'10M+', gif:'' },
  { name:'DRIFT BOSS', emoji:'üöó', cat:'racing', url:'https://glacierarcade.xyz/html/drift-boss.html', rating:'4.8', plays:'15M+', gif:'' },
  { name:'DRIFT HUNTERS', emoji:'üèéÔ∏è', cat:'racing', url:'https://glacierarcade.xyz/html/drift-hunters.html', rating:'4.8', plays:'8M+', gif:'' },
  { name:'DRIVE MAD', emoji:'üöô', cat:'racing', url:'https://glacierarcade.xyz/html/drive-mad.html', rating:'4.7', plays:'10M+', gif:'' },
  { name:'MOTO X3M', emoji:'üèçÔ∏è', cat:'racing', url:'https://glacierarcade.xyz/html/motox3m.html', rating:'4.8', plays:'8M+', gif:'' },
  { name:'MOTO X3M 2', emoji:'üèçÔ∏è', cat:'racing', url:'https://glacierarcade.xyz/html/motox3m2.html', rating:'4.7', plays:'6M+', gif:'' },
  { name:'TANUKI SUNSET', emoji:'ü¶ù', cat:'racing', url:'https://glacierarcade.xyz/html/tanuki-sunset.html', rating:'4.7', plays:'4M+', gif:'' },
  { name:'PAPER.IO 2', emoji:'üìÑ', cat:'io', url:'https://glacierarcade.xyz/html/paperio2.html', rating:'4.7', plays:'20M+', gif:'' },
  { name:'SLITHER.IO', emoji:'üêç', cat:'io', url:'https://glacierarcade.xyz/html/slither-io.html', rating:'4.9', plays:'50M+', gif:'' },
  { name:'HOLE.IO', emoji:'üï≥Ô∏è', cat:'io', url:'https://glacierarcade.xyz/html/hole-io.html', rating:'4.6', plays:'10M+', gif:'' },
  { name:'MINECRAFT', emoji:'‚õèÔ∏è', cat:'action', url:'https://glacierarcade.xyz/html/minecraft.html', rating:'4.9', plays:'50M+', gif:'' },
  { name:'MINECRAFT PARKOUR', emoji:'üèÉ', cat:'action', url:'https://glacierarcade.xyz/html/minecraft-parkour.html', rating:'4.7', plays:'5M+', gif:'' },
  { name:'SUBWAY SURFERS', emoji:'üõπ', cat:'action', url:'https://glacierarcade.xyz/html/subway-surfers.html', rating:'4.9', plays:'80M+', gif:'' },
  { name:'TEMPLE RUN 2', emoji:'üå¥', cat:'action', url:'https://glacierarcade.xyz/html/temple-run-2.html', rating:'4.8', plays:'40M+', gif:'' },
  { name:'GEOMETRY DASH', emoji:'üî∑', cat:'action', url:'https://glacierarcade.xyz/html/gdlite.html', rating:'4.8', plays:'15M+', gif:'' },
  { name:'STICKMAN HOOK', emoji:'üï∏Ô∏è', cat:'action', url:'https://glacierarcade.xyz/html/stickman-hook.html', rating:'4.8', plays:'12M+', gif:'' },
  { name:'TUNNEL RUSH', emoji:'üî¥', cat:'action', url:'https://glacierarcade.xyz/html/tunnel-rush.html', rating:'4.8', plays:'10M+', gif:'' },
  { name:'CLUSTER RUSH', emoji:'üöõ', cat:'action', url:'https://glacierarcade.xyz/html/cluster-rush.html', rating:'4.7', plays:'5M+', gif:'' },
  { name:'GETAWAY SHOOTOUT', emoji:'üí®', cat:'shooter', url:'https://glacierarcade.xyz/html/getaway-shootout.html', rating:'4.7', plays:'8M+', gif:'' },
  { name:'ROOFTOP SNIPERS', emoji:'üèôÔ∏è', cat:'shooter', url:'https://glacierarcade.xyz/html/rooftop-snipers.html', rating:'4.7', plays:'7M+', gif:'' },
  { name:'FUNNY SHOOTER 2', emoji:'üòÇ', cat:'shooter', url:'https://glacierarcade.xyz/html/funny-shooter-2.html', rating:'4.6', plays:'5M+', gif:'' },
  { name:'SMASH KARTS', emoji:'üèéÔ∏è', cat:'racing', url:'https://glacierarcade.xyz/html/smash-karts.html', rating:'4.8', plays:'12M+', gif:'' },
  { name:'COOKIE CLICKER', emoji:'üç™', cat:'classic', url:'https://glacierarcade.xyz/html/cookie-clicker.html', rating:'4.6', plays:'10M+', gif:'' },
  { name:'PACMAN', emoji:'üëæ', cat:'classic', url:'https://glacierarcade.xyz/html/pacman.html', rating:'4.9', plays:'1B+', gif:'' },
  { name:'TETRIS', emoji:'üü¶', cat:'classic', url:'https://glacierarcade.xyz/html/tetris.html', rating:'4.9', plays:'1B+', gif:'' },
  { name:'SNAKE', emoji:'üêç', cat:'classic', url:'https://glacierarcade.xyz/html/snake.html', rating:'4.7', plays:'500M+', gif:'' },
  { name:'FLAPPY BIRD', emoji:'üê§', cat:'classic', url:'https://glacierarcade.xyz/html/flappy-bird.html', rating:'4.5', plays:'100M+', gif:'' },
  { name:'CHROME DINO', emoji:'ü¶ñ', cat:'classic', url:'https://glacierarcade.xyz/html/chrome-dino.html', rating:'4.8', plays:'200M+', gif:'' },
  { name:'PLANTS VS ZOMBIES', emoji:'üåª', cat:'action', url:'https://glacierarcade.xyz/html/pvz.html', rating:'4.8', plays:'50M+', gif:'' },
  { name:'FNAF', emoji:'üêª', cat:'action', url:'https://glacierarcade.xyz/html/fnaf.html', rating:'4.7', plays:'8M+', gif:'' },
  { name:'FRIDAY NIGHT FUNKIN', emoji:'üé§', cat:'classic', url:'https://glacierarcade.xyz/html/fnf.html', rating:'4.8', plays:'20M+', gif:'' },
  { name:'BLOONS TD 5', emoji:'üéà', cat:'puzzle', url:'https://glacierarcade.xyz/html/btd5.html', rating:'4.8', plays:'15M+', gif:'' },
  { name:'CHESS', emoji:'‚ôüÔ∏è', cat:'puzzle', url:'https://glacierarcade.xyz/html/chess.html', rating:'4.9', plays:'50M+', gif:'' },
  { name:'WORDLE', emoji:'üü©', cat:'puzzle', url:'https://glacierarcade.xyz/html/wordle.html', rating:'4.8', plays:'30M+', gif:'' },
  { name:'BASKET RANDOM', emoji:'üèÄ', cat:'sports', url:'https://glacierarcade.xyz/html/basket-random.html', rating:'4.7', plays:'5M+', gif:'' },
  { name:'SOCCER RANDOM', emoji:'‚öΩ', cat:'sports', url:'https://glacierarcade.xyz/html/soccer-random.html', rating:'4.6', plays:'4M+', gif:'' },
  { name:'BOXING RANDOM', emoji:'ü•ä', cat:'sports', url:'https://glacierarcade.xyz/html/boxing-random.html', rating:'4.7', plays:'4M+', gif:'' },
  { name:'VOLLEY RANDOM', emoji:'üèê', cat:'sports', url:'https://glacierarcade.xyz/html/volley-random.html', rating:'4.5', plays:'3M+', gif:'' },
  { name:'HAPPY WHEELS', emoji:'üõû', cat:'action', url:'https://glacierarcade.xyz/html/happy-wheels-fanmade.html', rating:'4.7', plays:'10M+', gif:'' },
  { name:'VEX 5', emoji:'üèÉ', cat:'action', url:'https://glacierarcade.xyz/html/vex5.html', rating:'4.7', plays:'6M+', gif:'' },
  { name:'OVO', emoji:'üü°', cat:'action', url:'https://glacierarcade.xyz/html/ovo.html', rating:'4.7', plays:'5M+', gif:'' },
  { name:'MADALIN STUNT CARS 2', emoji:'üöò', cat:'racing', url:'https://glacierarcade.xyz/html/madalin-stunt-cars-2.html', rating:'4.7', plays:'8M+', gif:'' },
];


let activeGameCat = 'all';

function renderGames(list) {
  document.getElementById('gamesGrid').innerHTML = list.map(g => `
    <div class="game-card" onclick="openGame('${g.name}','${g.emoji}','${g.game||g.url}')">
      <div class="game-thumb" style="position:relative;overflow:hidden;">
        <span style="font-size:2.5rem;position:relative;z-index:2;">${g.emoji}</span>
        <div style="position:absolute;inset:0;background:linear-gradient(to bottom,transparent 60%,rgba(0,0,0,.7));z-index:3;pointer-events:none;"></div>
      </div>
      <div class="game-info">
        <div class="game-name">${g.name}</div>
        <div class="game-meta"><span class="game-rating">‚òÖ ${g.rating}</span><span>${g.plays}</span></div>
      </div>
    </div>`).join('');
}

function setGameCat(btn, cat) {
  document.querySelectorAll('.cat-pill').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  activeGameCat = cat;
  filterGames(document.getElementById('gameSearch').value);
}

function filterGames(q) {
  let list = activeGameCat === 'all' ? games : games.filter(g => g.cat === activeGameCat);
  if (q) list = list.filter(g => g.name.toLowerCase().includes(q.toLowerCase()));
  renderGames(list);
}

function openGame(name, emoji, gameKey) {
  // Screen shake + flash
  const flash = document.getElementById('flashOverlay');
  flash.style.transition = 'opacity 0s';
  flash.style.opacity = '0.5';
  document.getElementById('main').classList.add('shake');
  setTimeout(() => { flash.style.transition = 'opacity 0.4s ease'; flash.style.opacity = '0'; document.getElementById('main').classList.remove('shake'); }, 80);

  showLoader();
  document.getElementById('currentGameName').textContent = emoji + ' ' + name;
  document.getElementById('gamesContent').style.display = 'none';
  document.getElementById('gamesBack').style.display = 'flex';
  const frame = document.getElementById('gamesFrame');
  frame.style.display = 'block';
  const helper = document.getElementById('gameBlockHelper');
  if (helper) helper.remove();

  // Built-in game (blob URL) or external URL
  if (BUILTIN_GAMES[gameKey]) {
    const htmlStr = BUILTIN_GAMES[gameKey]();
    const blob = new Blob([htmlStr], {type: 'text/html'});
    const blobUrl = URL.createObjectURL(blob);
    frame.innerHTML = '<iframe src="' + blobUrl + '" style="width:100%;height:100%;border:none;" allowfullscreen></iframe>';
  } else {
    frame.innerHTML = '<iframe src="' + gameKey + '" style="width:100%;height:100%;border:none;" allowfullscreen allow="fullscreen *; autoplay *"></iframe>';
  }
  showToast('üéÆ LOADING', name, 'var(--g)');
}

function closeGameFrame() {
  const frame = document.getElementById('gamesFrame');
  frame.innerHTML = '';
  frame.style.display = 'none';
  document.getElementById('gamesContent').style.display = 'block';
  document.getElementById('gamesBack').style.display = 'none';
  const helper = document.getElementById('gameBlockHelper');
  if (helper) helper.remove();
}

function showGameBlockedHelper(name, url) {
  const frame = document.getElementById('gamesFrame');
  // inject a message into the frame area via overlay
  const overlay = document.createElement('div');
  overlay.id = 'gameBlockHelper';
  overlay.style.cssText = 'position:absolute;inset:0;background:rgba(6,9,16,.95);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;z-index:50;';
  overlay.innerHTML = `
    <div style="font-size:2.5rem;">üö´</div>
    <div style="font-family:'Orbitron',sans-serif;font-size:.8rem;color:var(--p);letter-spacing:3px;">BLOCKED BY SCHOOL</div>
    <div style="font-size:.68rem;color:#446688;letter-spacing:1px;text-align:center;max-width:320px;line-height:1.8;">GoGuardian is blocking this game.<br>Open it through your unblocker instead:</div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;">
      <button onclick="document.getElementById('gamesFrame').src='https://learn.szczech.com.ar/';document.getElementById('gameBlockHelper').remove();" style="background:rgba(255,204,0,.1);border:1px solid var(--y);color:var(--y);padding:10px 18px;font-family:'Orbitron',monospace;font-size:.63rem;font-weight:700;letter-spacing:2px;border-radius:3px;cursor:pointer;">üîì UNBLOCKER 1</button>
      <button onclick="document.getElementById('gamesFrame').src='https://outerspace.is-a.software/&';document.getElementById('gameBlockHelper').remove();" style="background:rgba(255,204,0,.1);border:1px solid var(--y);color:var(--y);padding:10px 18px;font-family:'Orbitron',monospace;font-size:.63rem;font-weight:700;letter-spacing:2px;border-radius:3px;cursor:pointer;">üöÄ UNBLOCKER 2</button>
      <button onclick="window.open('${url}','_blank');document.getElementById('gameBlockHelper').remove();" style="background:rgba(0,207,255,.1);border:1px solid var(--b);color:var(--b);padding:10px 18px;font-family:'Orbitron',monospace;font-size:.63rem;font-weight:700;letter-spacing:2px;border-radius:3px;cursor:pointer;">‚Üó NEW TAB</button>
    </div>
    <button onclick="document.getElementById('gameBlockHelper').remove();closeGameFrame();" style="background:none;border:none;color:#334455;font-family:'Share Tech Mono',monospace;font-size:.6rem;cursor:pointer;letter-spacing:1px;">‚Üê BACK</button>
  `;
  const container = document.getElementById('gamesMain');
  container.style.position = 'relative';
  // remove old if exists
  const old = document.getElementById('gameBlockHelper');
  if (old) old.remove();
  container.appendChild(overlay);
}

function closeGameFrame() {
  const frame = document.getElementById('gamesFrame');
  clearTimeout(frame._gameTimer);
  frame.src = 'about:blank';
  frame.style.display = 'none';
  document.getElementById('gamesContent').style.display = 'block';
  document.getElementById('gamesBack').style.display = 'none';
  const helper = document.getElementById('gameBlockHelper');
  if (helper) helper.remove();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MUSIC
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let audioEl = new Audio();
let musicPlaying = false;
let currentMusicIndex = -1;
let musicQueue = [];
let repeatMode = false;

// ‚îÄ‚îÄ MUSIC: Uses iTunes Search API (no key, no CORS issues) + YouTube embed for playback
let ytPlayer = null;
let ytReady = false;
let pendingVideoId = null;

// Load YouTube IFrame API
(function() {
  const tag = document.createElement('script');
  tag.src = 'https://www.youtube.com/iframe_api';
  document.head.appendChild(tag);
})();

function onYouTubeIframeAPIReady() {
  ytReady = true;
  // Create hidden YT player in music panel
  const div = document.createElement('div');
  div.id = 'ytPlayerDiv';
  div.style.cssText = 'position:absolute;opacity:0;pointer-events:none;width:1px;height:1px;';
  document.body.appendChild(div);
  ytPlayer = new YT.Player('ytPlayerDiv', {
    height: '1', width: '1',
    playerVars: { autoplay: 0, controls: 0 },
    events: {
      onReady: () => { if (pendingVideoId) playYT(pendingVideoId); },
      onStateChange: (e) => {
        if (e.data === YT.PlayerState.PLAYING) {
          musicPlaying = true;
          document.getElementById('playPauseBtn').textContent = '‚è∏';
          document.getElementById('waveformEl').classList.remove('paused');
          startYTProgress();
        } else if (e.data === YT.PlayerState.PAUSED) {
          musicPlaying = false;
          document.getElementById('playPauseBtn').textContent = '‚ñ∂';
          document.getElementById('waveformEl').classList.add('paused');
        } else if (e.data === YT.PlayerState.ENDED) {
          if (repeatMode) ytPlayer.playVideo();
          else nextTrack();
        }
      }
    }
  });
}

let ytProgressTimer = null;
function startYTProgress() {
  clearInterval(ytProgressTimer);
  ytProgressTimer = setInterval(() => {
    if (!ytPlayer || !ytPlayer.getDuration) return;
    const cur = ytPlayer.getCurrentTime() || 0;
    const dur = ytPlayer.getDuration() || 0;
    if (dur > 0) {
      document.getElementById('progressFill').style.width = (cur/dur*100) + '%';
      document.getElementById('timeCur').textContent = fmtTime(cur);
      document.getElementById('timeTot').textContent = fmtTime(dur);
    }
  }, 500);
}

function playYT(videoId) {
  if (!ytPlayer || !ytReady) { pendingVideoId = videoId; return; }
  pendingVideoId = null;
  ytPlayer.loadVideoById(videoId);
  ytPlayer.setVolume(document.querySelector('input.vol')?.value || 80);
}

async function getYouTubeVideoId(query) {
  // Use YouTube's oEmbed + search via Invidious public API (no key needed)
  const instances = [
    'https://inv.nadeko.net',
    'https://invidious.slipfox.xyz',
    'https://invidious.privacydev.net',
  ];
  for (const base of instances) {
    try {
      const r = await fetch(`${base}/api/v1/search?q=${encodeURIComponent(query)}&type=video&fields=videoId,title,author&page=1`, { signal: AbortSignal.timeout(4000) });
      if (!r.ok) continue;
      const data = await r.json();
      if (data && data[0]) return data[0].videoId;
    } catch(e) { continue; }
  }
  return null;
}

async function searchMusic() {
  const q = document.getElementById('musicSearch').value.trim();
  if (!q) return;
  const res = document.getElementById('musicResults');
  res.innerHTML = '<div style="padding:16px 10px;display:flex;align-items:center;gap:10px;"><div class="spinner"></div><span style="font-size:.63rem;color:#446688;">Searching...</span></div>';
  try {
    // iTunes Search API ‚Äî totally free, no key, no CORS
    const r = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(q)}&media=music&limit=25&entity=song`);
    const data = await r.json();
    musicQueue = (data.results || []).map(t => ({
      title: t.trackName,
      artist: t.artistName,
      album: t.collectionName,
      duration: Math.floor(t.trackTimeMillis / 1000),
      preview: t.previewUrl, // 30s preview always available
      artwork: t.artworkUrl100?.replace('100x100', '300x300'),
      searchQuery: `${t.artistName} ${t.trackName}`,
    }));
    if (!musicQueue.length) {
      res.innerHTML = '<div style="padding:16px 10px;font-size:.63rem;color:#446688;">No results found.</div>';
      return;
    }
    res.innerHTML = musicQueue.map((t,i) => `
      <div class="music-result" id="mr-${i}" onclick="playTrack(${i})">
        <div class="result-num">${i+1}</div>
        <div class="result-info">
          <div class="result-title">${t.title}</div>
          <div class="result-artist">${t.artist}</div>
        </div>
        <div class="result-dur">${fmtTime(t.duration)}</div>
      </div>`).join('');
  } catch(e) {
    res.innerHTML = '<div style="padding:16px 10px;font-size:.63rem;color:#556688;">Search failed ‚Äî check your connection.</div>';
  }
}

async function playTrack(i) {
  if (i < 0 || i >= musicQueue.length) return;
  currentMusicIndex = i;
  const t = musicQueue[i];

  document.querySelectorAll('.music-result').forEach(el => el.classList.remove('playing'));
  const el = document.getElementById('mr-' + i);
  if (el) el.classList.add('playing');

  document.getElementById('nowTitle').textContent = t.title;
  document.getElementById('nowArtist').textContent = t.artist;

  // Show artwork
  const artEl = document.getElementById('nowArtwork');
  if (t.artwork) {
    artEl.style.cssText = 'position:relative;z-index:1;width:100%;height:100%;object-fit:cover;border-radius:8px;';
    artEl.outerHTML = `<img id="nowArtwork" src="${t.artwork}" style="position:relative;z-index:1;width:100%;height:100%;object-fit:cover;border-radius:8px;" onerror="this.outerHTML='<span id=nowArtwork style=position:relative;z-index:1;font-size:4rem>üéµ</span>'">`;
  } else {
    document.getElementById('nowArtwork').textContent = 'üéµ';
  }

  document.getElementById('lyricsPanel').innerHTML = `
    <div class="lyric-placeholder">‚ô¨ ${t.title}</div>
    <div class="lyric-placeholder" style="margin-top:6px;font-size:.6rem;">by ${t.artist}</div>
    <div class="lyric-placeholder" style="margin-top:6px;font-size:.58rem;color:#224433;">üíø ${t.album||''}</div>
    <div class="lyric-placeholder" style="margin-top:16px;font-size:.58rem;color:#1a3322;" id="musicSourceLabel">Loading full song...</div>`;

  // Try full song via YouTube first, fallback to iTunes 30s preview
  const videoId = await getYouTubeVideoId(t.searchQuery);
  if (videoId) {
    document.getElementById('musicSourceLabel').textContent = '‚ñ∂ Full song via YouTube';
    playYT(videoId);
    audioEl.pause(); // stop any preview
  } else if (t.preview) {
    document.getElementById('musicSourceLabel').textContent = '‚ñ∂ 30s preview ¬∑ iTunes';
    if (ytPlayer) ytPlayer.stopVideo();
    audioEl.src = t.preview;
    audioEl.play();
    musicPlaying = true;
    document.getElementById('playPauseBtn').textContent = '‚è∏';
    document.getElementById('waveformEl').classList.remove('paused');
  } else {
    document.getElementById('musicSourceLabel').textContent = '‚ùå No audio available';
  }
}

audioEl.addEventListener('timeupdate', () => {
  if (!audioEl.duration) return;
  const pct = (audioEl.currentTime / audioEl.duration) * 100;
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('timeCur').textContent = fmtTime(Math.floor(audioEl.currentTime));
  document.getElementById('timeTot').textContent = fmtTime(Math.floor(audioEl.duration));
});
audioEl.addEventListener('ended', () => { if (repeatMode) { audioEl.play(); return; } nextTrack(); });

function seekAudio(e) {
  const b = document.getElementById('progressBar');
  const pct = e.offsetX / b.offsetWidth;
  if (ytPlayer && musicPlaying && ytPlayer.getDuration) {
    ytPlayer.seekTo(ytPlayer.getDuration() * pct, true);
  } else {
    audioEl.currentTime = audioEl.duration * pct;
  }
}

function toggleMusicPlay() {
  if (musicPlaying) {
    if (ytPlayer && ytPlayer.getPlayerState && ytPlayer.getPlayerState() === 1) ytPlayer.pauseVideo();
    else { audioEl.pause(); musicPlaying=false; document.getElementById('playPauseBtn').textContent='‚ñ∂'; document.getElementById('waveformEl').classList.add('paused'); }
  } else {
    if (ytPlayer && ytPlayer.getPlayerState && ytPlayer.getPlayerState() === 2) ytPlayer.playVideo();
    else { audioEl.play(); musicPlaying=true; document.getElementById('playPauseBtn').textContent='‚è∏'; document.getElementById('waveformEl').classList.remove('paused'); }
  }
}
function nextTrack() { if (musicQueue.length) playTrack((currentMusicIndex+1)%musicQueue.length); }
function prevTrack() { if (musicQueue.length) playTrack((currentMusicIndex-1+musicQueue.length)%musicQueue.length); }
function shuffleTrack() { if (musicQueue.length) playTrack(Math.floor(Math.random()*musicQueue.length)); }
function toggleRepeat() { repeatMode=!repeatMode; document.getElementById('repeatBtn').style.color=repeatMode?'var(--g)':''; }
function setMusicVol(v) {
  audioEl.volume = v/100;
  if (ytPlayer && ytPlayer.setVolume) ytPlayer.setVolume(v);
}
function fmtTime(s) { s=Math.floor(s)||0; return Math.floor(s/60)+':'+String(s%60).padStart(2,'0'); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setAITool(id, btn) {
  document.querySelectorAll('.ai-tool-content').forEach(el=>el.classList.remove('active'));
  document.querySelectorAll('.ai-tool-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('aitool-'+id).classList.add('active');
  btn.classList.add('active');
}

function addMsg(container, role, text) {
  const d = document.createElement('div');
  d.className = 'msg ' + role;
  d.innerHTML = `<div class="msg-avatar">${role==='ai'?'ü§ñ':'üë§'}</div><div class="msg-bubble">${text}</div>`;
  document.getElementById(container).appendChild(d);
  document.getElementById(container).scrollTop = 99999;
  return d;
}

async function callClaude(prompt, system='') {
  const body = { model:'claude-sonnet-4-20250514', max_tokens:1000, messages:[{role:'user',content:prompt}] };
  if (system) body.system = system;
  const res = await fetch('https://api.anthropic.com/v1/messages', {
    method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body)
  });
  const data = await res.json();
  return data.content?.map(c=>c.text||'').join('')||'No response.';
}

async function sendChat() {
  const inp = document.getElementById('chatInput');
  const msg = inp.value.trim(); if (!msg) return;
  inp.value = '';
  addMsg('chatMessages','user',msg);
  const waiting = addMsg('chatMessages','ai','<div class="spinner"></div>');
  try {
    const reply = await callClaude(msg,'You are StudyBot, a helpful academic assistant. Help with homework, studying, and learning.');
    waiting.querySelector('.msg-bubble').innerHTML = reply;
  } catch(e) { waiting.querySelector('.msg-bubble').innerHTML = 'Error. Try again.'; }
}

function generateImage() {
  const prompt = document.getElementById('imgPrompt').value.trim(); if (!prompt) return;
  const out = document.getElementById('imgOutput');
  out.innerHTML = '<div class="spinner"></div><span style="font-size:.7rem;color:#446688;margin-top:8px;">Generating...</span>';
  const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=512&height=512&nologo=true&seed=${Date.now()}`;
  const img = new Image();
  img.onload = () => { out.innerHTML=''; out.appendChild(img); };
  img.onerror = () => { out.innerHTML='<span style="color:#556677;">Failed. Try another prompt.</span>'; };
  img.src = url;
  img.style.cssText = 'width:100%;height:100%;object-fit:cover;border-radius:8px;';
}

async function doTranslate() {
  const text = document.getElementById('translateIn').value.trim(); if (!text) return;
  document.getElementById('translateOut').value = 'Translating...';
  try {
    const to = document.getElementById('toLang').value;
    const from = document.getElementById('fromLang').value;
    const reply = await callClaude(`Translate${from!=='auto'?' from '+from:''} to ${to}. Reply ONLY with the translation:\n\n${text}`);
    document.getElementById('translateOut').value = reply;
  } catch(e) { document.getElementById('translateOut').value = 'Failed.'; }
}

async function doSummarize() {
  const text = document.getElementById('summarizeIn').value.trim(); if (!text) return;
  document.getElementById('summarizeOut').textContent = 'Summarizing...';
  try {
    const reply = await callClaude('Summarize in 3-5 bullet points:\n\n' + text);
    document.getElementById('summarizeOut').textContent = reply;
  } catch(e) { document.getElementById('summarizeOut').textContent = 'Failed.'; }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// APPS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const UNBLOCKER_URL = 'https://outerspace.is-a.software/&';

const apps = [
  {icon:'üîì',name:'RESOURCE HUB 1',desc:'Extended learning portal & tools',tag:'unblock',url:'https://learn.szczech.com.ar/',mode:'direct'},
  {icon:'üöÄ',name:'RESOURCE HUB 2',desc:'Academic resource gateway',tag:'unblock',url:'https://outerspace.is-a.software/&',mode:'direct'},
  {icon:'üì∫',name:'YOUTUBE',desc:'Watch videos & shorts',tag:'blocked',url:'https://www.youtube.com',mode:'routed'},
  {icon:'üí¨',name:'DISCORD',desc:'Chat with friends',tag:'blocked',url:'https://discord.com/app',mode:'routed'},
  {icon:'üéÆ',name:'ROBLOX',desc:'Play Roblox online',tag:'blocked',url:'https://www.roblox.com',mode:'routed'},
  {icon:'üéµ',name:'SPOTIFY',desc:'Stream music',tag:'blocked',url:'https://open.spotify.com',mode:'routed'},
  {icon:'üü†',name:'REDDIT',desc:'Browse communities',tag:'blocked',url:'https://www.reddit.com',mode:'routed'},
  {icon:'üê¶',name:'TWITTER/X',desc:'Posts & trending news',tag:'blocked',url:'https://twitter.com',mode:'routed'},
  {icon:'üé¨',name:'TWITCH',desc:'Live game streaming',tag:'blocked',url:'https://www.twitch.tv',mode:'routed'},
  {icon:'üì∏',name:'INSTAGRAM',desc:'Photos & reels',tag:'blocked',url:'https://www.instagram.com',mode:'routed'},
  {icon:'ü§ñ',name:'CHATGPT',desc:'OpenAI chatbot',tag:'blocked',url:'https://chat.openai.com',mode:'routed'},
  {icon:'üéµ',name:'TIKTOK',desc:'Short videos',tag:'blocked',url:'https://www.tiktok.com',mode:'routed'},
  {icon:'üëª',name:'SNAPCHAT',desc:'Snaps & stories',tag:'blocked',url:'https://web.snapchat.com',mode:'routed'},
  {icon:'üéÆ',name:'STEAM',desc:'PC gaming platform',tag:'blocked',url:'https://store.steampowered.com',mode:'routed'},
  {icon:'üé•',name:'NETFLIX',desc:'Stream movies & shows',tag:'blocked',url:'https://www.netflix.com',mode:'routed'},
  {icon:'üé•',name:'CINEBY',desc:'Free movies & shows',tag:'free',url:'https://www.cineby.gd',mode:'direct'},
  {icon:'üìΩÔ∏è',name:'HEARTIVE',desc:'Movies, series & live TV',tag:'free',url:'https://heartiveloves.pages.dev',mode:'direct'},
  {icon:'üßÆ',name:'DESMOS',desc:'Graphing calculator',tag:'free',url:'https://www.desmos.com/calculator',mode:'direct'},
  {icon:'üåç',name:'WIKIPEDIA',desc:'All human knowledge',tag:'free',url:'https://en.m.wikipedia.org',mode:'direct'},
  {icon:'üìö',name:'KHAN ACADEMY',desc:'Free lessons & practice',tag:'free',url:'https://www.khanacademy.org',mode:'direct'},
  {icon:'üó∫Ô∏è',name:'GOOGLE MAPS',desc:'Maps & directions',tag:'free',url:'https://maps.google.com/maps?output=embed',mode:'direct'},
  {icon:'üìñ',name:'GUTENBERG',desc:'10,000+ free classic books',tag:'free',url:'https://www.gutenberg.org',mode:'direct'},
  {icon:'üéÆ',name:'COOLMATHGAMES',desc:'Math & puzzle games',tag:'free',url:'https://www.coolmathgames.com',mode:'direct'},
  {icon:'üïπÔ∏è',name:'POKI',desc:'100s of free browser games',tag:'free',url:'https://poki.com',mode:'direct'},
  {icon:'üì∞',name:'GOOGLE SCHOLAR',desc:'Research & papers',tag:'free',url:'https://scholar.google.com',mode:'direct'},
  {icon:'üåê',name:'GOOGLE TRANSLATE',desc:'Translate any language',tag:'free',url:'https://translate.google.com',mode:'direct'},
  {icon:'üé®',name:'SKETCHPAD',desc:'Draw & create art online',tag:'free',url:'https://sketch.io/sketchpad/',mode:'direct'},
  {icon:'üéµ',name:'SOUNDCLOUD',desc:'Free music & podcasts',tag:'free',url:'https://soundcloud.com',mode:'direct'},
  {icon:'üìù',name:'GOOGLE DOCS',desc:'Write & collaborate',tag:'free',url:'https://docs.google.com',mode:'direct'},
  {icon:'üìä',name:'GOOGLE SLIDES',desc:'Make presentations',tag:'free',url:'https://slides.google.com',mode:'direct'},
  {icon:'üî¢',name:'GOOGLE SHEETS',desc:'Spreadsheets online',tag:'free',url:'https://sheets.google.com',mode:'direct'},
  {icon:'üîé',name:'PERPLEXITY AI',desc:'AI-powered search',tag:'free',url:'https://www.perplexity.ai',mode:'direct'},
  {icon:'üí°',name:'QUIZLET',desc:'Flashcards & study tools',tag:'free',url:'https://quizlet.com',mode:'direct'},
  {icon:'üß†',name:'BRAINPOP',desc:'Educational videos & quizzes',tag:'free',url:'https://www.brainpop.com',mode:'direct'},
  {icon:'üéØ',name:'GIMKIT',desc:'Fun learning games',tag:'free',url:'https://www.gimkit.com',mode:'direct'},
  {icon:'üïπÔ∏è',name:'GAMEFLARE',desc:'Free HTML5 games',tag:'free',url:'https://gameflare.com',mode:'direct'},
];

let currentAppUrl = '';

// Proxy services that strip X-Frame-Options headers so sites load in iframes
const IFRAME_PROXIES = [
  url => `https://outerspace.is-a.software/&`,
  url => `https://corsproxy.io/?${encodeURIComponent(url)}`,
  url => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
];
let proxyIndex = 0;

function openApp(url, name, mode) {
  currentAppUrl = url;
  document.getElementById('appsListView').style.display = 'none';
  document.getElementById('appViewer').style.display = 'flex';
  document.getElementById('appViewerName').textContent = name;
  document.getElementById('appBlockedMsg').style.display = 'none';
  const frame = document.getElementById('appFrame');
  frame.style.display = 'block';
  if (mode === 'routed') {
    // Open blocked sites via Equinox unblocker
    frame.src = UNBLOCKER_URL;
    // After Equinox loads, user can navigate to the site inside it
    // Show a helpful tip
    setTimeout(() => {
      document.getElementById('appViewerName').textContent = name + ' ‚Äî search it inside Equinox ‚Üë';
    }, 1500);
  } else {
    // Load direct
    frame.src = url;
  }
}

function loadInFrame(url) {
  document.getElementById('appFrame').src = url;
}

function tryNextProxy() {
  showAppBlocked();
}

function showAppBlocked() {
  document.getElementById('appFrame').style.display = 'none';
  document.getElementById('appBlockedMsg').style.display = 'flex';
}

function closeAppViewer() {
  const frame = document.getElementById('appFrame');
  clearTimeout(frame._timer);
  frame.src = 'about:blank';
  document.getElementById('appViewer').style.display = 'none';
  document.getElementById('appsListView').style.display = 'flex';
  document.getElementById('appBlockedMsg').style.display = 'none';
  frame.style.display = 'block';
}

function openCurrentAppNewTab() {
  window.open(currentAppUrl, '_blank');
}

document.getElementById('appsGrid').innerHTML = apps.map(a=>`
  <div class="app-card${a.tag==='unblock'?' featured':''}" onclick="openApp('${a.url}','${a.icon} ${a.name}','${a.mode}')">
    <div class="app-icon">${a.icon}</div>
    <div class="app-name">${a.name}</div>
    <div class="app-desc">${a.desc}</div>
    <span class="app-tag ${a.tag}">${
      a.tag==='unblock'?'üîó PORTAL':
      a.tag==='blocked'?'üîì VIA PROXY':
      '‚úÖ FREE'
    }</span>
  </div>`).join('');

// Focus the hidden input immediately
window.addEventListener('load', () => {
  document.getElementById('coverPass').focus();
  initSplash();
  initMatrix();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SPLASH SCREEN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initSplash() {
  const bar = document.getElementById('splashBar');
  const splash = document.getElementById('splashScreen');
  let w = 0;
  const msgs = ['INITIALIZING...','LOADING GAMES...','STARTING MUSIC...','UNLOCKING...','READY'];
  let mi = 0;
  const verEl = splash.querySelector('.splash-ver');
  const iv = setInterval(() => {
    w += Math.random() * 18 + 6;
    if (w >= 100) { w = 100; clearInterval(iv); }
    bar.style.width = w + '%';
    if (w > mi * 20 && mi < msgs.length) {
      verEl.textContent = msgs[mi++];
    }
  }, 120);
  setTimeout(() => {
    splash.style.opacity = '0';
    setTimeout(() => splash.style.display = 'none', 500);
  }, 1800);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MATRIX RAIN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initMatrix() {
  const canvas = document.getElementById('matrixCanvas');
  const ctx = canvas.getContext('2d');
  function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
  resize();
  window.addEventListener('resize', resize);
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()ÔæäÔæãÔΩºÔæÇÔΩ≥ÔΩ¶ÔæÖÔæêÔæèÔæëÔæíÔΩµÔæéÔæèÔΩ±ÔΩªÔæùÔæäÔΩªÔΩÆÔΩ±ÔΩΩÔæíÔΩ¥ÔΩ∂ÔΩ∑ÔΩ∏ÔΩπÔΩ∫';
  const fontSize = 13;
  let cols = Math.floor(canvas.width / fontSize);
  let drops = Array(cols).fill(1);
  const accent = getComputedStyle(document.documentElement).getPropertyValue('--g').trim() || '#00ff88';
  setInterval(() => {
    ctx.fillStyle = 'rgba(6,9,16,0.05)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = accent;
    ctx.font = fontSize + 'px Share Tech Mono, monospace';
    cols = Math.floor(canvas.width / fontSize);
    if (drops.length !== cols) drops = Array(cols).fill(1);
    for (let i = 0; i < drops.length; i++) {
      const char = chars[Math.floor(Math.random() * chars.length)];
      ctx.globalAlpha = Math.random() * 0.5 + 0.3;
      ctx.fillText(char, i * fontSize, drops[i] * fontSize);
      ctx.globalAlpha = 1;
      if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
      drops[i]++;
    }
  }, 50);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NEON LOADER BAR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function runLoader() {
  const bar = document.getElementById('neonLoader');
  if (!bar) return;
  bar.classList.remove('done');
  bar.style.cssText = 'transition:none;width:0%;opacity:1;';
  bar.offsetHeight;
  bar.style.cssText = 'transition:width .5s ease;width:100%;opacity:1;';
  setTimeout(() => {
    bar.style.cssText = 'transition:opacity .4s ease;width:100%;opacity:0;';
    setTimeout(() => { bar.style.width = '0%'; }, 450);
  }, 520);
}
function showLoader() { runLoader(); }

// Loader fires on tab click without overriding switchPage

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOAST NOTIFICATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showToast(title, msg, color='var(--g)') {
  const container = document.getElementById('toastContainer');
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.style.borderColor = color;
  toast.style.boxShadow = `0 0 20px ${color}40`;
  toast.innerHTML = `<div class="toast-title" style="color:${color}">${title}</div>${msg}`;
  container.appendChild(toast);
  toast.addEventListener('click', () => toast.remove());
  setTimeout(() => { try { toast.remove(); } catch(e){} }, 4200);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FIREWORKS / CONFETTI ON UNLOCK
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function spawnFireworks() {
  const canvas = document.createElement('canvas');
  canvas.style.cssText = 'position:fixed;inset:0;z-index:99994;pointer-events:none;';
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  document.body.appendChild(canvas);
  const ctx = canvas.getContext('2d');
  const particles = [];
  const colors = ['#00ff88','#00cfff','#ff00aa','#ffcc00','#ff6600','#a855f7'];

  function spawnBurst(x, y) {
    for (let i = 0; i < 60; i++) {
      const angle = (Math.PI * 2 / 60) * i;
      const speed = Math.random() * 6 + 2;
      particles.push({
        x, y,
        vx: Math.cos(angle) * speed,
        vy: Math.sin(angle) * speed - Math.random() * 3,
        color: colors[Math.floor(Math.random() * colors.length)],
        alpha: 1,
        size: Math.random() * 4 + 2,
        gravity: 0.12,
      });
    }
  }

  // Spawn 5 bursts
  const bursts = [
    [window.innerWidth*0.3, window.innerHeight*0.4],
    [window.innerWidth*0.7, window.innerHeight*0.35],
    [window.innerWidth*0.5, window.innerHeight*0.5],
    [window.innerWidth*0.2, window.innerHeight*0.6],
    [window.innerWidth*0.8, window.innerHeight*0.55],
  ];
  let bi = 0;
  const burstIv = setInterval(() => {
    if (bi < bursts.length) { spawnBurst(...bursts[bi++]); }
    else clearInterval(burstIv);
  }, 220);

  let frame = 0;
  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach((p, i) => {
      p.x += p.vx; p.y += p.vy; p.vy += p.gravity;
      p.alpha -= 0.018; p.vx *= 0.99;
      ctx.globalAlpha = Math.max(0, p.alpha);
      ctx.fillStyle = p.color;
      ctx.shadowColor = p.color;
      ctx.shadowBlur = 6;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
      ctx.fill();
    });
    ctx.globalAlpha = 1; ctx.shadowBlur = 0;
    for (let i = particles.length-1; i >= 0; i--) {
      if (particles[i].alpha <= 0) particles.splice(i, 1);
    }
    frame++;
    if (frame < 180) requestAnimationFrame(animate);
    else canvas.remove();
  }
  animate();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PANIC BUTTON
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let panicMode = 'blank';
let panicActive = false;

function setPanic(mode) {
  panicMode = mode;
  localStorage.setItem('nx_panic', mode);
  document.querySelectorAll('.panic-opt').forEach(b => {
    b.style.background = 'none';
    b.style.borderColor = 'rgba(255,0,170,.15)';
    b.style.color = '#556677';
  });
  const el = document.getElementById('panic-' + mode);
  if (el) { el.style.background = 'rgba(255,0,170,.08)'; el.style.borderColor = 'rgba(255,0,170,.3)'; el.style.color = 'var(--p)'; }
}

function triggerPanic() {
  panicActive = true;
  const overlay = document.getElementById('panicOverlay');
  overlay.style.display = 'block';
  if (panicMode === 'classroom') {
    overlay.innerHTML = `<div style="background:#1967d2;color:#fff;padding:14px 24px;font-size:18px;font-weight:500;display:flex;align-items:center;gap:12px;"><div style="width:32px;height:32px;background:#fff;border-radius:4px;display:flex;align-items:center;justify-content:center;color:#1967d2;font-weight:700;font-size:16px;">G</div>Google Classroom</div><div style="background:#f8f9fa;min-height:calc(100vh - 52px);padding:30px 40px;"><div style="max-width:800px;"><div style="color:#202124;font-size:22px;font-weight:400;margin-bottom:20px;">Welcome back</div><div style="background:#fff;border:1px solid #e0e0e0;border-radius:8px;padding:20px;margin-bottom:14px;"><div style="color:#3c4043;font-size:14px;margin-bottom:8px;">üìö Period 3 ‚Äî English Literature</div><div style="color:#80868b;font-size:12px;">Essay due tomorrow</div></div><div style="background:#fff;border:1px solid #e0e0e0;border-radius:8px;padding:20px;"><div style="color:#3c4043;font-size:14px;margin-bottom:8px;">üìê Period 5 ‚Äî Algebra II</div><div style="color:#80868b;font-size:12px;">No upcoming work</div></div></div></div>`;
  } else if (panicMode === 'docs') {
    overlay.innerHTML = `<div style="border-bottom:1px solid #e0e0e0;padding:8px 16px;display:flex;align-items:center;gap:12px;background:#fff;"><div style="width:30px;height:30px;background:#4285f4;border-radius:4px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;">D</div><div><div style="color:#202124;font-size:14px;">My Essay Draft</div><div style="color:#80868b;font-size:11px;">Google Docs</div></div></div><div style="background:#fff;padding:60px 200px;min-height:100vh;"><div style="color:#202124;font-size:24px;font-weight:400;margin-bottom:20px;border-bottom:1px solid #e0e0e0;padding-bottom:10px;">My Essay Draft</div><div style="color:#3c4043;font-size:14px;line-height:2;">The topic of this essay explores the fundamental aspects of human nature and how modern society shapes individual identity. Throughout history, philosophers have debated the core question of what defines a person beyond their circumstances...</div></div>`;
  } else if (panicMode === 'search') {
    overlay.innerHTML = `<div style="background:#fff;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding-top:120px;"><img src="https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png" style="width:272px;margin-bottom:30px;"><div style="display:flex;gap:10px;"><div style="border:1px solid #dfe1e5;border-radius:24px;padding:12px 20px;width:500px;display:flex;align-items:center;gap:10px;box-shadow:0 1px 6px rgba(32,33,36,.28);"><span style="color:#9aa0a6;">üîç</span><span style="color:#3c4043;font-size:14px;">how to write a good essay introduction</span></div></div><div style="margin-top:20px;color:#70757a;font-size:13px;">About 2,340,000,000 results</div></div>`;
  } else {
    overlay.innerHTML = '';
    overlay.style.background = '#fff';
  }
  // Press any key or click to dismiss
  const dismiss = (e) => {
    if (e.key === 'Escape' || e.type === 'click') {
      overlay.style.display = 'none';
      panicActive = false;
      document.removeEventListener('keydown', dismiss);
      overlay.removeEventListener('click', dismiss);
    }
  };
  setTimeout(() => {
    document.addEventListener('keydown', dismiss);
    overlay.addEventListener('click', dismiss);
  }, 100);
}

// ESC key triggers panic
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && !panicActive && document.getElementById('cover').style.display === 'none') {
    triggerPanic();
  }
});

// Load saved panic mode
(function() {
  const saved = localStorage.getItem('nx_panic');
  if (saved) setPanic(saved);
  else setPanic('blank');
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WALLPAPER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setWallpaper(url) {
  const app = document.getElementById('app');
  if (!url || url === 'none') {
    app.style.backgroundImage = '';
    app.style.backgroundSize = '';
    document.body.style.backgroundImage = '';
    localStorage.removeItem('nx_wallpaper');
  } else {
    const bg = `url('${url}')`;
    document.body.style.backgroundImage = bg;
    document.body.style.backgroundSize = 'cover';
    document.body.style.backgroundPosition = 'center';
    document.body.style.backgroundAttachment = 'fixed';
    localStorage.setItem('nx_wallpaper', url);
  }
}

// Load saved wallpaper
(function() {
  const saved = localStorage.getItem('nx_wallpaper');
  if (saved) setWallpaper(saved);
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WEATHER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function fetchWeather() {
  const city = document.getElementById('weatherCity').value.trim();
  if (!city) return;
  const resultEl = document.getElementById('weatherResult');
  resultEl.textContent = 'Fetching weather...';
  try {
    // Use open-meteo geocoding + weather (totally free, no key)
    const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1&language=en&format=json`);
    const geoData = await geoRes.json();
    if (!geoData.results?.length) { resultEl.textContent = 'City not found.'; return; }
    const { latitude, longitude, name, country } = geoData.results[0];
    const wxRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,weathercode,windspeed_10m&temperature_unit=fahrenheit&windspeed_unit=mph`);
    const wxData = await wxRes.json();
    const temp = Math.round(wxData.current.temperature_2m);
    const wind = Math.round(wxData.current.windspeed_10m);
    const code = wxData.current.weathercode;
    const icon = code <= 1 ? '‚òÄÔ∏è' : code <= 3 ? '‚õÖ' : code <= 48 ? 'üå´Ô∏è' : code <= 67 ? 'üåßÔ∏è' : code <= 77 ? '‚ùÑÔ∏è' : code <= 82 ? 'üå¶Ô∏è' : '‚õàÔ∏è';
    const desc = code === 0 ? 'Clear' : code <= 1 ? 'Mostly Clear' : code <= 3 ? 'Partly Cloudy' : code <= 48 ? 'Foggy' : code <= 55 ? 'Drizzle' : code <= 67 ? 'Rain' : code <= 77 ? 'Snow' : code <= 82 ? 'Showers' : 'Thunderstorm';
    const display = `${icon} ${name}, ${country} ¬∑ ${temp}¬∞F ¬∑ ${desc} ¬∑ Wind ${wind}mph`;
    resultEl.innerHTML = `<span style="color:var(--b)">${display}</span>`;
    // Update topbar badge
    const badge = document.getElementById('weatherBadge');
    badge.style.display = 'block';
    badge.textContent = `${icon} ${temp}¬∞F ${name}`;
    localStorage.setItem('nx_weather_city', city);
  } catch(e) {
    resultEl.textContent = 'Weather fetch failed. Try again.';
  }
}

// Auto-load last weather city
(function() {
  const saved = localStorage.getItem('nx_weather_city');
  if (saved) {
    document.getElementById('weatherCity').value = saved;
    fetchWeather();
  }
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SECRET CHAT (uses public peerjs + localStorage sync trick)
// Real-time via free Firebase Realtime DB public demo
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let chatRoom = null;
let chatName = 'Anonymous';
let chatPollTimer = null;
const CHAT_BASE = 'https://nexus-chat-default-rtdb.firebaseio.com';

// Use a free public Firebase demo ‚Äî messages auto-delete after 1hr
async function joinRoom() {
  const code = document.getElementById('roomCodeInput').value.trim().toLowerCase().replace(/[^a-z0-9]/g,'');
  const name = document.getElementById('chatNameInput').value.trim() || 'Anon';
  if (!code) return;
  chatRoom = code;
  chatName = name;
  document.getElementById('chatRoomName').textContent = `Room: #${code} ‚Äî logged in as ${name}`;
  localStorage.setItem('nx_chat_name', name);
  clearInterval(chatPollTimer);
  loadMessages();
  chatPollTimer = setInterval(loadMessages, 2000); // poll every 2s
}

let lastMsgCount = 0;
async function loadMessages() {
  if (!chatRoom) return;
  try {
    const r = await fetch(`${CHAT_BASE}/rooms/${chatRoom}/messages.json?orderBy="time"&limitToLast=50`);
    const data = await r.json();
    if (!data) return;
    const msgs = Object.values(data).sort((a,b) => a.time - b.time);
    // Notify on new messages from others
    if (lastMsgCount > 0 && msgs.length > lastMsgCount) {
      const newMsgs = msgs.slice(lastMsgCount);
      newMsgs.forEach(m => {
        if (m.name !== chatName) showToast('üí¨ ' + m.name, m.text.slice(0,60), 'var(--p)');
      });
    }
    lastMsgCount = msgs.length;
    const log = document.getElementById('chatLog');
    const wasAtBottom = log.scrollTop + log.clientHeight >= log.scrollHeight - 20;
    log.innerHTML = msgs.map(m => `
      <div style="display:flex;flex-direction:${m.name===chatName?'row-reverse':'row'};gap:8px;align-items:flex-end;">
        <div style="font-size:.6rem;color:#334455;flex-shrink:0;">${m.name}</div>
        <div style="max-width:65%;padding:9px 13px;border-radius:6px;font-size:.72rem;line-height:1.6;letter-spacing:.4px;background:${m.name===chatName?'rgba(0,255,136,.08)':'rgba(255,0,170,.06)'};border:1px solid ${m.name===chatName?'rgba(0,255,136,.15)':'rgba(255,0,170,.12)'};color:${m.name===chatName?'#c0ddc0':'#c0c8dd'};">${escapeHtml(m.text)}</div>
      </div>`).join('');
    if (wasAtBottom) log.scrollTop = log.scrollHeight;
  } catch(e) {}
}

async function sendChatMsg() {
  if (!chatRoom) { alert('Join a room first!'); return; }
  const input = document.getElementById('chatMsgInput');
  const text = input.value.trim();
  if (!text) return;
  input.value = '';
  try {
    await fetch(`${CHAT_BASE}/rooms/${chatRoom}/messages.json`, {
      method: 'POST',
      body: JSON.stringify({ name: chatName, text, time: Date.now() })
    });
    loadMessages();
    // Auto-clean old messages after 100 in room
    cleanOldMessages();
  } catch(e) {}
}

async function cleanOldMessages() {
  try {
    const r = await fetch(`${CHAT_BASE}/rooms/${chatRoom}/messages.json?orderBy="time"&limitToLast=200`);
    const data = await r.json();
    if (!data) return;
    const keys = Object.keys(data);
    if (keys.length > 80) {
      // Delete oldest 30
      const toDelete = keys.slice(0, 30);
      for (const k of toDelete) {
        await fetch(`${CHAT_BASE}/rooms/${chatRoom}/messages/${k}.json`, { method: 'DELETE' });
      }
    }
  } catch(e) {}
}

function escapeHtml(str) {
  return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// Restore chat name
(function() {
  const saved = localStorage.getItem('nx_chat_name');
  if (saved) document.getElementById('chatNameInput').value = saved;
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SETTINGS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentCover = 'loading';

// Load saved settings
(function() {
  const savedPass = localStorage.getItem('nx_pass');
  if (savedPass) currentPassword = savedPass;
  const savedUnblocker = localStorage.getItem('nx_unblocker');
  if (savedUnblocker) {
    UNBLOCKER_URL = savedUnblocker;
    document.getElementById('settingUnblocker').value = savedUnblocker;
    // Update the app card
    const app = apps.find(a => a.tag === 'unblock');
    if (app) app.url = savedUnblocker;
  }
  const savedCover = localStorage.getItem('nx_cover');
  if (savedCover) { currentCover = savedCover; applyCoverStyle(savedCover); }
  const savedTheme = localStorage.getItem('nx_theme');
  if (savedTheme) {
    const [g, b] = JSON.parse(savedTheme);
    applyTheme(g, b);
  }
})();

function saveUnblocker() {
  const val = document.getElementById('settingUnblocker').value.trim();
  const pass = document.getElementById('unblockerPassInput').value;
  const okEl = document.getElementById('unblockerSaved');
  const errEl = document.getElementById('unblockerError');
  okEl.style.display = 'none';
  errEl.style.display = 'none';
  if (!val) return;
  if (pass !== currentPassword) {
    errEl.style.display = 'block';
    document.getElementById('unblockerPassInput').value = '';
    setTimeout(() => errEl.style.display = 'none', 3000);
    return;
  }
  UNBLOCKER_URL = val;
  localStorage.setItem('nx_unblocker', val);
  const app = apps.find(a => a.tag === 'unblock');
  if (app) app.url = val;
  document.getElementById('unblockerPassInput').value = '';
  okEl.style.display = 'block';
  setTimeout(() => okEl.style.display = 'none', 2000);
}

function savePassword() {
  const oldP = document.getElementById('settingPassOld').value;
  const newP = document.getElementById('settingPassNew').value.trim();
  const errEl = document.getElementById('passError');
  const okEl = document.getElementById('passSaved');
  errEl.style.display = 'none'; okEl.style.display = 'none';
  if (oldP !== currentPassword) { errEl.style.display = 'block'; return; }
  if (!newP) return;
  currentPassword = newP;
  localStorage.setItem('nx_pass', newP);
  okEl.style.display = 'block';
  document.getElementById('settingPassOld').value = '';
  document.getElementById('settingPassNew').value = '';
  setTimeout(() => okEl.style.display = 'none', 2000);
}

function setTheme(g, b) {
  applyTheme(g, b);
  localStorage.setItem('nx_theme', JSON.stringify([g, b]));
  const el = document.getElementById('themeSaved');
  el.style.display = 'block';
  setTimeout(() => el.style.display = 'none', 2000);
}

function applyTheme(g, b) {
  document.documentElement.style.setProperty('--g', g);
  document.documentElement.style.setProperty('--b', b);
}

function setCover(type) {
  currentCover = type;
  localStorage.setItem('nx_cover', type);
  document.querySelectorAll('.cover-opt').forEach(el => {
    el.style.background = 'none';
    el.style.borderColor = 'rgba(255,0,170,.15)';
    el.style.color = '#556677';
  });
  const active = document.getElementById('cover-' + type);
  if (active) {
    active.style.background = 'rgba(255,0,170,.08)';
    active.style.borderColor = 'rgba(255,0,170,.3)';
    active.style.color = 'var(--p)';
  }
}

function applyCoverStyle(type) {
  const cover = document.getElementById('cover');
  if (type === 'classroom') {
    cover.style.background = '#fff';
    cover.innerHTML = `
      <div style="width:100%;max-width:800px;padding:20px;">
        <div style="background:#1967d2;color:#fff;padding:16px 24px;border-radius:8px 8px 0 0;font-family:Arial,sans-serif;font-size:18px;font-weight:500;">Google Classroom</div>
        <div style="background:#f8f9fa;border:1px solid #e0e0e0;border-top:none;padding:40px 24px;border-radius:0 0 8px 8px;font-family:Arial,sans-serif;">
          <div style="color:#3c4043;font-size:14px;margin-bottom:20px;">To-do</div>
          <div style="background:#fff;border:1px solid #e0e0e0;border-radius:4px;padding:16px;margin-bottom:12px;color:#5f6368;font-size:13px;">No work due soon</div>
          <div style="display:flex;align-items:center;gap:10px;margin-top:20px;"><div style="width:18px;height:18px;border:2px solid #dadce0;border-top-color:#1967d2;border-radius:50%;animation:cspin .9s linear infinite;"></div><span style="color:#5f6368;font-size:13px;">Loading assignments...</span></div>
        </div>
      </div>
      <input id="coverPass" type="password" autocomplete="off" style="position:absolute;opacity:0;pointer-events:none;width:1px;height:1px;">`;
  } else if (type === 'docs') {
    cover.style.background = '#fff';
    cover.innerHTML = `
      <div style="width:100%;max-width:900px;font-family:Arial,sans-serif;">
        <div style="background:#fff;border-bottom:1px solid #e0e0e0;padding:8px 16px;display:flex;align-items:center;gap:12px;">
          <div style="width:28px;height:28px;background:#4285f4;border-radius:2px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:14px;">D</div>
          <div style="color:#3c4043;font-size:16px;">Untitled document</div>
        </div>
        <div style="padding:60px 120px;min-height:400px;background:#fff;">
          <div style="width:100%;height:12px;background:#f1f3f4;border-radius:4px;margin-bottom:12px;"></div>
          <div style="width:80%;height:12px;background:#f1f3f4;border-radius:4px;margin-bottom:12px;"></div>
          <div style="width:90%;height:12px;background:#f1f3f4;border-radius:4px;margin-bottom:24px;"></div>
          <div style="display:flex;gap:8px;align-items:center;"><div style="width:16px;height:16px;border:2px solid #dadce0;border-top-color:#4285f4;border-radius:50%;animation:cspin .9s linear infinite;"></div><span style="color:#80868b;font-size:12px;">Loading...</span></div>
        </div>
      </div>
      <input id="coverPass" type="password" autocomplete="off" style="position:absolute;opacity:0;pointer-events:none;width:1px;height:1px;">`;
  } else if (type === 'blank') {
    cover.style.background = '#fff';
    cover.innerHTML = `<input id="coverPass" type="password" autocomplete="off" style="position:absolute;opacity:0;pointer-events:none;width:1px;height:1px;">`;
  } else {
    // default loading spinner
    cover.style.background = '#f1f3f4';
    cover.innerHTML = `
      <div class="cover-spinner"></div>
      <div class="cover-text">Loading resources...</div>
      <input id="coverPass" type="password" autocomplete="off" style="position:absolute;opacity:0;pointer-events:none;width:1px;height:1px;">`;
  }
  // Focus the new input (delegation on #cover handles the actual check)
  const inp = document.getElementById('coverPass');
  if (inp) inp.focus();
}


</script>
</body>
</html>
