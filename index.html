<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Google Classroom</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
:root{--g:#00ff88;--b:#00cfff;--p:#ff00aa;--y:#ffcc00;--dk:#060910;--card:#0c1220;--border:rgba(0,255,136,.13);}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--dk);font-family:'Share Tech Mono',monospace;color:#a0b8cc;overflow:hidden;}
::-webkit-scrollbar{width:4px;height:4px;}
::-webkit-scrollbar-thumb{background:rgba(0,255,136,.2);border-radius:3px;}

/* â”€â”€ COVER â”€â”€ */
#cover{position:fixed;inset:0;z-index:9999;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:space-between;padding:28px 0 18px;font-family:Arial,sans-serif;}
#cover-top{width:100%;padding:0 24px;}
#cover-mid{display:flex;flex-direction:column;align-items:center;width:100%;max-width:448px;padding:0 18px;}
.g-avatar{width:50px;height:50px;border-radius:50%;background:#4285f4;display:flex;align-items:center;justify-content:center;margin-bottom:14px;}
.g-welcome{font-size:24px;font-weight:400;color:#202124;margin-bottom:8px;}
.g-email-chip{display:flex;align-items:center;gap:8px;background:#f1f3f4;border-radius:20px;padding:5px 14px;margin-bottom:26px;font-size:14px;color:#202124;}
.g-field-label{font-size:16px;color:#202124;align-self:flex-start;margin-bottom:4px;}
.g-field-sub{font-size:13px;color:#5f6368;align-self:flex-start;margin-bottom:20px;}
.g-pass-wrap{width:100%;position:relative;margin-bottom:6px;}
#coverPass{width:100%;padding:14px 46px 14px 16px;border:1px solid #dadce0;border-radius:4px;font-size:16px;color:#202124;font-family:Arial,sans-serif;outline:none;}
#coverPass:focus{border-color:#4285f4;box-shadow:0 0 0 2px rgba(66,133,244,.2);}
.g-eye{position:absolute;right:13px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:#5f6368;font-size:18px;}
#coverError{display:none;color:#d93025;font-size:12px;align-self:flex-start;margin-bottom:6px;}
.g-forgot{font-size:13px;color:#4285f4;cursor:pointer;align-self:flex-start;margin-bottom:28px;}
.g-actions{display:flex;justify-content:space-between;align-items:center;width:100%;}
.g-ghost{background:none;border:none;color:#4285f4;font-size:14px;font-family:'Google Sans',Arial,sans-serif;font-weight:500;cursor:pointer;padding:10px 16px;border-radius:4px;}
#coverNext{background:#1a73e8;color:#fff;border:none;border-radius:4px;padding:10px 24px;font-size:14px;font-family:Arial,sans-serif;font-weight:500;cursor:pointer;}
.g-footer{display:flex;gap:22px;font-size:12px;color:#5f6368;}

/* â”€â”€ APP â”€â”€ */
#app{display:none;flex-direction:column;height:100vh;overflow:hidden;position:relative;}
#app::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,255,136,.015) 1px,transparent 1px),linear-gradient(90deg,rgba(0,255,136,.015) 1px,transparent 1px);background-size:44px 44px;pointer-events:none;z-index:0;}
#matrixCanvas{position:fixed;inset:0;z-index:1;pointer-events:none;opacity:.13;}

/* loader */
#neonBar{position:fixed;top:0;left:0;height:2px;width:0;background:linear-gradient(90deg,var(--g),var(--b),var(--p));z-index:9998;pointer-events:none;}

/* toasts */
#toasts{position:fixed;bottom:20px;right:20px;z-index:9997;display:flex;flex-direction:column;gap:8px;pointer-events:none;}
.toast{background:rgba(6,9,16,.95);border:1px solid rgba(0,255,136,.2);border-radius:5px;padding:10px 15px;font-size:.66rem;color:#c0d8ff;letter-spacing:.8px;animation:tIn .3s ease;backdrop-filter:blur(8px);}
@keyframes tIn{from{opacity:0;transform:translateX(24px)}to{opacity:1;transform:none}}
.toast-title{font-family:'Orbitron',sans-serif;font-size:.5rem;letter-spacing:2px;color:var(--g);margin-bottom:3px;}

/* splash */
#splash{position:fixed;inset:0;background:var(--dk);z-index:9996;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;transition:opacity .5s;}
.sp-logo{font-family:'Orbitron',sans-serif;font-weight:900;font-size:clamp(2rem,8vw,5rem);letter-spacing:10px;color:var(--g);text-shadow:0 0 40px var(--g),0 0 80px rgba(0,255,136,.3);animation:pulse 1.2s ease-in-out infinite alternate;}
.sp-logo span{color:var(--b);}
@keyframes pulse{from{text-shadow:0 0 20px var(--g)}to{text-shadow:0 0 55px var(--g),0 0 110px rgba(0,255,136,.35)}}
.sp-sub{font-size:.72rem;color:#223322;letter-spacing:5px;}
.sp-bar-wrap{width:250px;height:3px;background:rgba(0,255,136,.1);border-radius:2px;overflow:hidden;}
.sp-bar{height:100%;width:0;background:linear-gradient(90deg,var(--g),var(--b));transition:width .08s linear;}
#spMsg{font-size:.56rem;color:#1a3322;letter-spacing:3px;}

/* panic */
#panic{display:none;position:fixed;inset:0;z-index:99999;background:#fff;}
#panicFrame{width:100%;height:100%;border:none;}

/* topbar */
#topbar{display:flex;align-items:center;height:48px;background:rgba(6,9,16,.97);border-bottom:1px solid rgba(0,255,136,.08);flex-shrink:0;position:relative;z-index:200;}
.logo{font-family:'Orbitron',sans-serif;font-weight:900;font-size:.95rem;letter-spacing:3px;color:var(--g);text-shadow:0 0 14px var(--g);padding:0 18px;white-space:nowrap;animation:flk 9s infinite;}
.logo span{color:var(--b);}
@keyframes flk{0%,93%,100%{opacity:1}94%{opacity:.4}97%{opacity:.9}99%{opacity:.3}}
#tabs{display:flex;height:100%;flex:1;overflow-x:auto;}
#tabs::-webkit-scrollbar{height:0;}
.tab{display:flex;align-items:center;gap:5px;padding:0 15px;font-size:.65rem;letter-spacing:1.5px;color:#334455;cursor:pointer;border:none;background:none;font-family:'Share Tech Mono',monospace;height:100%;border-bottom:2px solid transparent;transition:all .18s;white-space:nowrap;}
.tab:hover{color:var(--g);background:rgba(0,255,136,.04);}
.tab.on{color:var(--g);border-bottom-color:var(--g);background:rgba(0,255,136,.06);}
#tb-right{display:flex;align-items:center;gap:8px;padding-right:12px;flex-shrink:0;}
#wxBadge{display:none;font-size:.56rem;color:var(--b);background:rgba(0,207,255,.08);border:1px solid rgba(0,207,255,.2);border-radius:2px;padding:3px 8px;letter-spacing:.8px;}
.esc-hint{font-size:.52rem;color:#1a2a1a;letter-spacing:.8px;}

/* pages */
#main{display:flex;flex:1;overflow:hidden;position:relative;z-index:2;}
.page{display:none;flex:1;overflow:hidden;flex-direction:column;}
.page.on{display:flex;}

/* flash */
#flash{position:fixed;inset:0;background:var(--g);pointer-events:none;z-index:9995;opacity:0;}
@keyframes shk{0%,100%{transform:none}20%{transform:translate(-4px,-2px)}60%{transform:translate(4px,2px)}}

/* â•â•â•â•â•â•â•â•â•â•â• GAMES â•â•â•â•â•â•â•â•â•â•â• */
#gPage{flex-direction:row;}
#gSide{width:140px;background:rgba(8,13,24,.9);border-right:1px solid var(--border);padding:10px 6px;display:flex;flex-direction:column;gap:2px;overflow-y:auto;flex-shrink:0;}
.catbtn{width:100%;background:none;border:none;color:#334455;font-family:'Share Tech Mono',monospace;font-size:.59rem;letter-spacing:1.5px;padding:8px 9px;border-radius:3px;cursor:pointer;text-align:left;transition:all .18s;}
.catbtn:hover{color:var(--g);background:rgba(0,255,136,.06);}
.catbtn.on{color:var(--g);background:rgba(0,255,136,.1);border-left:2px solid var(--g);}
#gMain{flex:1;display:flex;flex-direction:column;overflow:hidden;}
#gBackBar{display:none;align-items:center;gap:10px;padding:8px 14px;background:rgba(0,0,0,.5);border-bottom:1px solid var(--border);flex-shrink:0;}
.gbk{background:none;border:1px solid rgba(0,255,136,.3);color:var(--g);padding:5px 12px;font-family:'Share Tech Mono',monospace;font-size:.6rem;letter-spacing:1.5px;border-radius:2px;cursor:pointer;transition:all .2s;}
.gbk:hover{background:rgba(0,255,136,.1);}
.gfull{background:none;border:1px solid rgba(0,207,255,.3);color:var(--b);padding:5px 12px;font-family:'Share Tech Mono',monospace;font-size:.6rem;letter-spacing:1.5px;border-radius:2px;cursor:pointer;}
#gCurName{font-size:.7rem;color:#88aabb;flex:1;}
#gSearch{padding:9px 13px;border-bottom:1px solid var(--border);flex-shrink:0;}
#gsInp{width:100%;background:rgba(0,255,136,.04);border:1px solid var(--border);border-radius:3px;color:var(--g);font-family:'Share Tech Mono',monospace;font-size:.68rem;padding:7px 11px;outline:none;letter-spacing:.8px;}
#gsInp::placeholder{color:#1a3322;}
#gsInp:focus{border-color:rgba(0,255,136,.4);box-shadow:0 0 10px rgba(0,255,136,.08);}
#gGridWrap{flex:1;overflow-y:auto;padding:14px;}
#gGrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(145px,1fr));gap:11px;}
.gcard{background:var(--card);border:1px solid rgba(0,255,136,.07);border-radius:6px;overflow:hidden;cursor:pointer;transition:all .2s;}
.gcard:hover{transform:translateY(-3px) scale(1.02);border-color:var(--g);box-shadow:0 8px 28px rgba(0,255,136,.16);}
.gthumb{width:100%;aspect-ratio:16/9;display:flex;align-items:center;justify-content:center;font-size:2rem;background:linear-gradient(135deg,#0a1020,#060b18);position:relative;}
.gthumb::after{content:'â–¶ PLAY';position:absolute;inset:0;background:rgba(0,255,136,.88);display:flex;align-items:center;justify-content:center;font-family:'Orbitron',sans-serif;font-size:.64rem;font-weight:900;color:#050810;letter-spacing:3px;opacity:0;transition:opacity .2s;}
.gcard:hover .gthumb::after{opacity:1;}
.ginfo{padding:8px 10px;}
.gname{font-family:'Orbitron',sans-serif;font-size:.54rem;font-weight:700;color:#c0d8ff;letter-spacing:.8px;margin-bottom:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.gmeta{display:flex;justify-content:space-between;font-size:.51rem;color:#334455;}
.grating{color:#ffcc44;}
#gFrame{display:none;flex:1;}
#gFrame iframe{width:100%;height:100%;border:none;}

/* â•â•â•â•â•â•â•â•â•â•â• MUSIC â•â•â•â•â•â•â•â•â•â•â• */
#mPage{flex-direction:row;}
#mSide{width:224px;background:rgba(8,12,26,.9);border-right:1px solid rgba(0,207,255,.1);display:flex;flex-direction:column;overflow:hidden;flex-shrink:0;}
.m-hdr{padding:13px 12px 9px;font-family:'Orbitron',sans-serif;font-size:.58rem;color:var(--b);letter-spacing:3px;border-bottom:1px solid rgba(0,207,255,.1);flex-shrink:0;}
#mSearch{margin:8px;background:rgba(0,207,255,.05);border:1px solid rgba(0,207,255,.15);border-radius:3px;color:var(--b);font-family:'Share Tech Mono',monospace;font-size:.65rem;padding:7px 10px;outline:none;letter-spacing:.8px;flex-shrink:0;}
#mSearch::placeholder{color:#1a2a3a;}
#mSearch:focus{border-color:rgba(0,207,255,.4);}
#mResults{flex:1;overflow-y:auto;padding:0 5px 5px;}
.mres{display:flex;align-items:center;gap:7px;padding:7px 8px;border-radius:4px;cursor:pointer;transition:background .18s;}
.mres:hover{background:rgba(0,207,255,.07);}
.mres.playing{background:rgba(0,207,255,.12);border-left:2px solid var(--b);}
.mres-num{font-size:.53rem;color:#1a2a3a;width:14px;text-align:center;flex-shrink:0;}
.mres-info{flex:1;overflow:hidden;}
.mres-title{font-size:.62rem;color:#c0d8ff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.mres-artist{font-size:.54rem;color:#334455;}
.mres-dur{font-size:.53rem;color:#334455;flex-shrink:0;}
#mMain{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:space-between;padding:22px 26px 0;overflow:hidden;}
.now-art{width:165px;height:165px;border-radius:8px;background:linear-gradient(135deg,#0a1020,#060b18);display:flex;align-items:center;justify-content:center;font-size:3.2rem;border:1px solid rgba(0,207,255,.2);box-shadow:0 0 40px rgba(0,207,255,.07),0 16px 36px rgba(0,0,0,.5);flex-shrink:0;}
.now-info{text-align:center;padding:12px 0;flex-shrink:0;}
#nowTitle{font-family:'Orbitron',sans-serif;font-size:.85rem;color:#fff;letter-spacing:1.5px;margin-bottom:4px;}
#nowArtist{font-size:.67rem;color:#446688;letter-spacing:1.5px;}
#lyricsPanel{flex:1;overflow-y:auto;width:100%;max-width:440px;text-align:center;padding:0 0 12px;}
.lyric-line{color:#223344;font-size:.67rem;letter-spacing:1.5px;margin-top:12px;}
#mPlayer{width:100%;background:rgba(8,12,26,.96);border-top:1px solid rgba(0,207,255,.1);padding:11px 26px;flex-shrink:0;}
.prog-row{display:flex;align-items:center;gap:8px;margin-bottom:9px;}
#progBar{flex:1;height:4px;background:rgba(0,207,255,.15);border-radius:2px;cursor:pointer;position:relative;}
#progFill{height:100%;background:linear-gradient(90deg,var(--g),var(--b));border-radius:2px;width:0;position:relative;}
#progFill::after{content:'';position:absolute;right:-5px;top:-4px;width:10px;height:10px;background:var(--b);border-radius:50%;box-shadow:0 0 7px var(--b);}
.t-lbl{font-size:.54rem;color:#334455;width:30px;text-align:center;}
.wf{display:flex;gap:3px;align-items:flex-end;height:16px;margin-left:7px;}
.wb{width:3px;background:var(--b);border-radius:2px;box-shadow:0 0 4px var(--b);}
.wb:nth-child(1){animation:wv .7s .00s ease-in-out infinite alternate;height:5px;}
.wb:nth-child(2){animation:wv .7s .10s ease-in-out infinite alternate;height:11px;}
.wb:nth-child(3){animation:wv .7s .20s ease-in-out infinite alternate;height:16px;}
.wb:nth-child(4){animation:wv .7s .15s ease-in-out infinite alternate;height:9px;}
.wb:nth-child(5){animation:wv .7s .05s ease-in-out infinite alternate;height:13px;}
.wb:nth-child(6){animation:wv .7s .25s ease-in-out infinite alternate;height:7px;}
@keyframes wv{from{transform:scaleY(.12)}to{transform:scaleY(1)}}
.wf.paused .wb{animation-play-state:paused;}
.m-ctrls{display:flex;align-items:center;justify-content:center;gap:11px;}
.mc{background:none;border:none;color:#334455;font-size:.95rem;cursor:pointer;padding:6px;transition:color .18s,transform .1s;line-height:1;}
.mc:hover{color:var(--b);transform:scale(1.15);}
.mc.play{background:var(--b);color:#050810;width:38px;height:38px;border-radius:50%;font-size:.85rem;display:flex;align-items:center;justify-content:center;box-shadow:0 0 14px rgba(0,207,255,.4);}
.mc.play:hover{opacity:.88;color:#050810;}
.vol-row{display:flex;align-items:center;gap:6px;position:absolute;right:26px;bottom:16px;}
.vol-row span{font-size:.58rem;color:#1a2a3a;}
input[type=range].vol{-webkit-appearance:none;width:60px;height:3px;background:rgba(0,207,255,.2);border-radius:2px;outline:none;}
input[type=range].vol::-webkit-slider-thumb{-webkit-appearance:none;width:10px;height:10px;background:var(--b);border-radius:50%;box-shadow:0 0 5px var(--b);cursor:pointer;}

/* â•â•â•â•â•â•â•â•â•â•â• AI â•â•â•â•â•â•â•â•â•â•â• */
#aiPage{flex-direction:row;}
.ai-side{width:172px;background:rgba(12,18,32,.8);border-right:1px solid rgba(255,0,170,.1);padding:10px 6px;display:flex;flex-direction:column;gap:3px;flex-shrink:0;}
.aitool{display:flex;align-items:center;gap:7px;background:none;border:none;color:#445566;font-family:'Share Tech Mono',monospace;font-size:.6rem;letter-spacing:.8px;padding:8px 9px;border-radius:3px;cursor:pointer;text-align:left;transition:all .18s;width:100%;}
.aitool:hover{color:var(--p);background:rgba(255,0,170,.06);}
.aitool.on{color:var(--p);background:rgba(255,0,170,.1);border-left:2px solid var(--p);}
#aiMain{flex:1;display:flex;flex-direction:column;overflow:hidden;}
.aipane{display:none;flex:1;flex-direction:column;overflow:hidden;}
.aipane.on{display:flex;}
#chatMsgs{flex:1;overflow-y:auto;padding:14px;display:flex;flex-direction:column;gap:10px;}
.msg{display:flex;gap:9px;animation:fup .3s ease;}
@keyframes fup{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.msg.user{flex-direction:row-reverse;}
.mav{width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.75rem;flex-shrink:0;}
.msg.ai .mav{background:rgba(255,0,170,.12);border:1px solid rgba(255,0,170,.25);}
.msg.user .mav{background:rgba(0,255,136,.12);border:1px solid rgba(0,255,136,.25);}
.mbub{max-width:72%;padding:9px 12px;border-radius:6px;font-size:.68rem;line-height:1.75;letter-spacing:.3px;}
.msg.ai .mbub{background:rgba(255,0,170,.06);border:1px solid rgba(255,0,170,.12);color:#c0c8dd;}
.msg.user .mbub{background:rgba(0,255,136,.06);border:1px solid rgba(0,255,136,.12);color:#c0ddc0;text-align:right;}
.chat-in{display:flex;padding:11px;border-top:1px solid rgba(255,0,170,.1);gap:0;flex-shrink:0;}
.chat-in input{flex:1;background:rgba(255,0,170,.04);border:1px solid rgba(255,0,170,.18);border-right:none;border-radius:3px 0 0 3px;color:#c0d8ff;font-family:'Share Tech Mono',monospace;font-size:.68rem;padding:9px 12px;outline:none;letter-spacing:.8px;}
.chat-in button{background:var(--p);border:none;color:#fff;padding:9px 16px;font-family:'Orbitron',sans-serif;font-size:.58rem;font-weight:700;letter-spacing:1.5px;border-radius:0 3px 3px 0;cursor:pointer;}
.tool-wrap{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;padding:28px;}
.tool-wrap h2{font-family:'Orbitron',sans-serif;font-size:.85rem;color:var(--p);letter-spacing:3px;}
.tool-row{display:flex;gap:8px;width:100%;max-width:640px;align-items:flex-end;}
.tool-ta{flex:1;background:rgba(255,0,170,.04);border:1px solid rgba(255,0,170,.15);border-radius:4px;color:#c0d8ff;font-family:'Share Tech Mono',monospace;font-size:.68rem;padding:9px;outline:none;resize:none;line-height:1.75;width:100%;}
.tool-sel{background:rgba(255,0,170,.04);border:1px solid rgba(255,0,170,.2);color:var(--p);font-family:'Share Tech Mono',monospace;font-size:.6rem;padding:6px 8px;border-radius:3px;outline:none;margin-bottom:4px;}
.tool-btn{background:var(--p);border:none;color:#fff;padding:9px 20px;font-family:'Orbitron',sans-serif;font-size:.6rem;font-weight:700;letter-spacing:2px;border-radius:3px;cursor:pointer;white-space:nowrap;}
.tool-out{width:100%;max-width:640px;background:rgba(0,0,0,.3);border:1px solid rgba(0,255,136,.1);border-radius:4px;color:var(--g);font-family:'Share Tech Mono',monospace;font-size:.68rem;padding:11px;line-height:1.85;min-height:55px;}
.spinner{width:14px;height:14px;border:2px solid rgba(0,207,255,.2);border-top-color:var(--b);border-radius:50%;animation:spin .7s linear infinite;display:inline-block;}
@keyframes spin{to{transform:rotate(360deg)}}

/* â•â•â•â•â•â•â•â•â•â•â• APPS â•â•â•â•â•â•â•â•â•â•â• */
#appsPage{flex-direction:column;}
#appsView{flex:1;overflow-y:auto;}
.apps-hdr{padding:18px 22px 12px;font-family:'Orbitron',sans-serif;font-size:.63rem;color:#334455;letter-spacing:4px;border-bottom:1px solid var(--border);}
.apps-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(158px,1fr));gap:11px;padding:16px 22px;}
.acard{background:#0c1420;border:1px solid rgba(0,207,255,.07);border-radius:7px;padding:15px 12px;cursor:pointer;transition:all .2s;display:flex;flex-direction:column;gap:7px;}
.acard:hover{border-color:var(--b);box-shadow:0 4px 18px rgba(0,207,255,.1);transform:translateY(-2px);}
.acard.feat{border-color:rgba(255,204,0,.25);background:rgba(255,204,0,.03);}
.acard.feat:hover{border-color:var(--y);box-shadow:0 4px 20px rgba(255,204,0,.12);}
.aico{font-size:1.65rem;}
.aname{font-family:'Orbitron',sans-serif;font-size:.58rem;color:#c0d8ff;letter-spacing:.8px;}
.adesc{font-size:.54rem;color:#334455;line-height:1.65;}
.atag{display:inline-block;font-size:.49rem;letter-spacing:1.5px;padding:2px 7px;border-radius:2px;margin-top:auto;}
.atag.free{background:rgba(0,255,136,.1);color:var(--g);border:1px solid rgba(0,255,136,.2);}
.atag.unblock{background:rgba(255,204,0,.1);color:var(--y);border:1px solid rgba(255,204,0,.25);}
.atag.blocked{background:rgba(0,207,255,.08);color:var(--b);border:1px solid rgba(0,207,255,.18);}
#appViewer{display:none;flex:1;flex-direction:column;overflow:hidden;}
.avBar{display:flex;align-items:center;gap:10px;padding:8px 14px;background:rgba(0,0,0,.6);border-bottom:1px solid var(--border);flex-shrink:0;}
.avBtn{background:none;border:1px solid rgba(0,207,255,.3);color:var(--b);padding:4px 11px;font-family:'Share Tech Mono',monospace;font-size:.6rem;letter-spacing:1.5px;border-radius:2px;cursor:pointer;transition:all .2s;}
.avBtn:hover{background:rgba(0,207,255,.1);}
.avBtn.pink{border-color:rgba(255,0,170,.3);color:var(--p);}
.avBtn.pink:hover{background:rgba(255,0,170,.1);}
#avName{font-family:'Orbitron',sans-serif;font-size:.65rem;color:#c0d8ff;letter-spacing:1.5px;flex:1;}
#appBlockMsg{display:none;flex:1;align-items:center;justify-content:center;flex-direction:column;gap:14px;padding:36px;text-align:center;}
#appFrame{flex:1;border:none;width:100%;background:#000;}

/* â•â•â•â•â•â•â•â•â•â•â• SETTINGS â•â•â•â•â•â•â•â•â•â•â• */
#settingsPage{overflow-y:auto;}
.s-inner{padding:26px 32px;display:flex;flex-direction:column;gap:22px;max-width:660px;}
.s-title{font-family:'Orbitron',sans-serif;font-size:.9rem;color:var(--g);letter-spacing:4px;text-shadow:0 0 16px var(--g);}
.scard{background:#0c1420;border-radius:7px;padding:17px;}
.scard-title{font-family:'Orbitron',sans-serif;font-size:.62rem;letter-spacing:2.5px;margin-bottom:4px;}
.scard-sub{font-size:.59rem;color:#334455;letter-spacing:.8px;margin-bottom:12px;}
.srow{display:flex;gap:0;}
.sinp{flex:1;background:rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.07);border-right:none;border-radius:3px 0 0 3px;color:#c0d8ff;font-family:'Share Tech Mono',monospace;font-size:.65rem;padding:8px 11px;outline:none;letter-spacing:1px;}
.sinp:focus{border-color:rgba(0,207,255,.35);}
.sbtn{border:none;padding:8px 14px;font-family:'Orbitron',sans-serif;font-size:.55rem;font-weight:700;letter-spacing:1.5px;border-radius:0 3px 3px 0;cursor:pointer;}
.sbtn.g{background:var(--g);color:#050810;}
.sbtn.b{background:var(--b);color:#050810;}
.sbtn.y{background:var(--y);color:#050810;}
.sbtn.p{background:var(--p);color:#fff;}
.sfinp{width:100%;background:rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.07);border-radius:3px;color:#c0d8ff;font-family:'Share Tech Mono',monospace;font-size:.65rem;padding:8px 11px;outline:none;letter-spacing:1px;margin-bottom:7px;}
.sfinp:focus{border-color:rgba(0,207,255,.35);}
.sok{display:none;font-size:.58rem;color:var(--g);margin-top:6px;letter-spacing:.8px;}
.serr{display:none;font-size:.58rem;color:var(--p);margin-top:6px;letter-spacing:.8px;}
.themes{display:flex;gap:9px;flex-wrap:wrap;}
.tdot{width:40px;height:40px;border-radius:50%;cursor:pointer;border:2px solid transparent;transition:all .2s;}
.tdot:hover{transform:scale(1.1);}
.tdot.sel{border-color:#fff;box-shadow:0 0 12px rgba(255,255,255,.35);}
.cover-opts,.panic-opts{display:flex;gap:7px;flex-wrap:wrap;}
.copt,.popt{background:none;border:1px solid rgba(255,0,170,.15);color:#445566;padding:6px 13px;font-family:'Share Tech Mono',monospace;font-size:.59rem;letter-spacing:.8px;border-radius:3px;cursor:pointer;transition:all .2s;}
.copt:hover,.popt:hover{background:rgba(255,0,170,.08);border-color:rgba(255,0,170,.3);color:var(--p);}
.copt.on,.popt.on{background:rgba(255,0,170,.1);border-color:rgba(255,0,170,.35);color:var(--p);}

/* â•â•â•â•â•â•â•â•â•â•â• CHAT â•â•â•â•â•â•â•â•â•â•â• */
#chatPage{flex-direction:column;}
.ch-hdr{padding:11px 16px;border-bottom:1px solid rgba(255,0,170,.1);background:rgba(0,0,0,.3);display:flex;align-items:center;gap:10px;flex-wrap:wrap;flex-shrink:0;}
.ch-title{font-family:'Orbitron',sans-serif;font-size:.65rem;color:var(--p);letter-spacing:2.5px;}
#chatRoomName{font-size:.6rem;color:#334455;flex:1;}
.ch-ctrl{display:flex;align-items:center;gap:6px;flex-wrap:wrap;}
.ch-ctrl span{font-size:.56rem;color:#223322;letter-spacing:.8px;}
.ch-ctrl input{background:rgba(255,0,170,.06);border:1px solid rgba(255,0,170,.2);border-radius:3px;color:var(--p);font-family:'Share Tech Mono',monospace;font-size:.6rem;padding:5px 8px;outline:none;letter-spacing:.8px;}
.ch-ctrl button{background:var(--p);border:none;color:#fff;padding:5px 10px;font-family:'Orbitron',sans-serif;font-size:.53rem;font-weight:700;letter-spacing:.8px;border-radius:3px;cursor:pointer;}
#chatLog{flex:1;overflow-y:auto;padding:13px 16px;display:flex;flex-direction:column;gap:8px;}
.ch-in{display:flex;padding:10px 13px;border-top:1px solid rgba(255,0,170,.1);background:rgba(0,0,0,.3);flex-shrink:0;}
.ch-in input{flex:1;background:rgba(255,0,170,.04);border:1px solid rgba(255,0,170,.18);border-right:none;border-radius:3px 0 0 3px;color:#c0d8ff;font-family:'Share Tech Mono',monospace;font-size:.68rem;padding:9px 12px;outline:none;letter-spacing:.8px;}
.ch-in button{background:var(--p);border:none;color:#fff;padding:9px 16px;font-family:'Orbitron',sans-serif;font-size:.58rem;font-weight:700;letter-spacing:1.5px;border-radius:0 3px 3px 0;cursor:pointer;}
</style>
</head>
<body>

<!-- COVER -->
<div id="cover">
  <div id="cover-top">
    <svg width="74" height="24" viewBox="0 0 74 24"><path d="M9.24 8.19v2.46h5.88c-.18 1.38-.64 2.39-1.34 3.1-.86.86-2.2 1.8-4.54 1.8-3.62 0-6.45-2.92-6.45-6.54s2.83-6.54 6.45-6.54c1.95 0 3.38.77 4.43 1.76L15.4 2.5C13.86 1.05 11.8 0 9.24 0 4.28 0 .11 4.04.11 9s4.17 9 9.13 9c2.68 0 4.7-.88 6.28-2.52 1.62-1.62 2.13-3.91 2.13-5.75 0-.57-.04-1.1-.13-1.54H9.24z" fill="#4285F4"/><path d="M25 6.19c-3.21 0-5.83 2.44-5.83 5.81 0 3.34 2.62 5.81 5.83 5.81s5.83-2.46 5.83-5.81c0-3.37-2.62-5.81-5.83-5.81zm0 9.33c-1.76 0-3.28-1.45-3.28-3.52 0-2.09 1.52-3.52 3.28-3.52s3.28 1.43 3.28 3.52c0 2.07-1.52 3.52-3.28 3.52z" fill="#EA4335"/><path d="M53.58 7.49h-.09c-.57-.68-1.67-1.3-3.06-1.3C47.53 6.19 45 8.72 45 12c0 3.26 2.53 5.81 5.43 5.81 1.39 0 2.49-.62 3.06-1.32h.09v.81c0 2.22-1.19 3.41-3.1 3.41-1.56 0-2.53-1.12-2.93-2.07l-2.22.92c.64 1.54 2.33 3.43 5.15 3.43 2.99 0 5.52-1.76 5.52-6.05V6.49h-2.42v1zm-2.93 8.03c-1.76 0-3.1-1.5-3.1-3.52 0-2.05 1.34-3.52 3.1-3.52 1.74 0 3.1 1.5 3.1 3.54.01 2.03-1.36 3.5-3.1 3.5z" fill="#4285F4"/><path d="M38 6.19c-3.21 0-5.83 2.44-5.83 5.81 0 3.34 2.62 5.81 5.83 5.81s5.83-2.46 5.83-5.81c0-3.37-2.62-5.81-5.83-5.81zm0 9.33c-1.76 0-3.28-1.45-3.28-3.52 0-2.09 1.52-3.52 3.28-3.52s3.28 1.43 3.28 3.52c0 2.07-1.52 3.52-3.28 3.52z" fill="#FBBC05"/><path d="M58.77 1h2.55v16.8h-2.55z" fill="#34A853"/><path d="M63.81 12.18c-.06-3.77 2.93-5.99 5.09-5.99 1.7 0 3.14.85 3.62 2.07l-8.71 3.92zm8.86 2.67c-.53 1.41-1.91 2.22-3.6 2.22-2.14 0-3.99-1.58-4.06-3.96l10.95-4.52-.37-.93c-.68-1.84-2.76-5.23-7.02-5.23-4.23 0-7.75 3.33-7.75 7.69 0 4.31 3.48 7.69 8.15 7.69 3.77 0 5.95-2.3 6.86-3.64l-2.16-1.32z" fill="#EA4335"/></svg>
  </div>
  <div id="cover-mid">
    <div class="g-avatar"><svg width="26" height="26" viewBox="0 0 24 24" fill="#fff"><path d="M12 12c2.7 0 4.8-2.1 4.8-4.8S14.7 2.4 12 2.4 7.2 4.5 7.2 7.2 9.3 12 12 12zm0 2.4c-3.2 0-9.6 1.6-9.6 4.8v2.4h19.2v-2.4c0-3.2-6.4-4.8-9.6-4.8z"/></svg></div>
    <div class="g-welcome">Welcome back</div>
    <div class="g-email-chip"><svg width="14" height="14" viewBox="0 0 24 24" fill="#4285f4"><path d="M12 12c2.7 0 4.8-2.1 4.8-4.8S14.7 2.4 12 2.4 7.2 4.5 7.2 7.2 9.3 12 12 12zm0 2.4c-3.2 0-9.6 1.6-9.6 4.8v2.4h19.2v-2.4c0-3.2-6.4-4.8-9.6-4.8z"/></svg><span style="font-family:Arial;font-size:14px;color:#202124">student@school.edu</span><svg width="14" height="14" viewBox="0 0 24 24" fill="#5f6368"><path d="M7 10l5 5 5-5z"/></svg></div>
    <div class="g-field-label">Enter your password</div>
    <div class="g-field-sub">to continue to Google</div>
    <div class="g-pass-wrap">
      <input id="coverPass" type="password" autocomplete="current-password" placeholder="Enter password"
        onfocus="this.style.borderColor='#4285f4';this.style.boxShadow='0 0 0 2px rgba(66,133,244,.2)'"
        onblur="this.style.borderColor='#dadce0';this.style.boxShadow='none'"
        onkeydown="if(event.key==='Enter')tryLogin()">
      <button class="g-eye" onclick="(function(){var i=document.getElementById('coverPass');i.type=i.type==='password'?'text':'password';})()">ğŸ‘</button>
    </div>
    <div id="coverError">Wrong password. Try again.</div>
    <div class="g-forgot">Forgot password?</div>
    <div class="g-actions">
      <button class="g-ghost">Create account</button>
      <button id="coverNext" onclick="tryLogin()">Next</button>
    </div>
  </div>
  <div class="g-footer"><span>English (US)</span><span>Help</span><span>Privacy</span><span>Terms</span></div>
</div>

<!-- APP -->
<div id="app">
  <canvas id="matrixCanvas"></canvas>
  <div id="flash"></div>
  <div id="neonBar"></div>
  <div id="toasts"></div>
  <div id="panic"><iframe id="panicFrame" src="" style="width:100%;height:100%;border:none;"></iframe></div>
  <div id="splash">
    <div class="sp-logo">StudyHub<span>.</span>Pro</div>
    <div class="sp-sub">LEARNING DASHBOARD</div>
    <div class="sp-bar-wrap"><div class="sp-bar" id="spBar"></div></div>
    <div id="spMsg">INITIALIZING...</div>
  </div>

  <!-- TOPBAR -->
  <div id="topbar">
    <div class="logo">StudyHub<span>.</span>Pro</div>
    <div id="tabs">
      <button class="tab on" onclick="switchPage('g',this)">ğŸ® GAMES</button>
      <button class="tab" onclick="switchPage('m',this)">ğŸµ MUSIC</button>
      <button class="tab" onclick="switchPage('ai',this)">ğŸ¤– AI TUTOR</button>
      <button class="tab" onclick="switchPage('apps',this)">ğŸ“š RESOURCES</button>
      <button class="tab" onclick="switchPage('settings',this)">âš™ï¸ SETTINGS</button>
      <button class="tab" onclick="switchPage('chat',this)">ğŸ’¬ CHAT</button>
    </div>
    <div id="tb-right">
      <div id="wxBadge"></div>
      <div class="esc-hint">ESC=HIDE</div>
    </div>
  </div>

  <!-- MAIN -->
  <div id="main">

    <!-- GAMES -->
    <div class="page on" id="gPage">
      <div id="gMain">
        <div id="gBackBar">
          <button class="gbk" onclick="closeGame()">â† BACK</button>
          <span id="gCurName"></span>
          <button class="gfull" onclick="goFull()">â›¶ FULLSCREEN</button>
        </div>
        <div id="gSearch"><input id="gsInp" type="text" placeholder="ğŸ” Search games..." oninput="filterGames(this.value)"></div>
        <div id="gGridWrap"><div id="gGrid"></div></div>
        <div id="gFrame"></div>
      </div>
      <div id="gSide">
        <button class="catbtn on" onclick="setCat(this,'all')">â­ ALL</button>
        <button class="catbtn" onclick="setCat(this,'offline')">ğŸ“´ OFFLINE</button>
        <button class="catbtn" onclick="setCat(this,'action')">ğŸ“Œ ACTION</button>
        <button class="catbtn" onclick="setCat(this,'puzzle')">ğŸ§© PUZZLE</button>
        <button class="catbtn" onclick="setCat(this,'racing')">ğŸ RACING</button>
        <button class="catbtn" onclick="setCat(this,'shooter')">ğŸ¯ SHOOTER</button>
        <button class="catbtn" onclick="setCat(this,'sports')">âš½ SPORTS</button>
        <button class="catbtn" onclick="setCat(this,'io')">ğŸŒ .IO</button>
        <button class="catbtn" onclick="setCat(this,'classic')">ğŸ•¹ CLASSIC</button>
      </div>
    </div>

    <!-- MUSIC -->
    <div class="page" id="mPage">
      <div id="mSide">
        <div class="m-hdr">ğŸµ FIND MUSIC</div>
        <input id="mSearch" type="text" placeholder="Search songs, artists..." onkeydown="if(event.key==='Enter')searchMusic()">
        <div id="mResults"><div style="padding:18px 10px;font-size:.6rem;color:#1a2a3a;letter-spacing:1.5px;text-align:center;">Search a song to begin</div></div>
      </div>
      <div id="mMain">
        <div class="now-art"><span id="nowArtwork">ğŸµ</span></div>
        <div class="now-info">
          <div id="nowTitle">NO TRACK SELECTED</div>
          <div id="nowArtist">Search above and pick a song</div>
        </div>
        <div id="lyricsPanel"><div class="lyric-line">â™¬ Pick a track to start</div></div>
        <div id="mPlayer">
          <div class="prog-row">
            <span class="t-lbl" id="timeCur">0:00</span>
            <div id="progBar" onclick="seekAudio(event)"><div id="progFill"></div></div>
            <span class="t-lbl" id="timeTot">0:00</span>
            <div class="wf" id="waveEl"><div class="wb"></div><div class="wb"></div><div class="wb"></div><div class="wb"></div><div class="wb"></div><div class="wb"></div></div>
          </div>
          <div class="m-ctrls">
            <button class="mc" onclick="shuffleTrack()" title="Shuffle">ğŸ”€</button>
            <button class="mc" onclick="prevTrack()">â®</button>
            <button class="mc play" id="playBtn" onclick="togglePlay()">â–¶</button>
            <button class="mc" onclick="nextTrack()">â­</button>
            <button class="mc" id="repeatBtn" onclick="toggleRepeat()">ğŸ”</button>
          </div>
          <div class="vol-row"><span>ğŸ”ˆ</span><input type="range" class="vol" min="0" max="100" value="80" oninput="setVol(this.value)"><span>ğŸ”Š</span></div>
        </div>
      </div>
    </div>

    <!-- AI -->
    <div class="page" id="aiPage">
      <div class="ai-side">
        <button class="aitool on" onclick="setAI(this,'chat')">ğŸ’¬ AI CHAT</button>
        <button class="aitool" onclick="setAI(this,'translate')">ğŸŒ TRANSLATE</button>
        <button class="aitool" onclick="setAI(this,'summarize')">ğŸ“ SUMMARIZE</button>
      </div>
      <div id="aiMain">
        <div class="aipane on" id="aipane-chat">
          <div id="chatMsgs"></div>
          <div class="chat-in"><input id="chatInput" type="text" placeholder="Ask anything â€” homework, math, essays..." onkeydown="if(event.key==='Enter')sendChat()"><button onclick="sendChat()">SEND</button></div>
        </div>
        <div class="aipane" id="aipane-translate">
          <div class="tool-wrap">
            <h2>ğŸŒ TRANSLATOR</h2>
            <div class="tool-row">
              <div style="flex:1;display:flex;flex-direction:column;gap:5px;">
                <select id="fromLang" class="tool-sel"><option value="auto">Auto Detect</option><option value="en">English</option><option value="es">Spanish</option><option value="fr">French</option><option value="de">German</option><option value="ja">Japanese</option><option value="zh">Chinese</option><option value="ar">Arabic</option><option value="pt">Portuguese</option><option value="ru">Russian</option></select>
                <textarea id="transIn" class="tool-ta" rows="9" placeholder="Enter text..."></textarea>
              </div>
              <div style="padding:0 10px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:7px;">
                <button class="tool-btn" onclick="doTranslate()">â†’<br>GO</button>
              </div>
              <div style="flex:1;display:flex;flex-direction:column;gap:5px;">
                <select id="toLang" class="tool-sel"><option value="es">Spanish</option><option value="en">English</option><option value="fr">French</option><option value="de">German</option><option value="ja">Japanese</option><option value="zh">Chinese</option><option value="ar">Arabic</option><option value="pt">Portuguese</option><option value="ru">Russian</option></select>
                <textarea id="transOut" class="tool-ta" rows="9" readonly placeholder="Translation..."></textarea>
              </div>
            </div>
          </div>
        </div>
        <div class="aipane" id="aipane-summarize">
          <div class="tool-wrap">
            <h2>ğŸ“ SUMMARIZER</h2>
            <textarea id="sumIn" class="tool-ta" rows="7" style="width:100%;max-width:620px;" placeholder="Paste long text here..."></textarea>
            <button class="tool-btn" onclick="doSummarize()">SUMMARIZE</button>
            <div id="sumOut" class="tool-out" style="width:100%;max-width:620px;"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- APPS -->
    <div class="page" id="appsPage">
      <div id="appsView">
        <div class="apps-hdr">ğŸ“š STUDY RESOURCES &amp; TOOLS</div>
        <div class="apps-grid" id="appsGrid"></div>
      </div>
      <div id="appViewer">
        <div class="avBar">
          <button class="avBtn pink" onclick="closeApp()">â† BACK</button>
          <span id="avName"></span>
          <button class="avBtn" onclick="window.open(curAppUrl,'_blank')">â†— NEW TAB</button>
        </div>
        <div id="appBlockMsg">
          <div style="font-size:2.2rem;">ğŸš«</div>
          <div style="font-family:'Orbitron',sans-serif;font-size:.8rem;color:var(--p);letter-spacing:3px;">SITE BLOCKED FRAMES</div>
          <div style="font-size:.67rem;color:#445566;line-height:1.85;max-width:360px;">This site blocks embedding. Open it in a new tab instead.</div>
          <button class="avBtn" onclick="window.open(curAppUrl,'_blank')" style="margin-top:8px;">â†— OPEN NEW TAB</button>
          <button class="avBtn pink" onclick="closeApp()" style="margin-top:4px;">â† BACK</button>
        </div>
        <iframe id="appFrame" allow="fullscreen *; autoplay *; clipboard-write *" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox allow-top-navigation-by-user-activation"></iframe>
      </div>
    </div>

    <!-- SETTINGS -->
    <div class="page" id="settingsPage">
      <div class="s-inner">
        <div class="s-title">âš™ï¸ SETTINGS</div>

        <div class="scard" style="border:1px solid rgba(255,204,0,.2);">
          <div class="scard-title" style="color:var(--y);">ğŸ”— UNBLOCKER 1 â€” RESOURCE HUB</div>
          <div class="scard-sub">Change the primary unblocker URL (password required)</div>
          <input id="ub1Url" class="sfinp" type="text" value="https://learn.szczech.com.ar/" placeholder="Unblocker URL...">
          <div class="srow">
            <input id="ub1Pass" class="sinp" type="password" placeholder="Password..." onkeydown="if(event.key==='Enter')saveUB(1)">
            <button class="sbtn y" onclick="saveUB(1)">SAVE</button>
          </div>
          <div id="ub1ok" class="sok">âœ… Saved!</div><div id="ub1err" class="serr">âŒ Wrong password</div>
        </div>

        <div class="scard" style="border:1px solid rgba(255,204,0,.15);">
          <div class="scard-title" style="color:var(--y);">ğŸš€ UNBLOCKER 2 â€” OUTERSPACE</div>
          <div class="scard-sub">Change the secondary unblocker URL (password required)</div>
          <input id="ub2Url" class="sfinp" type="text" value="https://outerspace.is-a.software/&" placeholder="Unblocker 2 URL...">
          <div class="srow">
            <input id="ub2Pass" class="sinp" type="password" placeholder="Password..." onkeydown="if(event.key==='Enter')saveUB(2)">
            <button class="sbtn y" onclick="saveUB(2)">SAVE</button>
          </div>
          <div id="ub2ok" class="sok">âœ… Saved!</div><div id="ub2err" class="serr">âŒ Wrong password</div>
        </div>

        <div class="scard" style="border:1px solid rgba(0,255,136,.15);">
          <div class="scard-title" style="color:var(--g);">ğŸ”’ CHANGE PASSWORD</div>
          <div class="scard-sub">Change the lock screen password</div>
          <input id="passOld" class="sfinp" type="password" placeholder="Current password">
          <input id="passNew" class="sfinp" type="password" placeholder="New password">
          <button class="sbtn g" onclick="savePass()">SAVE PASSWORD</button>
          <div id="passOk" class="sok">âœ… Password changed!</div><div id="passErr" class="serr">âŒ Wrong current password</div>
        </div>

        <div class="scard" style="border:1px solid rgba(0,207,255,.15);">
          <div class="scard-title" style="color:var(--b);">ğŸ¨ THEME</div>
          <div class="scard-sub">Pick your accent colors</div>
          <div class="themes">
            <div class="tdot sel" style="background:linear-gradient(135deg,#00ff88,#00cfff)" onclick="setTheme('#00ff88','#00cfff')"></div>
            <div class="tdot" style="background:linear-gradient(135deg,#ff00aa,#ff6600)" onclick="setTheme('#ff00aa','#ff6600')"></div>
            <div class="tdot" style="background:linear-gradient(135deg,#a855f7,#ec4899)" onclick="setTheme('#a855f7','#ec4899')"></div>
            <div class="tdot" style="background:linear-gradient(135deg,#f59e0b,#ef4444)" onclick="setTheme('#f59e0b','#ef4444')"></div>
            <div class="tdot" style="background:linear-gradient(135deg,#06b6d4,#3b82f6)" onclick="setTheme('#06b6d4','#3b82f6')"></div>
          </div>
          <div id="themeOk" class="sok" style="margin-top:9px;">âœ… Theme applied!</div>
        </div>

        <div class="scard" style="border:1px solid rgba(255,0,170,.15);">
          <div class="scard-title" style="color:var(--p);">ğŸ­ COVER SCREEN STYLE</div>
          <div class="scard-sub">What the page looks like before unlocking</div>
          <div class="cover-opts" id="coverOpts">
            <button class="copt on" id="copt-google" onclick="setCover('google')">ğŸ”µ Google Login</button>
            <button class="copt" id="copt-classroom" onclick="setCover('classroom')">ğŸ“š Classroom</button>
            <button class="copt" id="copt-docs" onclick="setCover('docs')">ğŸ“ Google Docs</button>
            <button class="copt" id="copt-blank" onclick="setCover('blank')">â¬œ Blank White</button>
          </div>
        </div>

        <div class="scard" style="border:1px solid rgba(255,0,170,.25);">
          <div class="scard-title" style="color:var(--p);">ğŸš¨ PANIC / ESC KEY</div>
          <div class="scard-sub">Press ESC to instantly hide the screen. Choose overlay:</div>
          <div class="panic-opts" style="margin-bottom:11px;" id="panicOpts">
            <button class="popt on" id="popt-blank" onclick="setPanic('blank')">â¬œ Blank</button>
            <button class="popt" id="popt-classroom" onclick="setPanic('classroom')">ğŸ“š Classroom</button>
            <button class="popt" id="popt-docs" onclick="setPanic('docs')">ğŸ“ Docs</button>
            <button class="popt" id="popt-search" onclick="setPanic('search')">ğŸ” Search</button>
          </div>
          <button class="sbtn p" onclick="triggerPanic()">ğŸš¨ TEST PANIC</button>
        </div>

        <div class="scard" style="border:1px solid rgba(0,207,255,.15);">
          <div class="scard-title" style="color:var(--b);">ğŸŒ¤ WEATHER WIDGET</div>
          <div class="scard-sub">Live weather in the top bar</div>
          <div class="srow">
            <input id="wxCity" class="sinp" type="text" placeholder="New York, London, Tokyo..." onkeydown="if(event.key==='Enter')fetchWeather()">
            <button class="sbtn b" onclick="fetchWeather()">GET</button>
          </div>
          <div id="wxResult" style="font-size:.62rem;color:#334455;margin-top:8px;letter-spacing:.8px;"></div>
        </div>
      </div>
    </div>

    <!-- CHAT -->
    <div class="page" id="chatPage">
      <div class="ch-hdr">
        <div class="ch-title">ğŸ’¬ SECRET CHAT</div>
        <div id="chatRoomName">Enter room code to connect</div>
        <div class="ch-ctrl">
          <span>ROOM:</span><input id="roomIn" type="text" maxlength="20" placeholder="code..." style="width:120px;" onkeydown="if(event.key==='Enter')joinRoom()">
          <button onclick="joinRoom()">JOIN</button>
        </div>
        <div class="ch-ctrl">
          <span>NAME:</span><input id="nameIn" type="text" maxlength="16" placeholder="name..." style="width:100px;">
        </div>
      </div>
      <div id="chatLog"><div style="text-align:center;font-size:.59rem;color:#1a2a1a;letter-spacing:1.5px;padding:22px;">Enter a room code and name to connect ğŸ”’</div></div>
      <div class="ch-in">
        <input id="chatMsgIn" type="text" placeholder="Type a message... (Enter to send)" maxlength="200" onkeydown="if(event.key==='Enter')sendMsg()">
        <button onclick="sendMsg()">SEND</button>
      </div>
    </div>

  </div><!-- /main -->
</div><!-- /app -->

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PASSWORD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let PW = localStorage.getItem('nx_pw') || 'Jesus247';
document.getElementById('coverPass').focus();

function tryLogin() {
  const inp = document.getElementById('coverPass');
  const err = document.getElementById('coverError');
  if (!inp.value) return;
  if (inp.value === PW) {
    err.style.display = 'none';
    inp.style.borderColor = '#34a853';
    inp.style.boxShadow = '0 0 0 2px rgba(52,168,83,.2)';
    const btn = document.getElementById('coverNext');
    btn.textContent = 'âœ“'; btn.style.background = '#34a853';
    setTimeout(unlock, 380);
  } else {
    err.style.display = 'block';
    inp.style.borderColor = '#d93025';
    inp.style.boxShadow = '0 0 0 2px rgba(217,48,37,.2)';
    inp.value = '';
    setTimeout(() => { inp.style.borderColor = '#dadce0'; inp.style.boxShadow = 'none'; }, 2200);
  }
}

function unlock() {
  document.getElementById('cover').style.display = 'none';
  document.getElementById('app').style.display = 'flex';
  initSplash();
  initMatrix();
  renderGames();
  buildApps();
  aiMsg('ai', 'Hey! I\'m StudyBot ğŸ“š Ask me anything â€” homework help, essays, math, or just chat!');
  setTimeout(() => { fireworks(); toast('ğŸ”“ UNLOCKED', 'Welcome to StudyHub Pro!'); }, 600);
  loadSettings();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchPage(id, btn) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('on'));
  document.querySelectorAll('.tab').forEach(b => b.classList.remove('on'));
  const pg = document.getElementById(id + 'Page');
  if (pg) pg.classList.add('on');
  if (btn) btn.classList.add('on');
  runLoader();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SPLASH + MATRIX
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initSplash() {
  const bar = document.getElementById('spBar');
  const msg = document.getElementById('spMsg');
  const msgs = ['INITIALIZING...','LOADING GAMES...','STARTING MUSIC...','UNLOCKING...','READY âœ“'];
  let w = 0, mi = 0;
  const iv = setInterval(() => {
    w += Math.random() * 16 + 5;
    if (w >= 100) { w = 100; clearInterval(iv); }
    bar.style.width = w + '%';
    if (w > mi * 20 && mi < msgs.length) msg.textContent = msgs[mi++];
  }, 110);
  setTimeout(() => {
    const s = document.getElementById('splash');
    s.style.opacity = '0';
    setTimeout(() => s.style.display = 'none', 500);
  }, 1600);
}

function initMatrix() {
  const canvas = document.getElementById('matrixCanvas');
  canvas.width = window.innerWidth; canvas.height = window.innerHeight;
  window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
  const ctx = canvas.getContext('2d');
  const chars = 'ã‚¢ã‚¤ã‚¦ã‚¨ã‚ªã‚«ã‚­ã‚¯ã‚±ã‚³0123456789ABCDEF<>{}[]|\\';
  const fs = 13;
  let cols = Math.floor(canvas.width / fs);
  let drops = Array(cols).fill(1);
  setInterval(() => {
    ctx.fillStyle = 'rgba(6,9,16,.05)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#00ff88';
    ctx.font = fs + 'px monospace';
    drops.forEach((y, i) => {
      ctx.fillText(chars[Math.floor(Math.random() * chars.length)], i * fs, y * fs);
      if (y * fs > canvas.height && Math.random() > .975) drops[i] = 0;
      drops[i]++;
    });
  }, 50);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOADER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function runLoader() {
  const bar = document.getElementById('neonBar');
  bar.style.width = '0';
  bar.style.opacity = '1';
  let w = 0;
  const iv = setInterval(() => {
    w += Math.random() * 18 + 8;
    if (w >= 100) { w = 100; clearInterval(iv); setTimeout(() => bar.style.opacity = '0', 200); }
    bar.style.width = w + '%';
  }, 60);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(title, msg, color) {
  const c = document.getElementById('toasts');
  const t = document.createElement('div');
  t.className = 'toast';
  t.innerHTML = '<div class="toast-title" style="color:' + (color||'var(--g)') + '">' + title + '</div>' + msg;
  t.onclick = () => t.remove();
  c.appendChild(t);
  setTimeout(() => t.style.opacity = '0', 3000);
  setTimeout(() => t.remove(), 3300);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREWORKS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fireworks() {
  const c = document.createElement('canvas');
  c.style.cssText = 'position:fixed;inset:0;pointer-events:none;z-index:9994;';
  c.width = window.innerWidth; c.height = window.innerHeight;
  document.body.appendChild(c);
  const ctx = c.getContext('2d');
  const parts = [];
  const cols = ['#00ff88','#00cfff','#ff00aa','#ffcc00','#ff6600','#a855f7'];
  const burst = (x, y) => {
    for (let i = 0; i < 55; i++) {
      const a = (Math.PI * 2 / 55) * i;
      const sp = Math.random() * 5 + 2;
      parts.push({ x, y, vx: Math.cos(a)*sp, vy: Math.sin(a)*sp, col: cols[Math.floor(Math.random()*cols.length)], life: 1 });
    }
  };
  const pts = [[.25,.35],[.75,.3],[.5,.5],[.2,.6],[.8,.6]];
  let bi = 0;
  const biv = setInterval(() => { if (bi >= pts.length) { clearInterval(biv); } else { burst(c.width*pts[bi][0], c.height*pts[bi][1]); bi++; } }, 200);
  const anim = () => {
    ctx.clearRect(0, 0, c.width, c.height);
    parts.forEach((p, i) => { p.x += p.vx; p.y += p.vy; p.vy += .08; p.life -= .018; ctx.globalAlpha = Math.max(0, p.life); ctx.fillStyle = p.col; ctx.beginPath(); ctx.arc(p.x, p.y, 3, 0, Math.PI*2); ctx.fill(); });
    ctx.globalAlpha = 1;
    for (let i = parts.length-1; i >= 0; i--) if (parts[i].life <= 0) parts.splice(i, 1);
    if (bi <= pts.length || parts.length > 0) requestAnimationFrame(anim); else c.remove();
  };
  requestAnimationFrame(anim);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAMES DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Offline games as blob URLs
function makeBlob(html) {
  return URL.createObjectURL(new Blob([html], { type: 'text/html' }));
}

const OFFLINE_GAMES = {
  snake: `<!DOCTYPE html><html><head><style>*{margin:0;padding:0;box-sizing:border-box}body{background:#060910;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;font-family:'Courier New',monospace;color:#00ff88}#info{margin-bottom:12px;font-size:14px;letter-spacing:3px;display:flex;gap:28px}canvas{border:2px solid #00ff88;box-shadow:0 0 30px #00ff8840}#hint{margin-top:12px;font-size:12px;color:#446688;letter-spacing:2px}</style></head><body><div id="info"><span>SCORE <b id="sc">0</b></span><span>BEST <b id="bs">0</b></span></div><canvas id="c" width="400" height="400"></canvas><div id="hint">ARROW KEYS / WASD â€” SPACE RESTART</div><script>const c=document.getElementById('c'),ctx=c.getContext('2d'),S=20,W=20,H=20;let sn=[{x:10,y:10}],d={x:1,y:0},food={x:5,y:5},sc=0,best=0,alive=true,spd=150,last=0;function rf(){food={x:Math.floor(Math.random()*W),y:Math.floor(Math.random()*H)};}function draw(ts){if(!alive)return;if(ts-last<spd){requestAnimationFrame(draw);return;}last=ts;let h={x:sn[0].x+d.x,y:sn[0].y+d.y};if(h.x<0||h.x>=W||h.y<0||h.y>=H||sn.some(s=>s.x===h.x&&s.y===h.y)){alive=false;ctx.fillStyle='rgba(0,0,0,.75)';ctx.fillRect(0,0,400,400);ctx.fillStyle='#ff00aa';ctx.font='bold 28px Courier';ctx.textAlign='center';ctx.fillText('GAME OVER',200,185);ctx.fillStyle='#00ff88';ctx.font='14px Courier';ctx.fillText('SCORE: '+sc,200,215);ctx.fillText('SPACE TO RESTART',200,242);return;}sn.unshift(h);if(h.x===food.x&&h.y===food.y){sc++;spd=Math.max(60,spd-2);document.getElementById('sc').textContent=sc;if(sc>best){best=sc;document.getElementById('bs').textContent=best;}rf();}else sn.pop();ctx.fillStyle='#060910';ctx.fillRect(0,0,400,400);sn.forEach((s,i)=>{ctx.fillStyle=i===0?'#00ff88':'hsl('+(140-i*1.8)+',100%,'+(50-i*.3)+'%)';ctx.shadowColor='#00ff88';ctx.shadowBlur=i===0?12:0;ctx.fillRect(s.x*S+1,s.y*S+1,S-2,S-2);});ctx.fillStyle='#ff3366';ctx.shadowColor='#ff3366';ctx.shadowBlur=10;ctx.fillRect(food.x*S+2,food.y*S+2,S-4,S-4);ctx.shadowBlur=0;requestAnimationFrame(draw);}function reset(){sn=[{x:10,y:10}];d={x:1,y:0};sc=0;spd=150;alive=true;document.getElementById('sc').textContent=0;rf();requestAnimationFrame(draw);}document.addEventListener('keydown',e=>{if(!alive&&e.code==='Space'){reset();return;}const m={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0},KeyW:{x:0,y:-1},KeyS:{x:0,y:1},KeyA:{x:-1,y:0},KeyD:{x:1,y:0}};const nd=m[e.code];if(nd&&!(nd.x===-d.x&&nd.y===-d.y)&&!(nd.x===d.x&&nd.y===d.y)){d=nd;e.preventDefault();}});reset();<\/script></body></html>`,
  tetris: `<!DOCTYPE html><html><head><style>*{margin:0;padding:0;box-sizing:border-box}body{background:#060910;display:flex;align-items:center;justify-content:center;height:100vh;font-family:'Courier New',monospace;gap:18px}canvas{border:2px solid #00cfff;box-shadow:0 0 30px #00cfff30}#side{color:#fff;display:flex;flex-direction:column;gap:12px;min-width:105px}.panel{background:#0a1525;border:1px solid #00cfff18;padding:9px;border-radius:5px}.panel label{display:block;font-size:10px;color:#446688;letter-spacing:2px;margin-bottom:4px}.panel span{font-size:1.3rem;color:#00cfff;font-weight:bold}#next{display:grid;grid-template-columns:repeat(4,17px);gap:2px;margin-top:5px}.nc{width:17px;height:17px;border-radius:2px}p{font-size:10px;color:#334455;letter-spacing:1px;line-height:1.9}</style></head><body><canvas id="c" width="200" height="400"></canvas><div id="side"><div class="panel"><label>SCORE</label><span id="sc">0</span></div><div class="panel"><label>LINES</label><span id="ln">0</span></div><div class="panel"><label>LEVEL</label><span id="lv">1</span></div><div class="panel"><label>NEXT</label><div id="next"></div></div><div class="panel"><p>â† â†’ MOVE<br>â†‘ ROTATE<br>â†“ SOFT DROP<br>SPACE HARD</p></div></div><script>const C=document.getElementById('c'),ctx=C.getContext('2d'),B=20,W=10,H=20;const PS=[[[1,1,1,1]],[[1,1],[1,1]],[[0,1,0],[1,1,1]],[[1,0,0],[1,1,1]],[[0,0,1],[1,1,1]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]]];const CL=['#00cfff','#ffcc00','#ff00aa','#ff6600','#00ff88','#ff3366','#a855f7'];let board,piece,px,py,nxt,score,lines,level,alive,timer;function nb(){return Array(H).fill(0).map(()=>Array(W).fill(0));}function rn(){return Math.floor(Math.random()*PS.length);}function spawn(){let t=nxt??rn();nxt=rn();piece=PS[t].map(r=>[...r]);px=Math.floor(W/2)-Math.floor(piece[0].length/2);py=0;if(col(piece,px,py)){alive=false;clearInterval(timer);ctx.fillStyle='rgba(0,0,0,.8)';ctx.fillRect(0,0,200,400);ctx.fillStyle='#ff00aa';ctx.font='bold 17px Courier';ctx.textAlign='center';ctx.fillText('GAME OVER',100,190);ctx.fillStyle='#00cfff';ctx.font='10px Courier';ctx.fillText('F5 TO RESTART',100,214);}rNext();}function rNext(){let d=document.getElementById('next');d.innerHTML='';let p=PS[nxt];for(let r=0;r<4;r++)for(let c=0;c<4;c++){let el=document.createElement('div');el.className='nc';el.style.background=(p[r]&&p[r][c])?CL[nxt]:'#0d1b2a';d.appendChild(el);}}function col(p,ox,oy){for(let r=0;r<p.length;r++)for(let c=0;c<p[r].length;c++)if(p[r][c]&&(oy+r>=H||ox+c<0||ox+c>=W||board[oy+r][ox+c]))return true;return false;}function place(){piece.forEach((r,ri)=>r.forEach((v,ci)=>{if(v)board[py+ri][px+ci]=PS.indexOf(piece)+1;}));let cl=0;for(let r=H-1;r>=0;r--)if(board[r].every(c=>c)){board.splice(r,1);board.unshift(Array(W).fill(0));cl++;r++;}if(cl){lines+=cl;score+=[0,100,300,500,800][cl]*level;level=Math.floor(lines/10)+1;clearInterval(timer);timer=setInterval(drop,Math.max(50,500-level*38));document.getElementById('sc').textContent=score;document.getElementById('ln').textContent=lines;document.getElementById('lv').textContent=level;}spawn();}function drop(){if(col(piece,px,py+1))place();else py++;render();}function render(){ctx.fillStyle='#060910';ctx.fillRect(0,0,200,400);board.forEach((row,r)=>row.forEach((v,c)=>{if(v){ctx.fillStyle=CL[v-1];ctx.shadowColor=CL[v-1];ctx.shadowBlur=5;ctx.fillRect(c*B+1,r*B+1,B-2,B-2);ctx.shadowBlur=0;}}));let gy=py;while(!col(piece,px,gy+1))gy++;piece.forEach((row,r)=>row.forEach((v,c)=>{if(v){ctx.fillStyle='rgba(255,255,255,.06)';ctx.fillRect((px+c)*B+1,(gy+r)*B+1,B-2,B-2);}}));let ci=PS.indexOf(piece);piece.forEach((row,r)=>row.forEach((v,c)=>{if(v){ctx.fillStyle=CL[ci];ctx.shadowColor=CL[ci];ctx.shadowBlur=8;ctx.fillRect((px+c)*B+1,(py+r)*B+1,B-2,B-2);ctx.shadowBlur=0;}}));}function rot(p){return p[0].map((_,i)=>p.map(r=>r[i]).reverse());}document.addEventListener('keydown',e=>{if(!alive)return;if(e.key==='ArrowLeft'&&!col(piece,px-1,py))px--;else if(e.key==='ArrowRight'&&!col(piece,px+1,py))px++;else if(e.key==='ArrowDown'&&!col(piece,px,py+1))py++;else if(e.key==='ArrowUp'){let r=rot(piece);if(!col(r,px,py))piece=r;}else if(e.key===' '){while(!col(piece,px,py+1))py++;place();}else return;e.preventDefault();render();});function go(){board=nb();score=0;lines=0;level=1;alive=true;document.getElementById('sc').textContent=0;document.getElementById('ln').textContent=0;document.getElementById('lv').textContent=1;nxt=null;spawn();render();timer=setInterval(drop,500);}go();<\/script></body></html>`,
  '2048': `<!DOCTYPE html><html><head><style>*{margin:0;padding:0;box-sizing:border-box}body{background:#060910;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;font-family:'Courier New',monospace;padding:16px}h1{color:#00ff88;letter-spacing:8px;font-size:1.3rem;margin-bottom:9px;text-shadow:0 0 20px #00ff88}#sb{display:flex;gap:16px;margin-bottom:12px}.sb{background:#0a1525;border:1px solid #00ff8825;padding:7px 16px;border-radius:4px;text-align:center}.sb label{display:block;font-size:10px;color:#446688;letter-spacing:2px}.sb span{font-size:1.2rem;color:#00ff88;font-weight:bold}#board{display:grid;grid-template-columns:repeat(4,84px);gap:6px;background:#0a1525;padding:10px;border-radius:7px;border:1px solid #00ff8815}.cell{width:84px;height:84px;border-radius:4px;display:flex;align-items:center;justify-content:center;font-weight:bold;transition:background .1s}#hint{margin-top:11px;color:#446688;font-size:11px;letter-spacing:2px}.btn{margin-top:7px;background:#00ff8818;border:1px solid #00ff88;color:#00ff88;padding:6px 20px;font-family:'Courier New';font-size:11px;letter-spacing:2px;border-radius:3px;cursor:pointer;}</style></head><body><h1>2048</h1><div id="sb"><div class="sb"><label>SCORE</label><span id="sc">0</span></div><div class="sb"><label>BEST</label><span id="bs">0</span></div></div><div id="board"></div><div id="hint">ARROW KEYS TO PLAY</div><button class="btn" onclick="init()">NEW GAME</button><script>const C={'0':'#0d1b2a','2':'#0d3b2e','4':'#0d5c37','8':'#1a7a46','16':'#2d9e5a','32':'#45c46e','64':'#00ff88','128':'#ffcc00','256':'#ff9900','512':'#ff6600','1024':'#ff3300','2048':'#ff00aa'},T={'0':'transparent','2':'#a0d8af','4':'#a0d8af','8':'#fff','16':'#fff','32':'#fff','64':'#060910','128':'#060910','256':'#060910','512':'#060910','1024':'#060910','2048':'#060910'};let grid,score,best=0;function init(){grid=Array(4).fill(0).map(()=>Array(4).fill(0));score=0;at();at();render();}function at(){let e=[];for(let r=0;r<4;r++)for(let c=0;c<4;c++)if(!grid[r][c])e.push([r,c]);if(!e.length)return;let[r,c]=e[Math.floor(Math.random()*e.length)];grid[r][c]=Math.random()<.9?2:4;}function render(){document.getElementById('sc').textContent=score;document.getElementById('bs').textContent=best;let b=document.getElementById('board');b.innerHTML='';grid.forEach(row=>row.forEach(v=>{let d=document.createElement('div');d.className='cell';d.style.background=C[Math.min(v,2048)]||'#ff00aa';d.style.color=T[Math.min(v,2048)]||'#fff';d.style.fontSize=v>=1000?'1rem':v>=100?'1.2rem':'1.45rem';d.textContent=v||'';b.appendChild(d);}));}function sl(row){let r=row.filter(x=>x);for(let i=0;i<r.length-1;i++)if(r[i]===r[i+1]){score+=r[i]*2;if(score>best)best=score;r[i]*=2;r.splice(i+1,1);i++;}while(r.length<4)r.push(0);return r;}function move(dr){let m=false,g=grid.map(r=>[...r]);if(dr==='l')grid=grid.map(r=>{let s=sl(r);if(s.join()!==r.join())m=true;return s;});if(dr==='r')grid=grid.map(r=>{let s=sl([...r].reverse()).reverse();if(s.join()!==r.join())m=true;return s;});if(dr==='u'){for(let c=0;c<4;c++){let col=grid.map(r=>r[c]);let s=sl(col);s.forEach((v,r)=>{if(v!==grid[r][c])m=true;grid[r][c]=v;});}}if(dr==='d'){for(let c=0;c<4;c++){let col=grid.map(r=>r[c]).reverse();let s=sl(col).reverse();s.forEach((v,r)=>{if(v!==grid[r][c])m=true;grid[r][c]=v;});}}if(m){at();render();}}document.addEventListener('keydown',e=>{const m={ArrowLeft:'l',ArrowRight:'r',ArrowUp:'u',ArrowDown:'d'};if(m[e.key]){move(m[e.key]);e.preventDefault();}});let tx=0,ty=0;document.addEventListener('touchstart',e=>{tx=e.touches[0].clientX;ty=e.touches[0].clientY;},{passive:true});document.addEventListener('touchend',e=>{let dx=e.changedTouches[0].clientX-tx,dy=e.changedTouches[0].clientY-ty;if(Math.abs(dx)>Math.abs(dy))move(dx>0?'r':'l');else move(dy>0?'d':'u');},{passive:true});init();<\/script></body></html>`,
  flappy: `<!DOCTYPE html><html><head><style>*{margin:0;padding:0}body{background:#060910;display:flex;align-items:center;justify-content:center;height:100vh}canvas{cursor:pointer;display:block;border:1px solid #00ff8820;}</style></head><body><canvas id="c"></canvas><script>const c=document.getElementById('c'),ctx=c.getContext('2d');c.width=340;c.height=500;let bird,pipes,score,best=0,state,fr;const BX=75,BR=17,G=0.46,JMP=-9,PW=50,GAP=140,PS=2.1;function reset(){bird={y:220,v:0};pipes=[];score=0;state='wait';fr=0;}function addPipe(){pipes.push({x:340,top:75+Math.random()*180,scored:false});}function update(){if(state!=='play')return;bird.v+=G;bird.y+=bird.v;fr++;if(fr%90===0)addPipe();pipes.forEach(p=>p.x-=PS);pipes=pipes.filter(p=>p.x>-PW);pipes.forEach(p=>{if(!p.scored&&p.x+PW<BX){p.scored=true;score++;if(score>best)best=score;}if(BX+BR>p.x&&BX-BR<p.x+PW&&(bird.y-BR<p.top||bird.y+BR>p.top+GAP))state='dead';});if(bird.y+BR>500||bird.y-BR<0)state='dead';}function draw(){ctx.fillStyle='#060910';ctx.fillRect(0,0,340,500);pipes.forEach(p=>{ctx.strokeStyle='#00ff88';ctx.lineWidth=2;ctx.fillStyle='#00ff8815';ctx.fillRect(p.x,0,PW,p.top);ctx.fillRect(p.x,p.top+GAP,PW,500);ctx.strokeRect(p.x,0,PW,p.top);ctx.strokeRect(p.x,p.top+GAP,PW,500);});ctx.save();ctx.translate(BX,bird.y);ctx.rotate(Math.min(Math.max(bird.v*.07,-.48),.48));ctx.fillStyle='#ffcc00';ctx.shadowColor='#ffcc00';ctx.shadowBlur=12;ctx.beginPath();ctx.arc(0,0,BR,0,Math.PI*2);ctx.fill();ctx.fillStyle='#ff6600';ctx.beginPath();ctx.arc(7,0,6,0,Math.PI*2);ctx.fill();ctx.fillStyle='#060910';ctx.beginPath();ctx.arc(8,0,3,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;ctx.restore();ctx.fillStyle='#fff';ctx.font='bold 24px Courier';ctx.textAlign='center';ctx.fillText(score,170,44);ctx.font='10px Courier';ctx.fillStyle='#446688';ctx.fillText('BEST: '+best,170,60);if(state==='wait'){ctx.fillStyle='#00ff88';ctx.font='14px Courier';ctx.fillText('TAP OR SPACE TO START',170,260);}if(state==='dead'){ctx.fillStyle='rgba(0,0,0,.65)';ctx.fillRect(0,0,340,500);ctx.fillStyle='#ff00aa';ctx.font='bold 24px Courier';ctx.fillText('GAME OVER',170,215);ctx.fillStyle='#fff';ctx.font='14px Courier';ctx.fillText('SCORE: '+score,170,248);ctx.fillStyle='#00ff88';ctx.fillText('TAP TO RESTART',170,278);}}function flap(){if(state==='dead'||state==='wait'){reset();state='play';return;}bird.v=JMP;}c.addEventListener('click',flap);document.addEventListener('keydown',e=>{if(e.code==='Space'){flap();e.preventDefault();}});document.addEventListener('touchstart',flap,{passive:true});function loop(){update();draw();requestAnimationFrame(loop);}reset();loop();<\/script></body></html>`,
  dino: `<!DOCTYPE html><html><head><style>*{margin:0;padding:0}body{background:#060910;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;font-family:'Courier New',monospace;color:#00ff88}#info{display:flex;gap:26px;margin-bottom:12px;font-size:13px;letter-spacing:3px}canvas{border:1px solid #00ff8825}#hint{margin-top:10px;font-size:11px;color:#446688;letter-spacing:2px}</style></head><body><div id="info"><span>SCORE <b id="sc">0</b></span><span>BEST <b id="bs">0</b></span></div><canvas id="c" width="680" height="200"></canvas><div id="hint">SPACE/TAP TO JUMP â€” DOUBLE JUMP SUPPORTED!</div><script>const c=document.getElementById('c'),ctx=c.getContext('2d');let dn,obs,score,best=0,alive,spd,fr,jmps;function reset(){dn={x:75,y:150,vy:0,h:38,w:26};obs=[];score=0;alive=true;spd=3.8;fr=0;jmps=0;}function jump(){if(jmps<2){dn.vy=-12.5+(jmps*1.8);jmps++;}}function update(){if(!alive)return;fr++;score=Math.floor(fr/6);spd=3.8+fr/650;if(score>best)best=score;document.getElementById('sc').textContent=score;document.getElementById('bs').textContent=best;dn.vy+=.75;dn.y+=dn.vy;if(dn.y>=150){dn.y=150;dn.vy=0;jmps=0;}let gap=Math.max(36,76-Math.floor(fr/200));if(fr%gap===0)obs.push({x:680,w:16+Math.random()*16,h:26+Math.random()*26,bird:Math.random()<.28&&score>120});obs.forEach(o=>o.x-=spd);obs=obs.filter(o=>o.x>-50);obs.forEach(o=>{let oy=o.bird?105:168-o.h;if(dn.x+dn.w-7>o.x&&dn.x+7<o.x+o.w&&dn.y+dn.h-7>oy&&dn.y+7<oy+o.h)alive=false;});}function draw(){ctx.fillStyle='#060910';ctx.fillRect(0,0,680,200);ctx.strokeStyle='#0a2015';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(0,188);ctx.lineTo(680,188);ctx.stroke();ctx.fillStyle='#00ff88';ctx.shadowColor='#00ff88';ctx.shadowBlur=8;ctx.fillRect(dn.x,dn.y,dn.w,dn.h);ctx.fillRect(dn.x+dn.w,dn.y,7,10);ctx.fillStyle='#060910';ctx.fillRect(dn.x+dn.w-1,dn.y+5,5,5);ctx.shadowBlur=0;obs.forEach(o=>{let oy=o.bird?105:168-o.h;ctx.fillStyle=o.bird?'#ff00aa':'#00cfff';ctx.shadowColor=ctx.fillStyle;ctx.shadowBlur=7;ctx.fillRect(o.x,oy,o.w,o.h);ctx.shadowBlur=0;});if(!alive){ctx.fillStyle='rgba(0,0,0,.72)';ctx.fillRect(0,0,680,200);ctx.fillStyle='#ff00aa';ctx.font='bold 20px Courier';ctx.textAlign='center';ctx.fillText('GAME OVER â€” SPACE/TAP TO RESTART',340,93);}}document.addEventListener('keydown',e=>{if(e.code==='Space'){if(!alive)reset();else jump();e.preventDefault();}});document.addEventListener('touchstart',()=>{if(!alive)reset();else jump();},{passive:true});function loop(){update();draw();requestAnimationFrame(loop);}reset();loop();<\/script></body></html>`,
};

const GAMES = [
  // OFFLINE
  {n:'SNAKE',e:'ğŸ',cat:'offline',key:'snake',r:'4.8',p:'Offline'},
  {n:'TETRIS',e:'ğŸŸ¥',cat:'offline',key:'tetris',r:'4.9',p:'Offline'},
  {n:'2048',e:'ğŸŸ¦',cat:'offline',key:'2048',r:'4.8',p:'Offline'},
  {n:'FLAPPY BIRD',e:'ğŸ¤',cat:'offline',key:'flappy',r:'4.7',p:'Offline'},
  {n:'DINO RUN',e:'ğŸ¦–',cat:'offline',key:'dino',r:'4.8',p:'Offline'},
  // ACTION
  {n:'SLOPE',e:'ğŸ”µ',cat:'action',u:'https://glacierarcade.xyz/html/slope.html',r:'4.9',p:'50M+'},
  {n:'SLOPE 2',e:'ğŸŸ£',cat:'action',u:'https://glacierarcade.xyz/html/slope2.html',r:'4.8',p:'20M+'},
  {n:'SLOPE 3',e:'âš«',cat:'action',u:'https://glacierarcade.xyz/html/slope3.html',r:'4.8',p:'10M+'},
  {n:'RUN 3',e:'ğŸƒ',cat:'action',u:'https://glacierarcade.xyz/html/run3.html',r:'4.9',p:'40M+'},
  {n:'MINECRAFT',e:'â›ï¸',cat:'action',u:'https://glacierarcade.xyz/html/minecraft.html',r:'4.9',p:'50M+'},
  {n:'MINECRAFT PARKOUR',e:'ğŸƒ',cat:'action',u:'https://glacierarcade.xyz/html/minecraft-parkour.html',r:'4.7',p:'5M+'},
  {n:'SUBWAY SURFERS',e:'ğŸ›¹',cat:'action',u:'https://glacierarcade.xyz/html/subway-surfers.html',r:'4.9',p:'80M+'},
  {n:'TEMPLE RUN 2',e:'ğŸŒ´',cat:'action',u:'https://glacierarcade.xyz/html/temple-run-2.html',r:'4.8',p:'40M+'},
  {n:'GEOMETRY DASH',e:'ğŸ”·',cat:'action',u:'https://glacierarcade.xyz/html/gdlite.html',r:'4.8',p:'15M+'},
  {n:'STICKMAN HOOK',e:'ğŸ•¸ï¸',cat:'action',u:'https://glacierarcade.xyz/html/stickman-hook.html',r:'4.8',p:'12M+'},
  {n:'TUNNEL RUSH',e:'ğŸ”´',cat:'action',u:'https://glacierarcade.xyz/html/tunnel-rush.html',r:'4.8',p:'10M+'},
  {n:'CLUSTER RUSH',e:'ğŸš›',cat:'action',u:'https://glacierarcade.xyz/html/cluster-rush.html',r:'4.7',p:'5M+'},
  {n:'HAPPY WHEELS',e:'ğŸ›',cat:'action',u:'https://glacierarcade.xyz/html/happy-wheels-fanmade.html',r:'4.7',p:'10M+'},
  {n:'VEX 5',e:'ğŸƒ',cat:'action',u:'https://glacierarcade.xyz/html/vex5.html',r:'4.7',p:'6M+'},
  {n:'OVO',e:'ğŸŸ¡',cat:'action',u:'https://glacierarcade.xyz/html/ovo.html',r:'4.7',p:'5M+'},
  {n:'PLANTS VS ZOMBIES',e:'ğŸŒ»',cat:'action',u:'https://glacierarcade.xyz/html/pvz.html',r:'4.8',p:'50M+'},
  {n:'FNAF',e:'ğŸ»',cat:'action',u:'https://glacierarcade.xyz/html/fnaf.html',r:'4.7',p:'8M+'},
  // PUZZLE
  {n:'CHESS',e:'â™Ÿï¸',cat:'puzzle',u:'https://glacierarcade.xyz/html/chess.html',r:'4.9',p:'50M+'},
  {n:'WORDLE',e:'ğŸŸ©',cat:'puzzle',u:'https://glacierarcade.xyz/html/wordle.html',r:'4.8',p:'30M+'},
  {n:'BLOONS TD 5',e:'ğŸˆ',cat:'puzzle',u:'https://glacierarcade.xyz/html/btd5.html',r:'4.8',p:'15M+'},
  {n:'COOKIE CLICKER',e:'ğŸª',cat:'puzzle',u:'https://glacierarcade.xyz/html/cookie-clicker.html',r:'4.6',p:'10M+'},
  // RACING
  {n:'DRIFT BOSS',e:'ğŸš—',cat:'racing',u:'https://glacierarcade.xyz/html/drift-boss.html',r:'4.8',p:'15M+'},
  {n:'DRIFT HUNTERS',e:'ğŸï¸',cat:'racing',u:'https://glacierarcade.xyz/html/drift-hunters.html',r:'4.8',p:'8M+'},
  {n:'DRIVE MAD',e:'ğŸš™',cat:'racing',u:'https://glacierarcade.xyz/html/drive-mad.html',r:'4.7',p:'10M+'},
  {n:'MOTO X3M',e:'ğŸï¸',cat:'racing',u:'https://glacierarcade.xyz/html/motox3m.html',r:'4.8',p:'8M+'},
  {n:'MOTO X3M 2',e:'ğŸï¸',cat:'racing',u:'https://glacierarcade.xyz/html/motox3m2.html',r:'4.7',p:'6M+'},
  {n:'TANUKI SUNSET',e:'ğŸ¦',cat:'racing',u:'https://glacierarcade.xyz/html/tanuki-sunset.html',r:'4.7',p:'4M+'},
  {n:'SMASH KARTS',e:'ğŸï¸',cat:'racing',u:'https://glacierarcade.xyz/html/smash-karts.html',r:'4.8',p:'12M+'},
  {n:'MADALIN STUNT CARS 2',e:'ğŸš˜',cat:'racing',u:'https://glacierarcade.xyz/html/madalin-stunt-cars-2.html',r:'4.7',p:'8M+'},
  // SHOOTER
  {n:'1V1.LOL',e:'ğŸ¯',cat:'shooter',u:'https://glacierarcade.xyz/html/1v1lol.html',r:'4.8',p:'25M+'},
  {n:'KRUNKER.IO',e:'ğŸ”«',cat:'shooter',u:'https://glacierarcade.xyz/html/krunkerio.html',r:'4.9',p:'15M+'},
  {n:'SHELL SHOCKERS',e:'ğŸ¥š',cat:'shooter',u:'https://glacierarcade.xyz/html/shell-shockers.html',r:'4.8',p:'10M+'},
  {n:'GETAWAY SHOOTOUT',e:'ğŸ’¨',cat:'shooter',u:'https://glacierarcade.xyz/html/getaway-shootout.html',r:'4.7',p:'8M+'},
  {n:'ROOFTOP SNIPERS',e:'ğŸ™ï¸',cat:'shooter',u:'https://glacierarcade.xyz/html/rooftop-snipers.html',r:'4.7',p:'7M+'},
  {n:'FUNNY SHOOTER 2',e:'ğŸ˜‚',cat:'shooter',u:'https://glacierarcade.xyz/html/funny-shooter-2.html',r:'4.6',p:'5M+'},
  // SPORTS
  {n:'RETRO BOWL',e:'ğŸˆ',cat:'sports',u:'https://glacierarcade.xyz/html/retro-bowl.html',r:'4.9',p:'30M+'},
  {n:'RETRO BOWL COLLEGE',e:'ğŸŸï¸',cat:'sports',u:'https://glacierarcade.xyz/html/retrobowlcollege.html',r:'4.8',p:'10M+'},
  {n:'BASKET RANDOM',e:'ğŸ€',cat:'sports',u:'https://glacierarcade.xyz/html/basket-random.html',r:'4.7',p:'5M+'},
  {n:'SOCCER RANDOM',e:'âš½',cat:'sports',u:'https://glacierarcade.xyz/html/soccer-random.html',r:'4.6',p:'4M+'},
  {n:'BOXING RANDOM',e:'ğŸ¥Š',cat:'sports',u:'https://glacierarcade.xyz/html/boxing-random.html',r:'4.7',p:'4M+'},
  {n:'VOLLEY RANDOM',e:'ğŸ',cat:'sports',u:'https://glacierarcade.xyz/html/volley-random.html',r:'4.5',p:'3M+'},
  // IO
  {n:'SLITHER.IO',e:'ğŸ',cat:'io',u:'https://glacierarcade.xyz/html/slither-io.html',r:'4.9',p:'50M+'},
  {n:'PAPER.IO 2',e:'ğŸ“„',cat:'io',u:'https://glacierarcade.xyz/html/paperio2.html',r:'4.7',p:'20M+'},
  {n:'HOLE.IO',e:'ğŸ•³ï¸',cat:'io',u:'https://glacierarcade.xyz/html/hole-io.html',r:'4.6',p:'10M+'},
  // CLASSIC
  {n:'PACMAN',e:'ğŸ‘¾',cat:'classic',u:'https://glacierarcade.xyz/html/pacman.html',r:'4.9',p:'1B+'},
  {n:'SNAKE CLASSIC',e:'ğŸŸ¢',cat:'classic',u:'https://glacierarcade.xyz/html/snake.html',r:'4.7',p:'500M+'},
  {n:'FLAPPY CLASSIC',e:'ğŸ¦',cat:'classic',u:'https://glacierarcade.xyz/html/flappy-bird.html',r:'4.5',p:'100M+'},
  {n:'CHROME DINO',e:'ğŸ¦•',cat:'classic',u:'https://glacierarcade.xyz/html/chrome-dino.html',r:'4.8',p:'200M+'},
  {n:'TETRIS CLASSIC',e:'ğŸŸª',cat:'classic',u:'https://glacierarcade.xyz/html/tetris.html',r:'4.9',p:'1B+'},
  {n:'FRIDAY NIGHT FUNKIN',e:'ğŸ¤',cat:'classic',u:'https://glacierarcade.xyz/html/fnf.html',r:'4.8',p:'20M+'},
];

let curCat = 'all';
let blobUrls = {};

function renderGames(list) {
  list = list || GAMES;
  const filtered = curCat === 'all' ? list : list.filter(g => g.cat === curCat);
  const grid = document.getElementById('gGrid');
  grid.innerHTML = filtered.map((g, i) => `
    <div class="gcard" onclick="openGame(${i + (list === GAMES ? 0 : 0)},${JSON.stringify(g).replace(/</g,'\\u003c').replace(/>/g,'\\u003e').replace(/'/g,'\\u0027')})">
      <div class="gthumb">${g.e || 'ğŸ®'}</div>
      <div class="ginfo">
        <div class="gname">${g.n}</div>
        <div class="gmeta"><span class="grating">â˜…${g.r||'4.5'}</span><span>${g.p||''}</span></div>
      </div>
    </div>`).join('');
}

function setCat(btn, cat) {
  curCat = cat;
  document.querySelectorAll('.catbtn').forEach(b => b.classList.remove('on'));
  btn.classList.add('on');
  renderGames();
}

function filterGames(q) {
  q = q.toLowerCase();
  renderGames(GAMES.filter(g => !q || g.n.toLowerCase().includes(q) || g.cat.includes(q)));
}

function openGame(idx, gameObj) {
  // gameObj passed directly as parsed object from onclick
  const g = gameObj;
  document.getElementById('gGridWrap').style.display = 'none';
  document.getElementById('gSearch').style.display = 'none';
  document.getElementById('gBackBar').style.display = 'flex';
  document.getElementById('gCurName').textContent = (g.e || '') + ' ' + g.n;
  const frame = document.getElementById('gFrame');
  frame.style.display = 'block';
  frame.innerHTML = '';

  // Flash effect
  const fl = document.getElementById('flash');
  fl.style.opacity = '.3';
  setTimeout(() => fl.style.opacity = '0', 250);

  if (g.key && OFFLINE_GAMES[g.key]) {
    // Blob URL for offline games
    if (!blobUrls[g.key]) blobUrls[g.key] = makeBlob(OFFLINE_GAMES[g.key]);
    frame.innerHTML = '<iframe src="' + blobUrls[g.key] + '" style="width:100%;height:100%;border:none;" allowfullscreen></iframe>';
  } else if (g.u) {
    frame.innerHTML = '<iframe src="' + g.u + '" style="width:100%;height:100%;border:none;" allowfullscreen allow="fullscreen *; autoplay *"></iframe>';
  }
}

function closeGame() {
  document.getElementById('gGridWrap').style.display = 'block';
  document.getElementById('gSearch').style.display = 'block';
  document.getElementById('gBackBar').style.display = 'none';
  const frame = document.getElementById('gFrame');
  frame.style.display = 'none';
  frame.innerHTML = '';
}

function goFull() {
  const iframe = document.querySelector('#gFrame iframe');
  if (iframe) {
    if (iframe.requestFullscreen) iframe.requestFullscreen();
    else if (iframe.webkitRequestFullscreen) iframe.webkitRequestFullscreen();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APPS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let UB1 = localStorage.getItem('nx_ub1') || 'https://learn.szczech.com.ar/';
let UB2 = localStorage.getItem('nx_ub2') || 'https://outerspace.is-a.software/&';
let curAppUrl = '';

const APPS = [
  {ico:'ğŸ”“',name:'RESOURCE HUB 1',desc:'Primary unblocker portal',tag:'unblock',getUrl:()=>UB1},
  {ico:'ğŸš€',name:'RESOURCE HUB 2',desc:'Secondary unblocker portal',tag:'unblock',getUrl:()=>UB2},
  {ico:'ğŸ“º',name:'YOUTUBE',desc:'Watch videos & shorts',tag:'free',url:'https://www.youtube.com'},
  {ico:'ğŸ’¬',name:'DISCORD',desc:'Chat with friends',tag:'blocked',url:'https://discord.com/app'},
  {ico:'ğŸ®',name:'ROBLOX',desc:'Play Roblox online',tag:'blocked',url:'https://www.roblox.com'},
  {ico:'ğŸµ',name:'SPOTIFY',desc:'Stream music',tag:'blocked',url:'https://open.spotify.com'},
  {ico:'ğŸ“–',name:'WIKIPEDIA',desc:'All human knowledge',tag:'free',url:'https://en.wikipedia.org'},
  {ico:'ğŸ“',name:'KHAN ACADEMY',desc:'Free lessons & practice',tag:'free',url:'https://www.khanacademy.org'},
  {ico:'ğŸ“Š',name:'DESMOS',desc:'Graphing calculator',tag:'free',url:'https://www.desmos.com/calculator'},
  {ico:'ğŸŒ',name:'GOOGLE TRANSLATE',desc:'Translate any language',tag:'free',url:'https://translate.google.com'},
  {ico:'ğŸ“',name:'GOOGLE SCHOLAR',desc:'Research & papers',tag:'free',url:'https://scholar.google.com'},
  {ico:'ğŸƒ',name:'QUIZLET',desc:'Flashcards & study tools',tag:'free',url:'https://quizlet.com'},
  {ico:'ğŸ§ ',name:'BRAINPOP',desc:'Educational videos & quizzes',tag:'free',url:'https://www.brainpop.com'},
  {ico:'ğŸ²',name:'COOLMATHGAMES',desc:'Math & puzzle games',tag:'free',url:'https://www.coolmathgames.com'},
  {ico:'ğŸ•¹',name:'POKI',desc:'100s of free browser games',tag:'free',url:'https://poki.com'},
  {ico:'ğŸ¤–',name:'CHATGPT',desc:'OpenAI chatbot',tag:'blocked',url:'https://chat.openai.com'},
  {ico:'ğŸ“',name:'GOOGLE DOCS',desc:'Write & collaborate',tag:'free',url:'https://docs.google.com'},
  {ico:'ğŸ“Š',name:'GOOGLE SHEETS',desc:'Spreadsheets online',tag:'free',url:'https://sheets.google.com'},
  {ico:'ğŸ“š',name:'GOOGLE CLASSROOM',desc:'School portal',tag:'free',url:'https://classroom.google.com'},
];

function buildApps() {
  const grid = document.getElementById('appsGrid');
  grid.innerHTML = APPS.map(a => {
    const url = a.getUrl ? a.getUrl() : a.url;
    const esc = url.replace(/'/g, "\\'");
    const nameEsc = (a.ico + ' ' + a.name).replace(/'/g, "\\'");
    return `<div class="acard${a.tag==='unblock'?' feat':''}" onclick="openApp('${esc}','${nameEsc}')">
      <div class="aico">${a.ico}</div>
      <div class="aname">${a.name}</div>
      <div class="adesc">${a.desc}</div>
      <span class="atag ${a.tag==='unblock'?'unblock':a.tag==='blocked'?'blocked':'free'}">${a.tag==='unblock'?'ğŸ”— PORTAL':a.tag==='blocked'?'ğŸ”“ VIA PROXY':'âœ… FREE'}</span>
    </div>`;
  }).join('');
}

function openApp(url, name) {
  curAppUrl = url;
  document.getElementById('appsView').style.display = 'none';
  const viewer = document.getElementById('appViewer');
  viewer.style.display = 'flex';
  document.getElementById('avName').textContent = name;
  document.getElementById('appBlockMsg').style.display = 'none';
  const frame = document.getElementById('appFrame');
  frame.src = url;
  frame.onerror = () => { document.getElementById('appBlockMsg').style.display = 'flex'; frame.style.display = 'none'; };
  frame.onload = () => {
    try {
      const test = frame.contentWindow.location.href;
    } catch(e) {
      // Cross-origin, assume it loaded
    }
  };
}

function closeApp() {
  document.getElementById('appsView').style.display = 'block';
  document.getElementById('appViewer').style.display = 'none';
  document.getElementById('appFrame').src = 'about:blank';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MUSIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let audio = new Audio();
let queue = [], qIdx = -1, repeat = false, progTimer = null;

audio.addEventListener('timeupdate', () => {
  const dur = audio.duration || 0;
  const cur = audio.currentTime;
  if (dur) {
    document.getElementById('progFill').style.width = (cur/dur*100) + '%';
    document.getElementById('timeCur').textContent = fmt(cur);
    document.getElementById('timeTot').textContent = fmt(dur);
  }
});
audio.addEventListener('ended', () => { if (repeat) audio.play(); else nextTrack(); });
audio.addEventListener('play', () => {
  document.getElementById('playBtn').textContent = 'â¸';
  document.getElementById('waveEl').classList.remove('paused');
});
audio.addEventListener('pause', () => {
  document.getElementById('playBtn').textContent = 'â–¶';
  document.getElementById('waveEl').classList.add('paused');
});

function fmt(s) { s = Math.floor(s) || 0; return Math.floor(s/60) + ':' + String(s%60).padStart(2,'0'); }

async function searchMusic() {
  const q = document.getElementById('mSearch').value.trim();
  if (!q) return;
  const res = document.getElementById('mResults');
  res.innerHTML = '<div style="padding:14px;font-size:.6rem;color:#446688;letter-spacing:1.5px;text-align:center;"><div class="spinner"></div> Searching...</div>';
  try {
    const r = await fetch('https://itunes.apple.com/search?term=' + encodeURIComponent(q) + '&media=music&limit=20&entity=song');
    const data = await r.json();
    queue = data.results || [];
    res.innerHTML = queue.length ? queue.map((t,i) => `
      <div class="mres" id="mr-${i}" onclick="playTrack(${i})">
        <span class="mres-num">${i+1}</span>
        <div class="mres-info">
          <div class="mres-title">${t.trackName||'Unknown'}</div>
          <div class="mres-artist">${t.artistName||''}</div>
        </div>
        <span class="mres-dur">${fmt((t.trackTimeMillis||0)/1000)}</span>
      </div>`).join('') : '<div style="padding:14px;font-size:.6rem;color:#446688;text-align:center;">No results</div>';
  } catch(e) {
    res.innerHTML = '<div style="padding:14px;font-size:.6rem;color:#ff00aa;text-align:center;">Search failed</div>';
  }
}

async function playTrack(i) {
  if (i < 0 || i >= queue.length) return;
  qIdx = i;
  const t = queue[i];
  document.querySelectorAll('.mres').forEach(el => el.classList.remove('playing'));
  const el = document.getElementById('mr-' + i);
  if (el) { el.classList.add('playing'); el.scrollIntoView({block:'nearest'}); }
  document.getElementById('nowTitle').textContent = t.trackName || 'Unknown';
  document.getElementById('nowArtist').textContent = t.artistName || '';
  document.getElementById('nowArtwork').textContent = t.artworkUrl100 ? '' : 'ğŸµ';
  // Try artwork
  if (t.artworkUrl100) {
    const img = new Image();
    img.onload = () => { document.getElementById('nowArtwork').textContent = ''; document.getElementById('nowArtwork').style.backgroundImage = 'url(' + t.artworkUrl100 + ')'; };
    img.onerror = () => { document.getElementById('nowArtwork').textContent = 'ğŸµ'; };
    img.src = t.artworkUrl100;
  }
  document.getElementById('lyricsPanel').innerHTML = '<div class="lyric-line">â™¬ ' + (t.trackName||'') + '</div><div class="lyric-line" style="margin-top:8px;color:#1a2a3a;">by ' + (t.artistName||'') + '</div><div class="lyric-line" style="margin-top:8px;">Album: ' + (t.collectionName||'') + '</div><div class="lyric-line" style="margin-top:16px;font-size:.58rem;color:#1a2a3a;">30s preview via iTunes</div>';
  audio.src = t.previewUrl || '';
  if (t.previewUrl) audio.play().catch(()=>{});
}

function togglePlay() { if (audio.paused) audio.play().catch(()=>{}); else audio.pause(); }
function nextTrack() { if (queue.length) playTrack((qIdx+1) % queue.length); }
function prevTrack() { if (queue.length) playTrack((qIdx-1+queue.length) % queue.length); }
function shuffleTrack() { if (queue.length) playTrack(Math.floor(Math.random()*queue.length)); }
function toggleRepeat() { repeat = !repeat; document.getElementById('repeatBtn').style.color = repeat ? 'var(--b)' : ''; }
function setVol(v) { audio.volume = v / 100; }
function seekAudio(e) {
  const bar = document.getElementById('progBar');
  const pct = e.offsetX / bar.offsetWidth;
  if (audio.duration) audio.currentTime = pct * audio.duration;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setAI(btn, pane) {
  document.querySelectorAll('.aitool').forEach(b => b.classList.remove('on'));
  document.querySelectorAll('.aipane').forEach(p => p.classList.remove('on'));
  btn.classList.add('on');
  const el = document.getElementById('aipane-' + pane);
  if (el) el.classList.add('on');
}

function aiMsg(role, text) {
  const c = document.getElementById('chatMsgs');
  const d = document.createElement('div');
  d.className = 'msg ' + role;
  d.innerHTML = '<div class="mav">' + (role==='ai'?'ğŸ¤–':'ğŸ‘¤') + '</div><div class="mbub">' + text.replace(/</g,'&lt;') + '</div>';
  c.appendChild(d);
  c.scrollTop = c.scrollHeight;
  return d;
}

async function sendChat() {
  const inp = document.getElementById('chatInput');
  const text = inp.value.trim();
  if (!text) return;
  inp.value = '';
  aiMsg('user', text);
  const wait = aiMsg('ai', '<div class="spinner"></div>');
  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'anthropic-dangerous-direct-browser-access': 'true' },
      body: JSON.stringify({ model: 'claude-opus-4-5', max_tokens: 1024, system: 'You are StudyBot, a helpful AI tutor for students. Be concise, friendly, and educational. Use emojis occasionally.', messages: [{ role: 'user', content: text }] })
    });
    const data = await res.json();
    wait.querySelector('.mbub').textContent = data.content?.[0]?.text || 'Sorry, something went wrong.';
  } catch(e) {
    wait.querySelector('.mbub').textContent = 'âš ï¸ Could not connect to AI. Check your internet.';
  }
}

async function doTranslate() {
  const inp = document.getElementById('transIn').value.trim();
  const to = document.getElementById('toLang').value;
  const from = document.getElementById('fromLang').value;
  if (!inp) return;
  document.getElementById('transOut').value = 'â³ Translating...';
  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'anthropic-dangerous-direct-browser-access': 'true' },
      body: JSON.stringify({ model: 'claude-opus-4-5', max_tokens: 1024, messages: [{ role: 'user', content: 'Translate the following text' + (from!=='auto'?' from '+from:'') + ' to ' + to + '. Return ONLY the translation, nothing else:\n\n' + inp }] })
    });
    const data = await res.json();
    document.getElementById('transOut').value = data.content?.[0]?.text || 'Translation failed.';
  } catch(e) { document.getElementById('transOut').value = 'Error connecting to AI.'; }
}

async function doSummarize() {
  const inp = document.getElementById('sumIn').value.trim();
  if (!inp) return;
  document.getElementById('sumOut').textContent = 'â³ Summarizing...';
  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'anthropic-dangerous-direct-browser-access': 'true' },
      body: JSON.stringify({ model: 'claude-opus-4-5', max_tokens: 512, messages: [{ role: 'user', content: 'Summarize this text in 3-5 concise bullet points:\n\n' + inp }] })
    });
    const data = await res.json();
    document.getElementById('sumOut').textContent = data.content?.[0]?.text || 'Failed.';
  } catch(e) { document.getElementById('sumOut').textContent = 'Error connecting to AI.'; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let panicMode = 'blank';
let coverStyle = 'google';
const PANIC_URLS = {
  blank: 'about:blank',
  classroom: 'https://classroom.google.com',
  docs: 'https://docs.google.com',
  search: 'https://google.com',
};

function loadSettings() {
  // Load saved settings
  const savedUB1 = localStorage.getItem('nx_ub1');
  if (savedUB1) { UB1 = savedUB1; document.getElementById('ub1Url').value = savedUB1; }
  const savedUB2 = localStorage.getItem('nx_ub2');
  if (savedUB2) { UB2 = savedUB2; document.getElementById('ub2Url').value = savedUB2; }
  const savedPanic = localStorage.getItem('nx_panic') || 'blank';
  setPanic(savedPanic);
  const savedCover = localStorage.getItem('nx_cover') || 'google';
  // Cover just saves preference; cover screen is shown before unlock
  coverStyle = savedCover;
  document.querySelectorAll('.copt').forEach(b => b.classList.remove('on'));
  const cb = document.getElementById('copt-' + savedCover);
  if (cb) cb.classList.add('on');
  try {
    const savedTheme = localStorage.getItem('nx_theme');
    if (savedTheme) { const [g,b] = JSON.parse(savedTheme); applyTheme(g,b); }
  } catch(e) { localStorage.removeItem('nx_theme'); }
  const savedCity = localStorage.getItem('nx_weather_city');
  if (savedCity) { document.getElementById('wxCity').value = savedCity; fetchWeather(); }
  const savedName = localStorage.getItem('nx_chat_name');
  if (savedName) document.getElementById('nameIn').value = savedName;
}

function saveUB(num) {
  const url = document.getElementById('ub' + num + 'Url').value.trim();
  const pass = document.getElementById('ub' + num + 'Pass').value;
  const ok = document.getElementById('ub' + num + 'ok');
  const err = document.getElementById('ub' + num + 'err');
  ok.style.display = 'none'; err.style.display = 'none';
  if (!url) return;
  if (pass !== PW) { err.style.display = 'block'; document.getElementById('ub' + num + 'Pass').value = ''; return; }
  if (num === 1) { UB1 = url; localStorage.setItem('nx_ub1', url); }
  else { UB2 = url; localStorage.setItem('nx_ub2', url); }
  ok.style.display = 'block';
  document.getElementById('ub' + num + 'Pass').value = '';
  buildApps(); // Rebuild app grid with new URLs
  toast('âœ… SAVED', 'Unblocker ' + num + ' updated!');
}

function savePass() {
  const old = document.getElementById('passOld').value;
  const neu = document.getElementById('passNew').value.trim();
  const ok = document.getElementById('passOk');
  const err = document.getElementById('passErr');
  ok.style.display = 'none'; err.style.display = 'none';
  if (old !== PW) { err.style.display = 'block'; return; }
  if (!neu) { err.style.display = 'block'; return; }
  PW = neu;
  localStorage.setItem('nx_pw', PW);
  ok.style.display = 'block';
  document.getElementById('passOld').value = '';
  document.getElementById('passNew').value = '';
  toast('ğŸ”’ SAVED', 'Password changed!');
}

function setTheme(g, b) {
  localStorage.setItem('nx_theme', JSON.stringify([g, b]));
  applyTheme(g, b);
  document.getElementById('themeOk').style.display = 'block';
  setTimeout(() => document.getElementById('themeOk').style.display = 'none', 2000);
  // Update theme dots
  document.querySelectorAll('.tdot').forEach(d => d.classList.remove('sel'));
  event.currentTarget.classList.add('sel');
}

function applyTheme(g, b) {
  document.documentElement.style.setProperty('--g', g);
  document.documentElement.style.setProperty('--b', b);
}

function setCover(type) {
  coverStyle = type;
  localStorage.setItem('nx_cover', type);
  document.querySelectorAll('.copt').forEach(b => b.classList.remove('on'));
  const el = document.getElementById('copt-' + type);
  if (el) el.classList.add('on');
  toast('ğŸ­ COVER', 'Cover style set to ' + type);
}

function setPanic(mode) {
  panicMode = mode;
  localStorage.setItem('nx_panic', mode);
  document.querySelectorAll('.popt').forEach(b => b.classList.remove('on'));
  const el = document.getElementById('popt-' + mode);
  if (el) el.classList.add('on');
}

function triggerPanic() {
  const overlay = document.getElementById('panic');
  const frame = document.getElementById('panicFrame');
  overlay.style.display = 'block';
  if (panicMode === 'blank') {
    frame.src = 'about:blank';
    overlay.style.background = '#fff';
  } else {
    frame.src = PANIC_URLS[panicMode] || 'about:blank';
    overlay.style.background = 'transparent';
  }
  const dismiss = (e) => {
    if (e.key === 'Escape' || e.type === 'click') {
      overlay.style.display = 'none';
      frame.src = 'about:blank';
      document.removeEventListener('keydown', dismiss);
      overlay.removeEventListener('click', dismiss);
    }
  };
  setTimeout(() => {
    document.addEventListener('keydown', dismiss);
    overlay.addEventListener('click', dismiss);
  }, 300);
}

async function fetchWeather() {
  const city = document.getElementById('wxCity').value.trim();
  if (!city) return;
  localStorage.setItem('nx_weather_city', city);
  const res = document.getElementById('wxResult');
  res.textContent = 'â³ Loading...';
  try {
    const geo = await fetch('https://geocoding-api.open-meteo.com/v1/search?name=' + encodeURIComponent(city) + '&count=1&language=en&format=json');
    const gd = await geo.json();
    if (!gd.results?.length) { res.textContent = 'âŒ City not found'; return; }
    const {latitude, longitude, name, country} = gd.results[0];
    const wx = await fetch('https://api.open-meteo.com/v1/forecast?latitude=' + latitude + '&longitude=' + longitude + '&current=temperature_2m,weathercode,windspeed_10m&temperature_unit=fahrenheit&windspeed_unit=mph');
    const wd = await wx.json();
    const temp = Math.round(wd.current.temperature_2m);
    const wind = Math.round(wd.current.windspeed_10m);
    const code = wd.current.weathercode;
    const icon = code<=1?'â˜€ï¸':code<=3?'â›…':code<=48?'ğŸŒ«ï¸':code<=67?'ğŸŒ§ï¸':code<=77?'â„ï¸':code<=82?'ğŸŒ¦ï¸':'â›ˆï¸';
    const desc = code===0?'Clear':code<=1?'Mostly Clear':code<=3?'Partly Cloudy':code<=48?'Foggy':code<=55?'Drizzle':code<=67?'Rain':code<=77?'Snow':code<=82?'Showers':'Thunderstorm';
    const display = icon + ' ' + name + ', ' + country + ' Â· ' + temp + 'Â°F Â· ' + desc + ' Â· Wind ' + wind + 'mph';
    res.textContent = display;
    const badge = document.getElementById('wxBadge');
    badge.textContent = display;
    badge.style.display = 'block';
  } catch(e) { res.textContent = 'âŒ Failed to load weather'; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHAT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CHAT_BASE = 'https://nexus-chat-default-rtdb.firebaseio.com';
let chatRoom = null, chatName = 'Anon', pollTimer = null, lastCount = 0;

async function joinRoom() {
  const code = document.getElementById('roomIn').value.trim().toLowerCase().replace(/[^a-z0-9]/g,'');
  const name = document.getElementById('nameIn').value.trim() || 'Anon';
  if (!code) return;
  chatRoom = code; chatName = name;
  localStorage.setItem('nx_chat_name', name);
  document.getElementById('chatRoomName').textContent = 'ğŸ”’ Room: ' + code + ' â€” Logged in as ' + name;
  document.getElementById('chatLog').innerHTML = '';
  clearInterval(pollTimer);
  lastCount = 0;
  loadMsgs();
  pollTimer = setInterval(loadMsgs, 2200);
  toast('ğŸ’¬ JOINED', 'Room: ' + code);
}

async function loadMsgs() {
  if (!chatRoom) return;
  try {
    const r = await fetch(CHAT_BASE + '/rooms/' + chatRoom + '/messages.json?orderBy="time"&limitToLast=50');
    const data = await r.json();
    if (!data) return;
    const msgs = Object.values(data).sort((a,b)=>a.time-b.time);
    if (msgs.length === lastCount) return;
    lastCount = msgs.length;
    const log = document.getElementById('chatLog');
    const wasBottom = log.scrollTop + log.clientHeight >= log.scrollHeight - 20;
    log.innerHTML = msgs.map(m => `<div style="display:flex;flex-direction:column;gap:2px;${m.name===chatName?'align-items:flex-end':''}">
      <span style="font-size:.52rem;color:#446688;letter-spacing:.8px;">${escHtml(m.name)} Â· ${new Date(m.time).toLocaleTimeString()}</span>
      <div style="max-width:72%;background:${m.name===chatName?'rgba(0,255,136,.07)':'rgba(255,0,170,.06)'};border:1px solid ${m.name===chatName?'rgba(0,255,136,.15)':'rgba(255,0,170,.12)'};border-radius:5px;padding:7px 11px;font-size:.68rem;color:#c0d8ff;line-height:1.7;">${escHtml(m.text)}</div>
    </div>`).join('');
    if (wasBottom) log.scrollTop = log.scrollHeight;
    if (msgs.length > 150) cleanOld();
  } catch(e) {}
}

async function sendMsg() {
  const inp = document.getElementById('chatMsgIn');
  const text = inp.value.trim();
  if (!text || !chatRoom) return;
  inp.value = '';
  try {
    await fetch(CHAT_BASE + '/rooms/' + chatRoom + '/messages.json', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name: chatName, text, time: Date.now() })
    });
  } catch(e) {}
}

async function cleanOld() {
  try {
    const r = await fetch(CHAT_BASE + '/rooms/' + chatRoom + '/messages.json?orderBy="time"&limitToLast=200');
    const data = await r.json();
    if (!data) return;
    const keys = Object.keys(data);
    if (keys.length > 150) {
      for (const k of keys.slice(0, 30)) {
        await fetch(CHAT_BASE + '/rooms/' + chatRoom + '/messages/' + k + '.json', { method: 'DELETE' });
      }
    }
  } catch(e) {}
}

function escHtml(s) { return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PANIC MODE â€” ESC KEY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && document.getElementById('app').style.display !== 'none' && document.getElementById('panic').style.display === 'none') {
    triggerPanic();
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT (on page load, before unlock)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  // Load saved panic + cover prefs for display
  const sp = localStorage.getItem('nx_panic');
  if (sp) panicMode = sp;
})();
</script>
</body>
</html>
