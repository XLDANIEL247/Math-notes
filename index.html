<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loading...</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COVER SCREEN â€” looks like a stuck loading page
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#cover {
  position: fixed;
  inset: 0;
  background: #f1f3f4;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 18px;
  z-index: 99999;
  font-family: 'Google Sans', Arial, sans-serif;
}

.cover-spinner {
  width: 48px;
  height: 48px;
  border: 4px solid #e0e0e0;
  border-top-color: #4285f4;
  border-radius: 50%;
  animation: cspin 0.9s linear infinite;
}
@keyframes cspin { to { transform: rotate(360deg); } }

.cover-text {
  font-size: 14px;
  color: #5f6368;
  letter-spacing: 0.2px;
}

/* Hidden password field â€” type password on cover, nothing shows */
#coverPass {
  position: absolute;
  opacity: 0;
  pointer-events: none;
  width: 1px;
  height: 1px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN APP â€” hidden until unlocked
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#app {
  display: none;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;
}

:root {
  --g: #00ff88;
  --b: #00cfff;
  --p: #ff00aa;
  --y: #ffcc00;
  --dark: #060910;
  --card: #0c1220;
  --card2: #0f1628;
  --border: rgba(0,255,136,0.15);
  --text: #a0b8cc;
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  background: var(--dark);
  font-family: 'Share Tech Mono', monospace;
  color: var(--text);
}

body::after {
  content:'';
  position:fixed;
  inset:0;
  background: repeating-linear-gradient(transparent,transparent 2px,rgba(0,0,0,0.1) 2px,rgba(0,0,0,0.1) 4px);
  pointer-events:none;
  z-index:9998;
  opacity:.3;
}
body::before {
  content:'';
  position:fixed;
  inset:0;
  background-image: linear-gradient(rgba(0,255,136,.02) 1px,transparent 1px),linear-gradient(90deg,rgba(0,255,136,.02) 1px,transparent 1px);
  background-size:44px 44px;
  pointer-events:none;
  z-index:0;
}

/* â”€â”€ NEON LOADING BAR â”€â”€ */
#neonLoader {
  position:fixed;
  top:0;left:0;
  height:3px;
  width:0%;
  background:linear-gradient(90deg,var(--g),var(--b),var(--p));
  box-shadow:0 0 12px var(--g),0 0 24px var(--b);
  z-index:99997;
  transition:width .3s ease,opacity .4s ease;
  pointer-events:none;
}
#neonLoader.done { width:100%!important; opacity:0; }

/* â”€â”€ NOTIFICATION TOAST â”€â”€ */
#toastContainer {
  position:fixed;
  bottom:24px;right:24px;
  display:flex;flex-direction:column;gap:10px;
  z-index:99996;
  pointer-events:none;
}
.toast {
  background:rgba(6,9,16,.95);
  border:1px solid var(--g);
  border-radius:6px;
  padding:12px 18px;
  font-family:'Share Tech Mono',monospace;
  font-size:.7rem;
  color:#c0d8ff;
  letter-spacing:1px;
  box-shadow:0 0 20px rgba(0,255,136,.2);
  animation:toastIn .3s ease,toastOut .3s ease 3.7s both;
  pointer-events:auto;
  max-width:280px;
  line-height:1.6;
}
@keyframes toastIn{from{opacity:0;transform:translateX(40px)}to{opacity:1;transform:translateX(0)}}
@keyframes toastOut{from{opacity:1;transform:translateX(0)}to{opacity:0;transform:translateX(40px)}}
.toast .toast-title{color:var(--g);font-family:'Orbitron',sans-serif;font-size:.6rem;letter-spacing:2px;margin-bottom:4px;}

/* â”€â”€ SPLASH SCREEN â”€â”€ */
#splashScreen {
  position:fixed;inset:0;
  background:var(--dark);
  z-index:99995;
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  gap:24px;
  opacity:1;
  transition:opacity .5s ease;
}
.splash-logo {
  font-family:'Orbitron',sans-serif;
  font-weight:900;
  font-size:clamp(2.5rem,8vw,5rem);
  letter-spacing:12px;
  color:var(--g);
  text-shadow:0 0 40px var(--g),0 0 80px rgba(0,255,136,.4);
  animation:splashPulse 1s ease-in-out infinite alternate;
}
@keyframes splashPulse{from{text-shadow:0 0 30px var(--g),0 0 60px rgba(0,255,136,.3)}to{text-shadow:0 0 60px var(--g),0 0 120px rgba(0,255,136,.6),0 0 200px rgba(0,255,136,.2)}}
.splash-logo span{color:var(--b);text-shadow:0 0 40px var(--b);}
.splash-sub{font-family:'Share Tech Mono',monospace;font-size:.8rem;color:#446688;letter-spacing:6px;text-transform:uppercase;}
.splash-bar-wrap{width:260px;height:3px;background:rgba(0,255,136,.1);border-radius:2px;overflow:hidden;}
.splash-bar{height:100%;width:0%;background:linear-gradient(90deg,var(--g),var(--b));border-radius:2px;box-shadow:0 0 10px var(--g);transition:width .05s linear;}
.splash-ver{font-family:'Share Tech Mono',monospace;font-size:.6rem;color:#223322;letter-spacing:3px;}

/* â”€â”€ MATRIX CANVAS â”€â”€ */
#matrixCanvas{position:fixed;inset:0;z-index:0;pointer-events:none;opacity:.18;}

/* â”€â”€ TOPBAR â”€â”€ */
#topbar {
  position:relative;
  z-index:100;
  display:flex;
  align-items:center;
  height:52px;
  background:rgba(6,9,16,.97);
  border-bottom:1px solid rgba(0,255,136,.12);
  flex-shrink:0;
}

.logo {
  font-family:'Orbitron',sans-serif;
  font-weight:900;
  font-size:1.1rem;
  letter-spacing:4px;
  color:var(--g);
  text-shadow:0 0 20px var(--g);
  padding:0 24px;
  white-space:nowrap;
  animation:flicker 6s infinite;
}
.logo span{color:var(--b);}
@keyframes flicker{0%,94%,100%{opacity:1}95%{opacity:.6}97%{opacity:.9}98%{opacity:.5}99%{opacity:1}}

#navtabs { display:flex; height:100%; flex:1; }

.navtab {
  display:flex; align-items:center; gap:7px;
  padding:0 20px;
  font-size:.72rem; letter-spacing:2px; text-transform:uppercase;
  color:#556677; cursor:pointer; border:none; background:none;
  font-family:'Share Tech Mono',monospace; height:100%;
  border-bottom:2px solid transparent; transition:all .2s; white-space:nowrap;
}
.navtab:hover { color:var(--g); background:rgba(0,255,136,.04); }
.navtab.active { color:var(--g); border-bottom-color:var(--g); background:rgba(0,255,136,.06); }

.badge-online {
  font-size:.6rem; letter-spacing:1px; color:var(--g);
  background:rgba(0,255,136,.1); border:1px solid rgba(0,255,136,.3);
  border-radius:2px; padding:4px 10px; white-space:nowrap; margin-right:16px;
}

/* â”€â”€ MAIN â”€â”€ */
#main { display:flex; flex:1; overflow:hidden; position:relative; z-index:1; }

.page { display:none; flex:1; overflow:hidden; flex-direction:column; }
.page.active { display:flex; }

/* â”€â”€ GAMES â”€â”€ */
#page-games { flex-direction:row; }
#gamesSidebar {
  width:155px; background:rgba(12,18,32,.8); border-right:1px solid var(--border);
  display:flex; flex-direction:column; gap:4px; padding:14px 8px; overflow-y:auto; flex-shrink:0;
}
.cat-pill {
  background:none; border:none; color:#446688; font-family:'Share Tech Mono',monospace;
  font-size:.63rem; letter-spacing:2px; text-transform:uppercase; padding:8px 10px;
  border-radius:3px; cursor:pointer; text-align:left; transition:all .2s;
}
.cat-pill:hover { color:var(--g); background:rgba(0,255,136,.06); }
.cat-pill.active { color:var(--g); background:rgba(0,255,136,.1); border-left:2px solid var(--g); }

#gamesMain { flex:1; overflow:hidden; display:flex; flex-direction:column; }

.games-back {
  display:none; align-items:center; gap:12px; padding:10px 16px;
  background:rgba(0,0,0,.5); border-bottom:1px solid var(--border);
}
.games-back button {
  background:none; border:1px solid rgba(255,0,170,.3); color:var(--p);
  padding:5px 14px; font-family:'Share Tech Mono',monospace; font-size:.65rem;
  letter-spacing:2px; border-radius:2px; cursor:pointer;
}
.games-back span { font-size:.75rem; color:#aaa; }

#searchBar {
  padding:12px 16px; border-bottom:1px solid var(--border); display:flex; gap:10px;
}
#gameSearch {
  flex:1; background:rgba(0,255,136,.04); border:1px solid var(--border);
  border-radius:3px; color:var(--g); font-family:'Share Tech Mono',monospace;
  font-size:.73rem; padding:8px 12px; outline:none; letter-spacing:1px;
}
#gameSearch::placeholder { color:#334455; }
#gameSearch:focus { border-color:var(--g); box-shadow:0 0 12px rgba(0,255,136,.12); }

#gamesContent { flex:1; overflow-y:auto; padding:18px; }
#gamesFrame { flex:1; border:none; width:100%; background:#000; display:none; }

.games-grid {
  display:grid; grid-template-columns:repeat(auto-fill,minmax(155px,1fr)); gap:13px;
}
.game-card {
  background:var(--card); border:1px solid rgba(0,255,136,.08); border-radius:6px;
  overflow:hidden; cursor:pointer; transition:transform .2s, border-color .2s, box-shadow .2s;
  position:relative;
}
.game-card:hover { transform:translateY(-4px) scale(1.02); border-color:var(--g); box-shadow:0 8px 30px rgba(0,255,136,.2),0 0 0 1px rgba(0,255,136,.1); }
.game-card::before {
  content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,rgba(0,255,136,.06),transparent,rgba(0,207,255,.06));
  opacity:0;transition:opacity .3s;pointer-events:none;z-index:1;
}
.game-card:hover::before{opacity:1;}
.game-thumb {
  width:100%; aspect-ratio:16/9; display:flex; align-items:center; justify-content:center;
  font-size:2rem; position:relative; overflow:hidden; background:linear-gradient(135deg,#0a1020,#060b18);
}
@keyframes screenShake{0%,100%{transform:translate(0)}10%{transform:translate(-4px,-2px)}20%{transform:translate(4px,2px)}30%{transform:translate(-3px,3px)}40%{transform:translate(3px,-3px)}50%{transform:translate(-2px,2px)}60%{transform:translate(2px,-1px)}70%{transform:translate(-1px,2px)}80%{transform:translate(1px,-2px)}90%{transform:translate(-1px,1px)}}
@keyframes flashIn{0%{opacity:0}50%{opacity:.6}100%{opacity:0}}
.shake{animation:screenShake .4s ease both;}
#flashOverlay{position:fixed;inset:0;background:#00ff88;pointer-events:none;z-index:9999;opacity:0;}
.game-thumb::after {
  content:'â–¶ PLAY'; position:absolute; inset:0; background:rgba(0,255,136,.88);
  display:flex; align-items:center; justify-content:center; font-family:'Orbitron',sans-serif;
  font-size:.72rem; font-weight:900; color:#050810; letter-spacing:3px; opacity:0; transition:opacity .2s;
}
.game-card:hover .game-thumb::after { opacity:1; }
.game-info { padding:9px 11px; }
.game-name { font-family:'Orbitron',sans-serif; font-size:.6rem; font-weight:700; color:#c0d8ff; letter-spacing:1px; margin-bottom:3px; }
.game-meta { display:flex; justify-content:space-between; font-size:.57rem; color:#446688; }
.game-rating { color:#ffcc44; }

/* â”€â”€ NEON PULSE borders â”€â”€ */
@keyframes neonPulse {
  0%,100%{box-shadow:0 0 6px var(--g),0 0 12px rgba(0,255,136,.3),inset 0 0 6px rgba(0,255,136,.05)}
  50%{box-shadow:0 0 14px var(--g),0 0 28px rgba(0,255,136,.5),inset 0 0 14px rgba(0,255,136,.1)}
}
@keyframes neonPulseB {
  0%,100%{box-shadow:0 0 6px var(--b),0 0 12px rgba(0,207,255,.3)}
  50%{box-shadow:0 0 14px var(--b),0 0 28px rgba(0,207,255,.5)}
}
.game-card:hover { animation:neonPulse .9s ease-in-out infinite; }
.app-card:hover { animation:neonPulseB .9s ease-in-out infinite; }

/* â”€â”€ LOADING BAR â”€â”€ */
#neonBar {
  position:fixed; top:0; left:0; height:3px; width:0%;
  background:linear-gradient(to right,var(--g),var(--b),var(--p));
  box-shadow:0 0 10px var(--g),0 0 20px var(--b);
  z-index:99998; transition:width .3s ease; pointer-events:none;
  border-radius:0 3px 3px 0;
}
#neonBar::after {
  content:''; position:absolute; right:0; top:-4px;
  width:12px; height:12px; border-radius:50%;
  background:var(--b); box-shadow:0 0 14px var(--b),0 0 28px var(--b);
  animation:neonPulseB .4s ease-in-out infinite;
}

/* â”€â”€ TOAST NOTIFICATIONS â”€â”€ */
#toastContainer {
  position:fixed; bottom:24px; right:24px; z-index:99997;
  display:flex; flex-direction:column; gap:8px; pointer-events:none;
}
.toast {
  background:rgba(6,9,16,.97); border-radius:6px; padding:12px 18px;
  font-family:'Share Tech Mono',monospace; font-size:.68rem; letter-spacing:1px;
  color:#c0d8ff; pointer-events:auto; cursor:pointer;
  animation:toastIn .3s ease both;
  display:flex; align-items:center; gap:10px; min-width:220px;
  backdrop-filter:blur(12px);
}
.toast.green  { border:1px solid rgba(0,255,136,.4); box-shadow:0 0 18px rgba(0,255,136,.15); }
.toast.blue   { border:1px solid rgba(0,207,255,.4); box-shadow:0 0 18px rgba(0,207,255,.15); }
.toast.pink   { border:1px solid rgba(255,0,170,.4); box-shadow:0 0 18px rgba(255,0,170,.15); }
.toast.yellow { border:1px solid rgba(255,204,0,.4); box-shadow:0 0 18px rgba(255,204,0,.15); }
@keyframes toastIn {
  from{opacity:0;transform:translateX(40px) scale(.9)}
  to{opacity:1;transform:translateX(0) scale(1)}
}
@keyframes toastOut {
  from{opacity:1;transform:translateX(0) scale(1)}
  to{opacity:0;transform:translateX(40px) scale(.9)}
}

/* â”€â”€ PARTICLES CANVAS â”€â”€ */
#particleCanvas {
  position:fixed; inset:0; pointer-events:none; z-index:0; opacity:.55;
}

/* â”€â”€ CONFETTI CANVAS â”€â”€ */
#confettiCanvas {
  position:fixed; inset:0; pointer-events:none; z-index:9990;
}

/* â”€â”€ SPLASH SCREEN â”€â”€ */
#splashScreen {
  position:fixed; inset:0; z-index:99990;
  background:#060910;
  display:flex; flex-direction:column; align-items:center; justify-content:center; gap:14px;
}
.splash-logo {
  font-family:'Orbitron',sans-serif; font-weight:900; font-size:3.5rem;
  letter-spacing:12px; color:var(--g);
  text-shadow:0 0 30px var(--g),0 0 60px rgba(0,255,136,.5),0 0 120px rgba(0,255,136,.2);
  animation:splashPulse 1.2s ease-in-out infinite alternate;
}
.splash-logo span{color:var(--b);text-shadow:0 0 30px var(--b);}
@keyframes splashPulse{from{text-shadow:0 0 20px var(--g)}to{text-shadow:0 0 50px var(--g),0 0 100px rgba(0,255,136,.4)}}
.splash-sub {
  font-size:.75rem; letter-spacing:6px; color:#446688;
  animation:fadeIn 1s ease .5s both;
}
.splash-bar-wrap {
  width:280px; height:3px; background:rgba(255,255,255,.06);
  border-radius:3px; overflow:hidden; margin-top:20px;
  animation:fadeIn .5s ease .8s both;
}
.splash-bar-fill {
  height:100%; background:linear-gradient(to right,var(--g),var(--b));
  box-shadow:0 0 10px var(--g); border-radius:3px;
  animation:splashLoad 1.8s cubic-bezier(.4,0,.2,1) 1s both forwards;
  width:0%;
}
@keyframes splashLoad{to{width:100%}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.splash-scanline {
  position:absolute; inset:0; pointer-events:none;
  background:repeating-linear-gradient(transparent,transparent 3px,rgba(0,255,136,.03) 3px,rgba(0,255,136,.03) 4px);
}

/* â”€â”€ MUSIC â”€â”€ */
#page-music { flex-direction:row; }
#musicSidebar {
  width:235px; background:rgba(8,12,26,.9); border-right:1px solid rgba(0,207,255,.12);
  display:flex; flex-direction:column; overflow:hidden; flex-shrink:0;
}
.music-sidebar-header { padding:18px 14px 10px; font-family:'Orbitron',sans-serif; font-size:.63rem; color:var(--b); letter-spacing:3px; border-bottom:1px solid rgba(0,207,255,.1); }
#musicSearch {
  margin:10px; background:rgba(0,207,255,.05); border:1px solid rgba(0,207,255,.15);
  border-radius:3px; color:var(--b); font-family:'Share Tech Mono',monospace; font-size:.7rem;
  padding:8px 10px; outline:none; letter-spacing:1px; width:calc(100% - 20px);
}
#musicSearch::placeholder { color:#334455; }
#musicResults { flex:1; overflow-y:auto; padding:0 6px 6px; }
.music-result {
  display:flex; align-items:center; gap:9px; padding:8px 10px; border-radius:4px; cursor:pointer; transition:background .2s;
}
.music-result:hover { background:rgba(0,207,255,.08); }
.music-result.playing { background:rgba(0,207,255,.12); border-left:2px solid var(--b); }
.result-num { font-size:.58rem; color:#334455; width:14px; text-align:center; flex-shrink:0; }
.result-info { flex:1; overflow:hidden; }
.result-title { font-size:.66rem; color:#c0d8ff; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.result-artist { font-size:.58rem; color:#446688; }
.result-dur { font-size:.58rem; color:#446688; flex-shrink:0; }

#musicMain { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:space-between; padding:30px 30px 0; overflow:hidden; }

.now-playing-art {
  width:190px; height:190px; border-radius:8px; background:linear-gradient(135deg,#0a1020,#060b18);
  display:flex; align-items:center; justify-content:center; font-size:4rem;
  border:1px solid rgba(0,207,255,.2); box-shadow:0 0 50px rgba(0,207,255,.1),0 20px 50px rgba(0,0,0,.5);
  position:relative; overflow:hidden; flex-shrink:0;
}
.now-playing-art::before {
  content:''; position:absolute; inset:-100%;
  background:conic-gradient(from 0deg,transparent,rgba(0,207,255,.08),transparent,rgba(0,255,136,.05),transparent);
  animation:spinart 10s linear infinite;
}
@keyframes spinart{to{transform:rotate(360deg)}}
#nowArtwork { position:relative; z-index:1; }

.now-track-info { text-align:center; padding:16px 0; flex-shrink:0; }
.now-title { font-family:'Orbitron',sans-serif; font-size:.95rem; color:#fff; letter-spacing:2px; margin-bottom:5px; }
.now-artist { font-size:.72rem; color:#6688aa; letter-spacing:2px; }

#lyricsPanel { flex:1; overflow-y:auto; width:100%; max-width:480px; padding:0 0 16px; text-align:center; }
.lyric-placeholder { color:#334455; font-size:.72rem; letter-spacing:2px; margin-top:16px; }

#musicPlayer { width:100%; background:rgba(8,12,26,.95); border-top:1px solid rgba(0,207,255,.12); padding:14px 30px; flex-shrink:0; position:relative; }
.progress-wrap { display:flex; align-items:center; gap:10px; margin-bottom:10px; }
#progressBar { flex:1; height:4px; background:rgba(0,207,255,.15); border-radius:2px; cursor:pointer; }
#progressFill { height:100%; background:linear-gradient(to right,var(--g),var(--b)); border-radius:2px; width:0%; transition:width .5s linear; position:relative; }
#progressFill::after { content:''; position:absolute; right:-5px; top:-4px; width:11px; height:11px; background:var(--b); border-radius:50%; box-shadow:0 0 7px var(--b); }
.time-label { font-size:.58rem; color:#446688; width:34px; text-align:center; }
.waveform { display:flex; gap:3px; align-items:flex-end; height:20px; margin-left:10px; }
.wave-bar { width:3px; background:var(--b); border-radius:2px; animation:wv .7s ease-in-out infinite alternate; box-shadow:0 0 4px var(--b); }
.wave-bar:nth-child(1){animation-delay:0s;height:8px}.wave-bar:nth-child(2){animation-delay:.1s;height:14px}.wave-bar:nth-child(3){animation-delay:.2s;height:20px}.wave-bar:nth-child(4){animation-delay:.15s;height:12px}.wave-bar:nth-child(5){animation-delay:.05s;height:17px}.wave-bar:nth-child(6){animation-delay:.25s;height:8px}
@keyframes wv{from{transform:scaleY(.2)}to{transform:scaleY(1)}}
.waveform.paused .wave-bar{animation-play-state:paused}
.music-controls-row { display:flex; align-items:center; justify-content:center; gap:14px; }
.mc-btn { background:none; border:none; color:#446688; font-size:1.1rem; cursor:pointer; padding:6px; transition:color .2s,transform .1s; line-height:1; }
.mc-btn:hover { color:var(--b); transform:scale(1.15); }
.mc-btn.play { background:var(--b); color:#050810; width:42px; height:42px; border-radius:50%; font-size:.95rem; display:flex; align-items:center; justify-content:center; box-shadow:0 0 18px rgba(0,207,255,.4); }
.mc-btn.play:hover { transform:scale(1.08); color:#050810; opacity:.9; }
.vol-row { display:flex; align-items:center; gap:7px; position:absolute; right:30px; bottom:20px; }
.vol-row span { font-size:.63rem; color:#334455; }
input[type=range].vol { -webkit-appearance:none; width:65px; height:3px; background:rgba(0,207,255,.2); border-radius:2px; outline:none; }
input[type=range].vol::-webkit-slider-thumb { -webkit-appearance:none; width:10px; height:10px; background:var(--b); border-radius:50%; box-shadow:0 0 5px var(--b); cursor:pointer; }

/* â”€â”€ AI â”€â”€ */
#page-ai { flex-direction:row; }
.ai-sidebar { width:190px; background:rgba(12,18,32,.8); border-right:1px solid rgba(255,0,170,.1); padding:14px 8px; display:flex; flex-direction:column; gap:4px; flex-shrink:0; }
.ai-tool-btn { display:flex; align-items:center; gap:9px; background:none; border:none; color:#556677; font-family:'Share Tech Mono',monospace; font-size:.63rem; letter-spacing:1px; padding:9px 10px; border-radius:3px; cursor:pointer; text-align:left; transition:all .2s; }
.ai-tool-btn:hover { color:var(--p); background:rgba(255,0,170,.06); }
.ai-tool-btn.active { color:var(--p); background:rgba(255,0,170,.1); border-left:2px solid var(--p); }
#aiMain { flex:1; display:flex; flex-direction:column; overflow:hidden; }
.ai-tool-content { display:none; flex:1; flex-direction:column; overflow:hidden; }
.ai-tool-content.active { display:flex; }

#chatMessages { flex:1; overflow-y:auto; padding:18px; display:flex; flex-direction:column; gap:13px; }
.msg { display:flex; gap:11px; animation:fadeUp .3s ease; }
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.msg.user { flex-direction:row-reverse; }
.msg-avatar { width:30px; height:30px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:.85rem; flex-shrink:0; }
.msg.ai .msg-avatar { background:rgba(255,0,170,.15); border:1px solid rgba(255,0,170,.3); }
.msg.user .msg-avatar { background:rgba(0,255,136,.15); border:1px solid rgba(0,255,136,.3); }
.msg-bubble { max-width:70%; padding:11px 14px; border-radius:6px; font-size:.73rem; line-height:1.7; letter-spacing:.4px; }
.msg.ai .msg-bubble { background:rgba(255,0,170,.06); border:1px solid rgba(255,0,170,.12); color:#c0c8dd; }
.msg.user .msg-bubble { background:rgba(0,255,136,.06); border:1px solid rgba(0,255,136,.12); color:#c0ddc0; text-align:right; }

.chat-input-row { display:flex; padding:14px; border-top:1px solid rgba(255,0,170,.1); }
.chat-input-row input { flex:1; background:rgba(255,0,170,.04); border:1px solid rgba(255,0,170,.18); border-right:none; border-radius:3px 0 0 3px; color:#c0d8ff; font-family:'Share Tech Mono',monospace; font-size:.73rem; padding:11px 14px; outline:none; letter-spacing:1px; }
.chat-input-row button { background:var(--p); border:none; color:#fff; padding:11px 18px; font-family:'Orbitron',monospace; font-size:.63rem; font-weight:700; letter-spacing:2px; border-radius:0 3px 3px 0; cursor:pointer; }

.imggen-wrap { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:18px; padding:30px; }
.imggen-wrap h2 { font-family:'Orbitron',sans-serif; font-size:.95rem; color:var(--p); letter-spacing:3px; }
.imggen-input-row { display:flex; width:100%; max-width:560px; }
.imggen-input-row input { flex:1; background:rgba(255,0,170,.04); border:1px solid rgba(255,0,170,.2); border-right:none; border-radius:3px 0 0 3px; color:#c0d8ff; font-family:'Share Tech Mono',monospace; font-size:.73rem; padding:11px 14px; outline:none; }
.imggen-input-row button { background:var(--p); border:none; color:#fff; padding:11px 18px; font-family:'Orbitron',monospace; font-size:.63rem; font-weight:700; letter-spacing:2px; border-radius:0 3px 3px 0; cursor:pointer; }
#imgOutput { width:100%; max-width:380px; aspect-ratio:1; background:rgba(255,0,170,.04); border:1px dashed rgba(255,0,170,.2); border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:.73rem; color:#446688; text-align:center; flex-direction:column; gap:8px; overflow:hidden; }
#imgOutput img { width:100%; height:100%; object-fit:cover; border-radius:8px; }

/* â”€â”€ APPS â”€â”€ */
#page-apps { flex-direction:column; overflow-y:auto; }
.apps-header { padding:24px 26px 16px; font-family:'Orbitron',sans-serif; font-size:.68rem; color:#446688; letter-spacing:4px; border-bottom:1px solid var(--border); display:flex; align-items:center; gap:14px; }
.apps-header::after { content:''; flex:1; height:1px; background:linear-gradient(to right,var(--border),transparent); }
.apps-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(170px,1fr)); gap:14px; padding:20px 26px; }
.app-card { background:var(--card2); border:1px solid rgba(0,207,255,.08); border-radius:8px; padding:18px 14px; cursor:pointer; transition:all .2s; display:flex; flex-direction:column; gap:9px; text-decoration:none; }
.app-card:hover { border-color:var(--b); box-shadow:0 4px 18px rgba(0,207,255,.12); transform:translateY(-2px); }
.app-card.featured { border-color:rgba(255,204,0,.3); background:rgba(255,204,0,.04); box-shadow:0 0 20px rgba(255,204,0,.08); }
.app-card.featured:hover { border-color:var(--y); box-shadow:0 4px 24px rgba(255,204,0,.2); }
.app-icon { font-size:1.8rem; }
.app-name { font-family:'Orbitron',sans-serif; font-size:.63rem; color:#c0d8ff; letter-spacing:1px; }
.app-desc { font-size:.58rem; color:#446688; line-height:1.6; }
.app-tag { display:inline-block; font-size:.53rem; letter-spacing:2px; padding:3px 7px; border-radius:2px; margin-top:auto; }
.app-tag.free { background:rgba(0,255,136,.1); color:var(--g); border:1px solid rgba(0,255,136,.2); }
.app-tag.proxy { background:rgba(0,207,255,.1); color:var(--b); border:1px solid rgba(0,207,255,.2); }
.app-tag.unblock { background:rgba(255,204,0,.12); color:var(--y); border:1px solid rgba(255,204,0,.3); }
.app-tag.blocked { background:rgba(0,207,255,.08); color:var(--b); border:1px solid rgba(0,207,255,.2); }

/* â”€â”€ GAMES built-in â”€â”€ */
#page-builtin { flex-direction:column; overflow:hidden; }
#builtinFrame { flex:1; border:none; width:100%; }

/* scrollbars */
::-webkit-scrollbar{width:4px;height:4px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:rgba(0,255,136,.2);border-radius:3px}

.spinner { width:18px; height:18px; border:2px solid rgba(0,207,255,.2); border-top-color:var(--b); border-radius:50%; animation:cspin .8s linear infinite; display:inline-block; }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     COVER SCREEN
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="cover">
  <div class="cover-spinner"></div>
  <div class="cover-text">Loading resources...</div>
  <!-- invisible input captures keystrokes -->
  <input id="coverPass" type="password" autocomplete="off">
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAIN APP
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app">

  <!-- MATRIX CANVAS -->
  <canvas id="matrixCanvas"></canvas>

  <!-- FLASH OVERLAY -->
  <div id="flashOverlay"></div>

  <!-- NEON LOADER BAR -->
  <div id="neonLoader"></div>

  <!-- TOAST CONTAINER -->
  <div id="toastContainer"></div>

  <!-- SPLASH SCREEN -->
  <div id="splashScreen">
    <div class="splash-logo">NEXUS<span>.</span>GG</div>
    <div class="splash-sub">Your school arcade</div>
    <div class="splash-bar-wrap"><div class="splash-bar" id="splashBar"></div></div>
    <div class="splash-ver">v2.0 Â· LOADING SYSTEMS</div>
  </div>

  <!-- PANIC OVERLAY -->
  <div id="panicOverlay" style="display:none;position:fixed;inset:0;z-index:99999;background:#fff;font-family:Arial,sans-serif;">
    <!-- content injected by JS -->
  </div>

  <!-- TOPBAR -->
  <div id="topbar">
    <div class="logo">NEXUS<span>.</span>GG</div>
    <div id="navtabs">
      <button class="navtab active" onclick="switchPage('games',this)">ğŸ® GAMES</button>
      <button class="navtab" onclick="switchPage('music',this)">ğŸµ MUSIC</button>
      <button class="navtab" onclick="switchPage('ai',this)">ğŸ¤– AI</button>
      <button class="navtab" onclick="switchPage('apps',this)">ğŸ“± APPS</button>
      <button class="navtab" onclick="switchPage('settings',this)">âš™ï¸ SETTINGS</button>
      <button class="navtab" onclick="switchPage('chat',this)">ğŸ’¬ CHAT</button>
    </div>
    <div style="display:flex;align-items:center;gap:10px;padding-right:16px;">
      <div id="weatherBadge" style="font-size:.62rem;color:var(--b);letter-spacing:1px;display:none;background:rgba(0,207,255,.08);border:1px solid rgba(0,207,255,.2);border-radius:2px;padding:3px 10px;"></div>
      <div id="panicHint" style="font-size:.58rem;color:#334455;letter-spacing:1px;" title="Press Escape to hide">ESC = HIDE</div>
      <div class="badge-online">ğŸŸ¢ UNLOCKED</div>
    </div>
  </div>

  <!-- MAIN -->
  <div id="main">

    <!-- GAMES -->
    <div class="page active" id="page-games">
      <div id="gamesMain">
        <div class="games-back" id="gamesBack">
          <button onclick="closeGameFrame()">â† BACK</button>
          <span id="currentGameName"></span>
        </div>
        <div id="searchBar">
          <input id="gameSearch" type="text" placeholder="Search games..." oninput="filterGames(this.value)">
        </div>
        <div id="gamesContent">
          <div class="games-grid" id="gamesGrid"></div>
        </div>
        <iframe id="gamesFrame" allowfullscreen sandbox="allow-scripts allow-same-origin allow-forms allow-pointer-lock allow-popups"></iframe>
      </div>
      <div id="gamesSidebar">
        <button class="cat-pill active" onclick="setGameCat(this,'all')">ALL</button>
        <button class="cat-pill" onclick="setGameCat(this,'action')">âš¡ ACTION</button>
        <button class="cat-pill" onclick="setGameCat(this,'puzzle')">ğŸ§© PUZZLE</button>
        <button class="cat-pill" onclick="setGameCat(this,'racing')">ğŸï¸ RACING</button>
        <button class="cat-pill" onclick="setGameCat(this,'shooter')">ğŸ”« SHOOTER</button>
        <button class="cat-pill" onclick="setGameCat(this,'sports')">âš½ SPORTS</button>
        <button class="cat-pill" onclick="setGameCat(this,'io')">ğŸŒ .IO</button>
        <button class="cat-pill" onclick="setGameCat(this,'classic')">ğŸ‘¾ CLASSIC</button>
      </div>
    </div>

    <!-- MUSIC -->
    <div class="page" id="page-music">
      <iframe src="https://vapor.my/page/music/index.html" style="flex:1;border:none;width:100%;height:100%;" allow="autoplay; clipboard-write; fullscreen"></iframe>
    </div>

    <!-- AI -->
    <div class="page" id="page-ai">
      <div class="ai-sidebar">
        <button class="ai-tool-btn active" onclick="setAITool('chat',this)">ğŸ’¬ AI CHAT</button>
        <button class="ai-tool-btn" onclick="setAITool('imggen',this)">ğŸ¨ IMAGE GEN</button>
        <button class="ai-tool-btn" onclick="setAITool('translate',this)">ğŸŒ TRANSLATE</button>
        <button class="ai-tool-btn" onclick="setAITool('summarize',this)">ğŸ“ SUMMARIZE</button>
      </div>
      <div id="aiMain">
        <!-- CHAT -->
        <div class="ai-tool-content active" id="aitool-chat">
          <div id="chatMessages"></div>
          <div class="chat-input-row">
            <input id="chatInput" type="text" placeholder="Ask the AI anything..." onkeydown="if(event.key==='Enter')sendChat()">
            <button onclick="sendChat()">SEND</button>
          </div>
        </div>
        <!-- IMAGE GEN -->
        <div class="ai-tool-content" id="aitool-imggen">
          <div class="imggen-wrap">
            <h2>ğŸ¨ AI IMAGE GENERATOR</h2>
            <p style="font-size:.7rem;color:#446688;letter-spacing:1px;">Describe an image and AI will generate it</p>
            <div class="imggen-input-row">
              <input id="imgPrompt" type="text" placeholder="A neon cyberpunk city at night..." onkeydown="if(event.key==='Enter')generateImage()">
              <button onclick="generateImage()">GENERATE</button>
            </div>
            <div id="imgOutput">
              <span style="font-size:2rem;">ğŸ–¼ï¸</span>
              <span>Your image will appear here</span>
            </div>
          </div>
        </div>
        <!-- TRANSLATE -->
        <div class="ai-tool-content" id="aitool-translate">
          <div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;padding:30px;">
            <h2 style="font-family:'Orbitron',sans-serif;font-size:.95rem;color:var(--p);letter-spacing:3px;">ğŸŒ TRANSLATOR</h2>
            <div style="display:flex;gap:10px;width:100%;max-width:680px;">
              <div style="flex:1;display:flex;flex-direction:column;gap:7px;">
                <select id="fromLang" style="background:rgba(255,0,170,.04);border:1px solid rgba(255,0,170,.2);color:var(--p);font-family:'Share Tech Mono',monospace;font-size:.63rem;padding:6px 10px;border-radius:3px;outline:none;">
                  <option value="auto">Auto Detect</option><option value="en">English</option><option value="es">Spanish</option>
                  <option value="fr">French</option><option value="de">German</option><option value="ja">Japanese</option>
                  <option value="zh">Chinese</option><option value="ar">Arabic</option><option value="pt">Portuguese</option>
                </select>
                <textarea id="translateIn" rows="8" placeholder="Enter text to translate..." style="flex:1;background:rgba(255,0,170,.04);border:1px solid rgba(255,0,170,.15);border-radius:4px;color:#c0d8ff;font-family:'Share Tech Mono',monospace;font-size:.73rem;padding:11px;outline:none;resize:none;line-height:1.7;width:100%;"></textarea>
              </div>
              <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;">
                <button onclick="doTranslate()" style="background:var(--p);border:none;color:#fff;padding:11px 14px;font-family:'Orbitron',monospace;font-size:.58rem;font-weight:700;letter-spacing:2px;border-radius:3px;cursor:pointer;">â†’</button>
              </div>
              <div style="flex:1;display:flex;flex-direction:column;gap:7px;">
                <select id="toLang" style="background:rgba(255,0,170,.04);border:1px solid rgba(255,0,170,.2);color:var(--p);font-family:'Share Tech Mono',monospace;font-size:.63rem;padding:6px 10px;border-radius:3px;outline:none;">
                  <option value="es">Spanish</option><option value="en">English</option><option value="fr">French</option>
                  <option value="de">German</option><option value="ja">Japanese</option><option value="zh">Chinese</option>
                  <option value="ar">Arabic</option><option value="pt">Portuguese</option>
                </select>
                <textarea id="translateOut" rows="8" readonly placeholder="Translation..." style="flex:1;background:rgba(0,0,0,.3);border:1px solid rgba(255,0,170,.1);border-radius:4px;color:var(--g);font-family:'Share Tech Mono',monospace;font-size:.73rem;padding:11px;outline:none;resize:none;line-height:1.7;width:100%;"></textarea>
              </div>
            </div>
          </div>
        </div>
        <!-- SUMMARIZE -->
        <div class="ai-tool-content" id="aitool-summarize">
          <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:14px;padding:30px;">
            <h2 style="font-family:'Orbitron',sans-serif;font-size:.95rem;color:var(--p);letter-spacing:3px;">ğŸ“ SUMMARIZER</h2>
            <textarea id="summarizeIn" rows="8" placeholder="Paste any long text here..." style="width:100%;max-width:680px;background:rgba(255,0,170,.04);border:1px solid rgba(255,0,170,.15);border-radius:4px;color:#c0d8ff;font-family:'Share Tech Mono',monospace;font-size:.73rem;padding:12px;outline:none;resize:none;line-height:1.7;"></textarea>
            <button onclick="doSummarize()" style="background:var(--p);border:none;color:#fff;padding:11px 26px;font-family:'Orbitron',monospace;font-size:.68rem;font-weight:700;letter-spacing:3px;border-radius:3px;cursor:pointer;">SUMMARIZE</button>
            <div id="summarizeOut" style="width:100%;max-width:680px;background:rgba(0,0,0,.3);border:1px solid rgba(0,255,136,.1);border-radius:4px;color:var(--g);font-family:'Share Tech Mono',monospace;font-size:.73rem;padding:12px;line-height:1.8;min-height:70px;"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- APPS -->
    <div class="page" id="page-apps">
      <div id="appsListView" style="display:flex;flex-direction:column;overflow-y:auto;">
        <div class="apps-header">UNBLOCKED APPS</div>
        <div class="apps-grid" id="appsGrid"></div>
      </div>
      <div id="appViewer" style="display:none;flex:1;flex-direction:column;overflow:hidden;">
        <div style="display:flex;align-items:center;gap:12px;padding:10px 16px;background:rgba(0,0,0,.7);border-bottom:1px solid var(--border);flex-shrink:0;">
          <button onclick="closeAppViewer()" style="background:none;border:1px solid rgba(255,0,170,.3);color:var(--p);padding:5px 14px;font-family:'Share Tech Mono',monospace;font-size:.65rem;letter-spacing:2px;border-radius:2px;cursor:pointer;">â† BACK</button>
          <span id="appViewerName" style="font-family:'Orbitron',sans-serif;font-size:.7rem;color:#c0d8ff;letter-spacing:2px;flex:1;"></span>
          <button onclick="openCurrentAppNewTab()" style="background:none;border:1px solid rgba(0,207,255,.3);color:var(--b);padding:5px 14px;font-family:'Share Tech Mono',monospace;font-size:.65rem;letter-spacing:2px;border-radius:2px;cursor:pointer;">â†— NEW TAB</button>
        </div>
        <div id="appBlockedMsg" style="display:none;align-items:center;justify-content:center;flex-direction:column;gap:16px;padding:40px;text-align:center;flex:1;">
          <div style="font-size:3rem;">ğŸš«</div>
          <div style="font-family:'Orbitron',sans-serif;font-size:.9rem;color:var(--p);letter-spacing:3px;">BLOCKED IN FRAME</div>
          <div style="font-size:.73rem;color:#556677;letter-spacing:1px;max-width:420px;line-height:1.8;">All proxy methods failed for this site. It's heavily blocking iframes. Try opening in a new tab.</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;">
            <button onclick="proxyIndex=0;showAppBlocked();document.getElementById('appBlockedMsg').style.display='none';document.getElementById('appFrame').style.display='block';loadInFrame(currentAppUrl);" style="background:rgba(0,255,136,.1);border:1px solid var(--g);color:var(--g);padding:10px 20px;font-family:'Orbitron',monospace;font-size:.63rem;font-weight:700;letter-spacing:2px;border-radius:3px;cursor:pointer;">ğŸ”„ RETRY</button>
            <button onclick="openCurrentAppNewTab()" style="background:var(--b);border:none;color:#050810;padding:10px 20px;font-family:'Orbitron',monospace;font-size:.63rem;font-weight:700;letter-spacing:3px;border-radius:3px;cursor:pointer;">â†— NEW TAB</button>
          </div>
        </div>
        <iframe id="appFrame" style="flex:1;border:none;width:100%;background:#000;" allow="fullscreen *; autoplay *; clipboard-write *"></iframe>
      </div>
    </div>

    <!-- SETTINGS -->
    <div class="page" id="page-settings">
      <div style="overflow-y:auto;flex:1;padding:30px 40px;display:flex;flex-direction:column;gap:28px;max-width:700px;">

        <div style="font-family:'Orbitron',sans-serif;font-size:1rem;color:var(--g);letter-spacing:4px;text-shadow:0 0 20px var(--g);">âš™ï¸ SETTINGS</div>

        <!-- UNBLOCKER URL -->
        <div style="background:var(--card2);border:1px solid rgba(255,204,0,.2);border-radius:8px;padding:20px;">
          <div style="font-family:'Orbitron',sans-serif;font-size:.68rem;color:var(--y);letter-spacing:3px;margin-bottom:6px;">ğŸ”“ UNBLOCKER URL</div>
          <div style="font-size:.65rem;color:#446688;letter-spacing:1px;margin-bottom:12px;">Change the unblocker link â€” password required so only you can change it</div>
          <div style="display:flex;flex-direction:column;gap:8px;">
            <input id="settingUnblocker" type="text" value="https://learn.szczech.com.ar/" style="background:rgba(255,204,0,.04);border:1px solid rgba(255,204,0,.2);border-radius:3px;color:var(--y);font-family:'Share Tech Mono',monospace;font-size:.7rem;padding:10px 14px;outline:none;letter-spacing:1px;width:100%;" placeholder="New unblocker URL...">
            <div style="display:flex;gap:0;">
              <input id="unblockerPassInput" type="password" placeholder="Enter your password to save..." style="flex:1;background:rgba(255,204,0,.04);border:1px solid rgba(255,204,0,.2);border-right:none;border-radius:3px 0 0 3px;color:var(--y);font-family:'Share Tech Mono',monospace;font-size:.7rem;padding:10px 14px;outline:none;letter-spacing:2px;" onkeydown="if(event.key==='Enter')saveUnblocker()">
              <button onclick="saveUnblocker()" style="background:var(--y);border:none;color:#050810;padding:10px 18px;font-family:'Orbitron',monospace;font-size:.63rem;font-weight:700;letter-spacing:2px;border-radius:0 3px 3px 0;cursor:pointer;">SAVE</button>
            </div>
          </div>
          <div id="unblockerSaved" style="display:none;font-size:.63rem;color:var(--g);margin-top:8px;letter-spacing:1px;">âœ… Unblocker URL saved!</div>
          <div id="unblockerError" style="display:none;font-size:.63rem;color:var(--p);margin-top:8px;letter-spacing:1px;">âŒ Wrong password â€” only the owner can change this</div>
        </div>

        <!-- PASSWORD -->
        <div style="background:var(--card2);border:1px solid rgba(0,255,136,.15);border-radius:8px;padding:20px;">
          <div style="font-family:'Orbitron',sans-serif;font-size:.68rem;color:var(--g);letter-spacing:3px;margin-bottom:6px;">ğŸ”’ CHANGE PASSWORD</div>
          <div style="font-size:.65rem;color:#446688;letter-spacing:1px;margin-bottom:12px;">Change the password for the loading screen</div>
          <div style="display:flex;flex-direction:column;gap:8px;">
            <input id="settingPassOld" type="password" placeholder="Current password" style="background:rgba(0,255,136,.04);border:1px solid rgba(0,255,136,.15);border-radius:3px;color:var(--g);font-family:'Share Tech Mono',monospace;font-size:.7rem;padding:10px 14px;outline:none;letter-spacing:2px;">
            <input id="settingPassNew" type="password" placeholder="New password" style="background:rgba(0,255,136,.04);border:1px solid rgba(0,255,136,.15);border-radius:3px;color:var(--g);font-family:'Share Tech Mono',monospace;font-size:.7rem;padding:10px 14px;outline:none;letter-spacing:2px;">
            <button onclick="savePassword()" style="background:var(--g);border:none;color:#050810;padding:10px 18px;font-family:'Orbitron',monospace;font-size:.63rem;font-weight:700;letter-spacing:2px;border-radius:3px;cursor:pointer;width:fit-content;">SAVE PASSWORD</button>
          </div>
          <div id="passSaved" style="display:none;font-size:.63rem;color:var(--g);margin-top:8px;letter-spacing:1px;">âœ… Password changed!</div>
          <div id="passError" style="display:none;font-size:.63rem;color:var(--p);margin-top:8px;letter-spacing:1px;">âŒ Wrong current password</div>
        </div>

        <!-- THEME -->
        <div style="background:var(--card2);border:1px solid rgba(0,207,255,.15);border-radius:8px;padding:20px;">
          <div style="font-family:'Orbitron',sans-serif;font-size:.68rem;color:var(--b);letter-spacing:3px;margin-bottom:6px;">ğŸ¨ THEME COLOR</div>
          <div style="font-size:.65rem;color:#446688;letter-spacing:1px;margin-bottom:14px;">Pick your accent color</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;">
            <div class="theme-btn" onclick="setTheme('#00ff88','#00cfff')" style="background:linear-gradient(135deg,#00ff88,#00cfff);width:44px;height:44px;border-radius:50%;cursor:pointer;border:2px solid #fff;box-shadow:0 0 12px #00ff88;" title="Green/Blue"></div>
            <div class="theme-btn" onclick="setTheme('#ff00aa','#ff6600')" style="background:linear-gradient(135deg,#ff00aa,#ff6600);width:44px;height:44px;border-radius:50%;cursor:pointer;border:2px solid transparent;" title="Pink/Orange"></div>
            <div class="theme-btn" onclick="setTheme('#a855f7','#ec4899')" style="background:linear-gradient(135deg,#a855f7,#ec4899);width:44px;height:44px;border-radius:50%;cursor:pointer;border:2px solid transparent;" title="Purple/Pink"></div>
            <div class="theme-btn" onclick="setTheme('#f59e0b','#ef4444')" style="background:linear-gradient(135deg,#f59e0b,#ef4444);width:44px;height:44px;border-radius:50%;cursor:pointer;border:2px solid transparent;" title="Amber/Red"></div>
            <div class="theme-btn" onclick="setTheme('#06b6d4','#3b82f6')" style="background:linear-gradient(135deg,#06b6d4,#3b82f6);width:44px;height:44px;border-radius:50%;cursor:pointer;border:2px solid transparent;" title="Cyan/Blue"></div>
            <div class="theme-btn" onclick="setTheme('#10b981','#14b8a6')" style="background:linear-gradient(135deg,#10b981,#14b8a6);width:44px;height:44px;border-radius:50%;cursor:pointer;border:2px solid transparent;" title="Emerald/Teal"></div>
          </div>
          <div id="themeSaved" style="display:none;font-size:.63rem;color:var(--g);margin-top:10px;letter-spacing:1px;">âœ… Theme applied!</div>
        </div>

        <!-- COVER SCREEN -->
        <div style="background:var(--card2);border:1px solid rgba(255,0,170,.15);border-radius:8px;padding:20px;">
          <div style="font-family:'Orbitron',sans-serif;font-size:.68rem;color:var(--p);letter-spacing:3px;margin-bottom:6px;">ğŸ­ COVER SCREEN</div>
          <div style="font-size:.65rem;color:#446688;letter-spacing:1px;margin-bottom:14px;">Choose what the page looks like before the password is entered</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button onclick="setCover('loading')" class="cover-opt active-cover" id="cover-loading" style="background:rgba(255,0,170,.08);border:1px solid rgba(255,0,170,.3);color:var(--p);padding:8px 16px;font-family:'Share Tech Mono',monospace;font-size:.63rem;letter-spacing:1px;border-radius:3px;cursor:pointer;">â³ Loading Spinner</button>
            <button onclick="setCover('classroom')" class="cover-opt" id="cover-classroom" style="background:none;border:1px solid rgba(255,0,170,.15);color:#556677;padding:8px 16px;font-family:'Share Tech Mono',monospace;font-size:.63rem;letter-spacing:1px;border-radius:3px;cursor:pointer;">ğŸ“š Google Classroom</button>
            <button onclick="setCover('docs')" class="cover-opt" id="cover-docs" style="background:none;border:1px solid rgba(255,0,170,.15);color:#556677;padding:8px 16px;font-family:'Share Tech Mono',monospace;font-size:.63rem;letter-spacing:1px;border-radius:3px;cursor:pointer;">ğŸ“ Google Docs</button>
            <button onclick="setCover('blank')" class="cover-opt" id="cover-blank" style="background:none;border:1px solid rgba(255,0,170,.15);color:#556677;padding:8px 16px;font-family:'Share Tech Mono',monospace;font-size:.63rem;letter-spacing:1px;border-radius:3px;cursor:pointer;">â¬œ Blank White</button>
          </div>
        </div>

        <!-- PANIC BUTTON -->
        <div style="background:var(--card2);border:1px solid rgba(255,0,170,.3);border-radius:8px;padding:20px;">
          <div style="font-family:'Orbitron',sans-serif;font-size:.68rem;color:var(--p);letter-spacing:3px;margin-bottom:6px;">ğŸš¨ PANIC BUTTON</div>
          <div style="font-size:.65rem;color:#446688;letter-spacing:1px;margin-bottom:14px;">Press <strong style="color:var(--p)">ESC</strong> anytime to instantly hide the site. Customize what it shows instead.</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;">
            <button onclick="setPanic('blank')" id="panic-blank" class="panic-opt" style="background:rgba(255,0,170,.08);border:1px solid rgba(255,0,170,.3);color:var(--p);padding:7px 14px;font-family:'Share Tech Mono',monospace;font-size:.63rem;letter-spacing:1px;border-radius:3px;cursor:pointer;">â¬œ Blank White</button>
            <button onclick="setPanic('classroom')" id="panic-classroom" class="panic-opt" style="background:none;border:1px solid rgba(255,0,170,.15);color:#556677;padding:7px 14px;font-family:'Share Tech Mono',monospace;font-size:.63rem;letter-spacing:1px;border-radius:3px;cursor:pointer;">ğŸ“š Google Classroom</button>
            <button onclick="setPanic('docs')" id="panic-docs" class="panic-opt" style="background:none;border:1px solid rgba(255,0,170,.15);color:#556677;padding:7px 14px;font-family:'Share Tech Mono',monospace;font-size:.63rem;letter-spacing:1px;border-radius:3px;cursor:pointer;">ğŸ“ Google Docs</button>
            <button onclick="setPanic('search')" id="panic-search" class="panic-opt" style="background:none;border:1px solid rgba(255,0,170,.15);color:#556677;padding:7px 14px;font-family:'Share Tech Mono',monospace;font-size:.63rem;letter-spacing:1px;border-radius:3px;cursor:pointer;">ğŸ” Google Search</button>
          </div>
          <button onclick="triggerPanic()" style="background:var(--p);border:none;color:#fff;padding:9px 20px;font-family:'Orbitron',monospace;font-size:.63rem;font-weight:700;letter-spacing:2px;border-radius:3px;cursor:pointer;">ğŸš¨ TEST PANIC</button>
        </div>

        <!-- WALLPAPER -->
        <div style="background:var(--card2);border:1px solid rgba(0,207,255,.2);border-radius:8px;padding:20px;">
          <div style="font-family:'Orbitron',sans-serif;font-size:.68rem;color:var(--b);letter-spacing:3px;margin-bottom:6px;">ğŸ¨ BACKGROUND / WALLPAPER</div>
          <div style="font-size:.65rem;color:#446688;letter-spacing:1px;margin-bottom:14px;">Pick a background for the site</div>
          <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:8px;margin-bottom:12px;">
            <div onclick="setWallpaper('none')" style="height:56px;background:#060910;border:2px solid rgba(0,207,255,.3);border-radius:6px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.55rem;color:#446688;letter-spacing:1px;transition:all .2s;" onmouseover="this.style.borderColor='var(--b)'" onmouseout="this.style.borderColor='rgba(0,207,255,.3)'">DEFAULT</div>
            <div onclick="setWallpaper('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?w=1920&q=80')" style="height:56px;background:url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?w=400&q=60') center/cover;border:2px solid transparent;border-radius:6px;cursor:pointer;transition:all .2s;" onmouseover="this.style.borderColor='var(--b)'" onmouseout="this.style.borderColor='transparent'"></div>
            <div onclick="setWallpaper('https://images.unsplash.com/photo-1542831371-29b0f74f9713?w=1920&q=80')" style="height:56px;background:url('https://images.unsplash.com/photo-1542831371-29b0f74f9713?w=400&q=60') center/cover;border:2px solid transparent;border-radius:6px;cursor:pointer;transition:all .2s;" onmouseover="this.style.borderColor='var(--b)'" onmouseout="this.style.borderColor='transparent'"></div>
            <div onclick="setWallpaper('https://images.unsplash.com/photo-1506318137071-a8e063b4bec0?w=1920&q=80')" style="height:56px;background:url('https://images.unsplash.com/photo-1506318137071-a8e063b4bec0?w=400&q=60') center/cover;border:2px solid transparent;border-radius:6px;cursor:pointer;transition:all .2s;" onmouseover="this.style.borderColor='var(--b)'" onmouseout="this.style.borderColor='transparent'"></div>
            <div onclick="setWallpaper('https://images.unsplash.com/photo-1519681393784-d120267933ba?w=1920&q=80')" style="height:56px;background:url('https://images.unsplash.com/photo-1519681393784-d120267933ba?w=400&q=60') center/cover;border:2px solid transparent;border-radius:6px;cursor:pointer;transition:all .2s;" onmouseover="this.style.borderColor='var(--b)'" onmouseout="this.style.borderColor='transparent'"></div>
            <div onclick="setWallpaper('https://images.unsplash.com/photo-1475274047050-1d0c0975c63e?w=1920&q=80')" style="height:56px;background:url('https://images.unsplash.com/photo-1475274047050-1d0c0975c63e?w=400&q=60') center/cover;border:2px solid transparent;border-radius:6px;cursor:pointer;transition:all .2s;" onmouseover="this.style.borderColor='var(--b)'" onmouseout="this.style.borderColor='transparent'"></div>
            <div onclick="setWallpaper('https://images.unsplash.com/photo-1483489571097-0ca295ba3d08?w=1920&q=80')" style="height:56px;background:url('https://images.unsplash.com/photo-1483489571097-0ca295ba3d08?w=400&q=60') center/cover;border:2px solid transparent;border-radius:6px;cursor:pointer;transition:all .2s;" onmouseover="this.style.borderColor='var(--b)'" onmouseout="this.style.borderColor='transparent'"></div>
            <div onclick="setWallpaper('https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=1920&q=80')" style="height:56px;background:url('https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=400&q=60') center/cover;border:2px solid transparent;border-radius:6px;cursor:pointer;transition:all .2s;" onmouseover="this.style.borderColor='var(--b)'" onmouseout="this.style.borderColor='transparent'"></div>
          </div>
          <div style="display:flex;gap:0;">
            <input id="wallpaperUrl" type="text" placeholder="Or paste any image URL..." style="flex:1;background:rgba(0,207,255,.04);border:1px solid rgba(0,207,255,.2);border-right:none;border-radius:3px 0 0 3px;color:var(--b);font-family:'Share Tech Mono',monospace;font-size:.68rem;padding:9px 12px;outline:none;letter-spacing:1px;">
            <button onclick="setWallpaper(document.getElementById('wallpaperUrl').value)" style="background:var(--b);border:none;color:#050810;padding:9px 16px;font-family:'Orbitron',monospace;font-size:.6rem;font-weight:700;letter-spacing:2px;border-radius:0 3px 3px 0;cursor:pointer;">SET</button>
          </div>
        </div>

        <!-- WEATHER -->
        <div style="background:var(--card2);border:1px solid rgba(0,207,255,.15);border-radius:8px;padding:20px;">
          <div style="font-family:'Orbitron',sans-serif;font-size:.68rem;color:var(--b);letter-spacing:3px;margin-bottom:6px;">ğŸŒ¤ï¸ WEATHER WIDGET</div>
          <div style="font-size:.65rem;color:#446688;letter-spacing:1px;margin-bottom:12px;">Shows weather in the top bar. Enter your city:</div>
          <div style="display:flex;gap:0;margin-bottom:10px;">
            <input id="weatherCity" type="text" placeholder="New York, London, Tokyo..." style="flex:1;background:rgba(0,207,255,.04);border:1px solid rgba(0,207,255,.2);border-right:none;border-radius:3px 0 0 3px;color:var(--b);font-family:'Share Tech Mono',monospace;font-size:.68rem;padding:9px 12px;outline:none;letter-spacing:1px;" onkeydown="if(event.key==='Enter')fetchWeather()">
            <button onclick="fetchWeather()" style="background:var(--b);border:none;color:#050810;padding:9px 16px;font-family:'Orbitron',monospace;font-size:.6rem;font-weight:700;letter-spacing:2px;border-radius:0 3px 3px 0;cursor:pointer;">GET</button>
          </div>
          <div id="weatherResult" style="font-size:.68rem;color:#446688;letter-spacing:1px;"></div>
        </div>

        <!-- ABOUT -->
        <div style="background:var(--card2);border:1px solid rgba(0,255,136,.08);border-radius:8px;padding:20px;">
          <div style="font-family:'Orbitron',sans-serif;font-size:.68rem;color:#446688;letter-spacing:3px;margin-bottom:10px;">â„¹ï¸ ABOUT</div>
          <div style="font-size:.65rem;color:#334455;letter-spacing:1px;line-height:2;">NEXUS.GG â€” Your school arcade<br>Password protected Â· Offline games Â· AI tools Â· Music player</div>
        </div>

      </div>
    </div>

    <!-- CHAT PAGE -->
    <div class="page" id="page-chat">
      <div style="display:flex;flex-direction:column;height:100%;position:relative;">
        <div style="padding:14px 20px;border-bottom:1px solid rgba(255,0,170,.1);display:flex;align-items:center;gap:14px;background:rgba(0,0,0,.3);flex-shrink:0;">
          <div style="font-family:'Orbitron',sans-serif;font-size:.7rem;color:var(--p);letter-spacing:3px;">ğŸ’¬ SECRET CHAT</div>
          <div id="chatRoomName" style="font-size:.65rem;color:#446688;letter-spacing:1px;flex:1;"></div>
          <div style="display:flex;gap:8px;align-items:center;">
            <span style="font-size:.6rem;color:#334455;letter-spacing:1px;">ROOM:</span>
            <input id="roomCodeInput" type="text" maxlength="20" placeholder="enter room code..." style="background:rgba(255,0,170,.06);border:1px solid rgba(255,0,170,.2);border-radius:3px;color:var(--p);font-family:'Share Tech Mono',monospace;font-size:.65rem;padding:5px 10px;outline:none;width:140px;letter-spacing:1px;" onkeydown="if(event.key==='Enter')joinRoom()">
            <button onclick="joinRoom()" style="background:var(--p);border:none;color:#fff;padding:5px 12px;font-family:'Orbitron',monospace;font-size:.58rem;font-weight:700;letter-spacing:1px;border-radius:3px;cursor:pointer;">JOIN</button>
          </div>
          <div style="display:flex;gap:8px;align-items:center;">
            <span style="font-size:.6rem;color:#334455;letter-spacing:1px;">NAME:</span>
            <input id="chatNameInput" type="text" maxlength="16" placeholder="your name..." style="background:rgba(255,0,170,.06);border:1px solid rgba(255,0,170,.2);border-radius:3px;color:var(--p);font-family:'Share Tech Mono',monospace;font-size:.65rem;padding:5px 10px;outline:none;width:120px;letter-spacing:1px;">
          </div>
        </div>
        <div id="chatLog" style="flex:1;overflow-y:auto;padding:16px 20px;display:flex;flex-direction:column;gap:10px;">
          <div style="text-align:center;font-size:.63rem;color:#334455;letter-spacing:2px;padding:20px;">Enter a room code and your name to start chatting with friends ğŸ”’</div>
        </div>
        <div style="display:flex;gap:0;padding:14px 16px;border-top:1px solid rgba(255,0,170,.1);background:rgba(0,0,0,.3);">
          <input id="chatMsgInput" type="text" placeholder="Type a message... (Enter to send)" maxlength="200" style="flex:1;background:rgba(255,0,170,.04);border:1px solid rgba(255,0,170,.18);border-right:none;border-radius:3px 0 0 3px;color:#c0d8ff;font-family:'Share Tech Mono',monospace;font-size:.73rem;padding:11px 14px;outline:none;letter-spacing:1px;" onkeydown="if(event.key==='Enter')sendChatMsg()">
          <button onclick="sendChatMsg()" style="background:var(--p);border:none;color:#fff;padding:11px 20px;font-family:'Orbitron',monospace;font-size:.63rem;font-weight:700;letter-spacing:2px;border-radius:0 3px 3px 0;cursor:pointer;">SEND</button>
        </div>
      </div>
    </div>

  </div><!-- /main -->
</div><!-- /app -->

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PASSWORD / COVER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentPassword = 'Jesus247'; // will be overridden by settings
let typed = '';

// Keep focus on hidden input when on cover
document.getElementById('cover').addEventListener('click', () => {
  document.getElementById('coverPass').focus();
});

document.getElementById('coverPass').addEventListener('input', function() {
  typed = this.value;
  if (typed === currentPassword) unlock();
});

// Also listen to keydown on the whole cover for keyboards that bypass input
document.addEventListener('keydown', (e) => {
  if (!document.getElementById('cover').style.display !== 'none') return;
  document.getElementById('coverPass').focus();
});

function unlock() {
  document.getElementById('cover').style.display = 'none';
  document.getElementById('app').style.display = 'flex';
  renderGames(games);
  addMsg('chatMessages','ai','Hey! I\'m NEXUS AI ğŸ¤– Ask me anything â€” gaming tips, homework help, or just chat!');
  setTimeout(() => {
    spawnFireworks();
    showToast('ğŸ”“ UNLOCKED', 'Welcome back to NEXUS.GG', 'var(--g)');
  }, 400);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchPage(id, btn) {
  // âš¡ Neon loader bar
  const bar = document.getElementById('neonLoader');
  if (bar) {
    bar.style.cssText = 'transition:none;width:0%;opacity:1;';
    bar.offsetHeight;
    bar.style.cssText = 'transition:width .35s ease;width:85%;opacity:1;';
    setTimeout(() => {
      bar.style.cssText = 'transition:width .2s ease, opacity .4s ease .1s;width:100%;opacity:0;';
      setTimeout(() => { bar.style.width='0%'; }, 700);
    }, 350);
  }
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.navtab').forEach(b => b.classList.remove('active'));
  document.getElementById('page-' + id).classList.add('active');
  btn.classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAMES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const games = [
  // IO GAMES
  { name:'SLITHER.IO', emoji:'ğŸ', cat:'io', url:'https://slither.io', rating:'4.9', plays:'50M+', gif:'https://media.giphy.com/media/3oEjHV0z8S7WM4MwnK/giphy.gif' },
  { name:'AGAR.IO', emoji:'ğŸ”µ', cat:'io', url:'https://agar.io', rating:'4.8', plays:'30M+', gif:'https://media.giphy.com/media/l0HlQ7LRalQqdWfao/giphy.gif' },
  { name:'PAPER.IO 2', emoji:'ğŸ“„', cat:'io', url:'https://paper-io.com', rating:'4.7', plays:'20M+', gif:'' },
  { name:'LORDZ.IO', emoji:'ğŸ‘‘', cat:'io', url:'https://www.lordz.io', rating:'4.5', plays:'5M+', gif:'' },
  { name:'DIEP.IO', emoji:'ğŸ”«', cat:'io', url:'https://diep.io', rating:'4.6', plays:'12M+', gif:'' },
  { name:'MOPE.IO', emoji:'ğŸ»', cat:'io', url:'https://mope.io', rating:'4.4', plays:'8M+', gif:'' },
  { name:'ZOMBS ROYALE', emoji:'ğŸ§Ÿ', cat:'io', url:'https://zombsroyale.io', rating:'4.7', plays:'15M+', gif:'https://media.giphy.com/media/3ohzdIuqJoo8QdKlnW/giphy.gif' },
  { name:'SURVIV.IO', emoji:'ğŸª–', cat:'io', url:'https://surviv.io', rating:'4.8', plays:'20M+', gif:'' },
  { name:'WORMATE.IO', emoji:'ğŸ­', cat:'io', url:'https://wormate.io', rating:'4.5', plays:'7M+', gif:'' },
  { name:'WINGS.IO', emoji:'âœˆï¸', cat:'io', url:'https://wings.io', rating:'4.4', plays:'5M+', gif:'' },
  // SHOOTER
  { name:'KRUNKER.IO', emoji:'ğŸ¯', cat:'shooter', url:'https://krunker.io', rating:'4.9', plays:'15M+', gif:'https://media.giphy.com/media/3oEjHWpiMWn7jLExQI/giphy.gif' },
  { name:'SHELL SHOCKERS', emoji:'ğŸ¥š', cat:'shooter', url:'https://shellshock.io', rating:'4.8', plays:'10M+', gif:'' },
  { name:'BULLET FORCE', emoji:'ğŸ”«', cat:'shooter', url:'https://www.crazygames.com/game/bullet-force-multiplayer', rating:'4.7', plays:'8M+', gif:'https://media.giphy.com/media/xT9IgG50Lg7russbDa/giphy.gif' },
  { name:'COMBAT ONLINE', emoji:'ğŸ’¥', cat:'shooter', url:'https://www.crazygames.com/game/combat-online', rating:'4.5', plays:'4M+', gif:'' },
  // RACING
  { name:'MOTO X3M', emoji:'ğŸï¸', cat:'racing', url:'https://www.motox3m.com', rating:'4.8', plays:'8M+', gif:'https://media.giphy.com/media/26BRBKqUiq586bRVm/giphy.gif' },
  { name:'DRIFT BOSS', emoji:'ğŸš—', cat:'racing', url:'https://driftboss.io', rating:'4.6', plays:'5M+', gif:'https://media.giphy.com/media/3oEjI6SIIHBdRxXI40/giphy.gif' },
  { name:'ROAD FURY', emoji:'ğŸš™', cat:'racing', url:'https://www.crazygames.com/game/road-fury', rating:'4.5', plays:'3M+', gif:'' },
  { name:'MOTO X3M WINTER', emoji:'â„ï¸', cat:'racing', url:'https://www.crazygames.com/game/moto-x3m-winter', rating:'4.7', plays:'4M+', gif:'' },
  { name:'BURNOUT DRIFT', emoji:'ğŸ’¨', cat:'racing', url:'https://www.crazygames.com/game/burnout-drift', rating:'4.6', plays:'3M+', gif:'' },
  // PUZZLE
  { name:'2048', emoji:'ğŸ§©', cat:'puzzle', url:'https://play2048.co', rating:'4.7', plays:'100M+', gif:'https://media.giphy.com/media/3o7TKDEhaCALECx7a8/giphy.gif' },
  { name:'UNBLOCK ME', emoji:'ğŸŸ§', cat:'puzzle', url:'https://www.crazygames.com/game/unblock-it', rating:'4.5', plays:'5M+', gif:'' },
  { name:'CUT THE ROPE', emoji:'ğŸ¬', cat:'puzzle', url:'https://www.crazygames.com/game/cut-the-rope-remastered', rating:'4.8', plays:'10M+', gif:'https://media.giphy.com/media/xT9IgE1zDPQXr9Kqms/giphy.gif' },
  { name:'MAHJONG', emoji:'ğŸ€„', cat:'puzzle', url:'https://www.crazygames.com/game/mahjong-classic', rating:'4.6', plays:'8M+', gif:'' },
  { name:'SUDOKU', emoji:'ğŸ”¢', cat:'puzzle', url:'https://sudoku.com', rating:'4.7', plays:'20M+', gif:'' },
  // ACTION
  { name:'MINECRAFT CLASSIC', emoji:'â›ï¸', cat:'action', url:'https://classic.minecraft.net', rating:'4.9', plays:'50M+', gif:'https://media.giphy.com/media/3oEjHAUOqG3lSS0f1C/giphy.gif' },
  { name:'AMONG US ONLINE', emoji:'ğŸ”´', cat:'action', url:'https://www.crazygames.com/game/among-us-online-edition', rating:'4.7', plays:'20M+', gif:'https://media.giphy.com/media/KzCRxnkXuaspcfFGMG/giphy.gif' },
  { name:'STICKMAN HOOK', emoji:'ğŸ•¸ï¸', cat:'action', url:'https://www.crazygames.com/game/stickman-hook', rating:'4.8', plays:'12M+', gif:'' },
  { name:'VENGE.IO', emoji:'âš”ï¸', cat:'action', url:'https://venge.io', rating:'4.7', plays:'6M+', gif:'' },
  { name:'TEMPLE RUN', emoji:'ğŸƒ', cat:'action', url:'https://poki.com/en/g/temple-run-2', rating:'4.8', plays:'40M+', gif:'https://media.giphy.com/media/3oEjI5VtIhAfERmKWk/giphy.gif' },
  { name:'SUBWAY SURFERS', emoji:'ğŸ›¹', cat:'action', url:'https://poki.com/en/g/subway-surfers', rating:'4.9', plays:'80M+', gif:'https://media.giphy.com/media/3o6Zt8UGTBCRXqrPag/giphy.gif' },
  { name:'GEOMETRY DASH LITE', emoji:'ğŸ”·', cat:'action', url:'https://www.crazygames.com/game/geometry-dash-classic', rating:'4.8', plays:'15M+', gif:'https://media.giphy.com/media/3oEjHQKtDXpeGN9rW0/giphy.gif' },
  { name:'FNAF ONLINE', emoji:'ğŸ»', cat:'action', url:'https://www.crazygames.com/game/five-nights-at-freddys', rating:'4.7', plays:'8M+', gif:'https://media.giphy.com/media/l4FGni1RBAR2OWsGk/giphy.gif' },
  // CLASSIC
  { name:'TETRIS', emoji:'ğŸŸ¦', cat:'classic', url:'https://tetris.com/play-tetris', rating:'4.9', plays:'1B+', gif:'https://media.giphy.com/media/3o6ZtaO9BZHcOjmErm/giphy.gif' },
  { name:'PAC-MAN', emoji:'ğŸ‘¾', cat:'classic', url:'https://www.google.com/logos/2010/pacman10-i.html', rating:'4.9', plays:'1B+', gif:'https://media.giphy.com/media/3oEjHE6sp5GHuPBLAA/giphy.gif' },
  { name:'COOKIE CLICKER', emoji:'ğŸª', cat:'classic', url:'https://orteil.dashnet.org/cookieclicker/', rating:'4.6', plays:'10M+', gif:'https://media.giphy.com/media/3oEdv6oTGJW6ENy6eI/giphy.gif' },
  { name:'SNAKE', emoji:'ğŸ', cat:'classic', url:'https://www.google.com/fbx?fbx=snake_arcade', rating:'4.7', plays:'500M+', gif:'' },
  { name:'DINOSAUR GAME', emoji:'ğŸ¦–', cat:'classic', url:'https://chromedino.com', rating:'4.8', plays:'200M+', gif:'https://media.giphy.com/media/3ohzdIuqJoo8QdKlnW/giphy.gif' },
  { name:'FLAPPY BIRD', emoji:'ğŸ¤', cat:'classic', url:'https://flappybird.io', rating:'4.5', plays:'100M+', gif:'https://media.giphy.com/media/tXL4FHPSnVJ0A/giphy.gif' },
  // SPORTS
  { name:'BASKETBALL STARS', emoji:'ğŸ€', cat:'sports', url:'https://www.miniclip.com/games/basketball-stars/en/', rating:'4.7', plays:'3M+', gif:'https://media.giphy.com/media/3oEjHGr1FfjSjS5eMQ/giphy.gif' },
  { name:'SOCCER SKILLS', emoji:'âš½', cat:'sports', url:'https://www.crazygames.com/game/soccer-skills-world-cup', rating:'4.5', plays:'2M+', gif:'' },
  { name:'PENALTY SHOOTERS', emoji:'ğŸ¥…', cat:'sports', url:'https://www.crazygames.com/game/penalty-shooters-2', rating:'4.6', plays:'5M+', gif:'' },
  { name:'GOLF ORBIT', emoji:'â›³', cat:'sports', url:'https://www.crazygames.com/game/golf-orbit', rating:'4.4', plays:'2M+', gif:'' },
  { name:'BOXING RANDOM', emoji:'ğŸ¥Š', cat:'sports', url:'https://www.crazygames.com/game/boxing-random', rating:'4.7', plays:'4M+', gif:'' },
];

let activeGameCat = 'all';

function renderGames(list) {
  document.getElementById('gamesGrid').innerHTML = list.map(g => `
    <div class="game-card" onclick="openGame('${g.name}','${g.emoji}','${g.url}')">
      <div class="game-thumb" style="position:relative;overflow:hidden;">
        <span style="font-size:2.5rem;position:relative;z-index:2;">${g.emoji}</span>
        ${g.gif ? `<img src="${g.gif}" style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity .3s;z-index:1;" onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0" onerror="this.style.display='none'">` : ''}
        <div style="position:absolute;inset:0;background:linear-gradient(to bottom,transparent 60%,rgba(0,0,0,.7));z-index:3;pointer-events:none;"></div>
      </div>
      <div class="game-info">
        <div class="game-name">${g.name}</div>
        <div class="game-meta"><span class="game-rating">â˜… ${g.rating}</span><span>${g.plays}</span></div>
      </div>
    </div>`).join('');
}

function setGameCat(btn, cat) {
  document.querySelectorAll('.cat-pill').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  activeGameCat = cat;
  filterGames(document.getElementById('gameSearch').value);
}

function filterGames(q) {
  let list = activeGameCat === 'all' ? games : games.filter(g => g.cat === activeGameCat);
  if (q) list = list.filter(g => g.name.toLowerCase().includes(q.toLowerCase()));
  renderGames(list);
}

function openGame(name, emoji, url) {
  // Screen shake + flash effect
  const flash = document.getElementById('flashOverlay');
  flash.style.animation = 'none';
  flash.offsetHeight; // reflow
  flash.style.transition = 'opacity 0s';
  flash.style.opacity = '0.5';
  document.getElementById('main').classList.add('shake');
  setTimeout(() => {
    flash.style.transition = 'opacity 0.4s ease';
    flash.style.opacity = '0';
    document.getElementById('main').classList.remove('shake');
  }, 80);

  showLoader();
  document.getElementById('currentGameName').textContent = emoji + ' ' + name;
  document.getElementById('gamesContent').style.display = 'none';
  document.getElementById('gamesBack').style.display = 'flex';
  document.getElementById('gamesFrame').style.display = 'block';
  document.getElementById('gamesFrame').src = url;
  showToast('ğŸ® LOADING', name, 'var(--g)');
}

function closeGameFrame() {
  document.getElementById('gamesFrame').src = 'about:blank';
  document.getElementById('gamesFrame').style.display = 'none';
  document.getElementById('gamesContent').style.display = 'block';
  document.getElementById('gamesBack').style.display = 'none';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MUSIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let audioEl = new Audio();
let musicPlaying = false;
let currentMusicIndex = -1;
let musicQueue = [];
let repeatMode = false;

// â”€â”€ MUSIC: Uses iTunes Search API (no key, no CORS issues) + YouTube embed for playback
let ytPlayer = null;
let ytReady = false;
let pendingVideoId = null;

// Load YouTube IFrame API
(function() {
  const tag = document.createElement('script');
  tag.src = 'https://www.youtube.com/iframe_api';
  document.head.appendChild(tag);
})();

function onYouTubeIframeAPIReady() {
  ytReady = true;
  // Create hidden YT player in music panel
  const div = document.createElement('div');
  div.id = 'ytPlayerDiv';
  div.style.cssText = 'position:absolute;opacity:0;pointer-events:none;width:1px;height:1px;';
  document.body.appendChild(div);
  ytPlayer = new YT.Player('ytPlayerDiv', {
    height: '1', width: '1',
    playerVars: { autoplay: 0, controls: 0 },
    events: {
      onReady: () => { if (pendingVideoId) playYT(pendingVideoId); },
      onStateChange: (e) => {
        if (e.data === YT.PlayerState.PLAYING) {
          musicPlaying = true;
          document.getElementById('playPauseBtn').textContent = 'â¸';
          document.getElementById('waveformEl').classList.remove('paused');
          startYTProgress();
        } else if (e.data === YT.PlayerState.PAUSED) {
          musicPlaying = false;
          document.getElementById('playPauseBtn').textContent = 'â–¶';
          document.getElementById('waveformEl').classList.add('paused');
        } else if (e.data === YT.PlayerState.ENDED) {
          if (repeatMode) ytPlayer.playVideo();
          else nextTrack();
        }
      }
    }
  });
}

let ytProgressTimer = null;
function startYTProgress() {
  clearInterval(ytProgressTimer);
  ytProgressTimer = setInterval(() => {
    if (!ytPlayer || !ytPlayer.getDuration) return;
    const cur = ytPlayer.getCurrentTime() || 0;
    const dur = ytPlayer.getDuration() || 0;
    if (dur > 0) {
      document.getElementById('progressFill').style.width = (cur/dur*100) + '%';
      document.getElementById('timeCur').textContent = fmtTime(cur);
      document.getElementById('timeTot').textContent = fmtTime(dur);
    }
  }, 500);
}

function playYT(videoId) {
  if (!ytPlayer || !ytReady) { pendingVideoId = videoId; return; }
  pendingVideoId = null;
  ytPlayer.loadVideoById(videoId);
  ytPlayer.setVolume(document.querySelector('input.vol')?.value || 80);
}

async function getYouTubeVideoId(query) {
  // Use YouTube's oEmbed + search via Invidious public API (no key needed)
  const instances = [
    'https://inv.nadeko.net',
    'https://invidious.slipfox.xyz',
    'https://invidious.privacydev.net',
  ];
  for (const base of instances) {
    try {
      const r = await fetch(`${base}/api/v1/search?q=${encodeURIComponent(query)}&type=video&fields=videoId,title,author&page=1`, { signal: AbortSignal.timeout(4000) });
      if (!r.ok) continue;
      const data = await r.json();
      if (data && data[0]) return data[0].videoId;
    } catch(e) { continue; }
  }
  return null;
}

async function searchMusic() {
  const q = document.getElementById('musicSearch').value.trim();
  if (!q) return;
  const res = document.getElementById('musicResults');
  res.innerHTML = '<div style="padding:16px 10px;display:flex;align-items:center;gap:10px;"><div class="spinner"></div><span style="font-size:.63rem;color:#446688;">Searching...</span></div>';
  try {
    // iTunes Search API â€” totally free, no key, no CORS
    const r = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(q)}&media=music&limit=25&entity=song`);
    const data = await r.json();
    musicQueue = (data.results || []).map(t => ({
      title: t.trackName,
      artist: t.artistName,
      album: t.collectionName,
      duration: Math.floor(t.trackTimeMillis / 1000),
      preview: t.previewUrl, // 30s preview always available
      artwork: t.artworkUrl100?.replace('100x100', '300x300'),
      searchQuery: `${t.artistName} ${t.trackName}`,
    }));
    if (!musicQueue.length) {
      res.innerHTML = '<div style="padding:16px 10px;font-size:.63rem;color:#446688;">No results found.</div>';
      return;
    }
    res.innerHTML = musicQueue.map((t,i) => `
      <div class="music-result" id="mr-${i}" onclick="playTrack(${i})">
        <div class="result-num">${i+1}</div>
        <div class="result-info">
          <div class="result-title">${t.title}</div>
          <div class="result-artist">${t.artist}</div>
        </div>
        <div class="result-dur">${fmtTime(t.duration)}</div>
      </div>`).join('');
  } catch(e) {
    res.innerHTML = '<div style="padding:16px 10px;font-size:.63rem;color:#556688;">Search failed â€” check your connection.</div>';
  }
}

async function playTrack(i) {
  if (i < 0 || i >= musicQueue.length) return;
  currentMusicIndex = i;
  const t = musicQueue[i];

  document.querySelectorAll('.music-result').forEach(el => el.classList.remove('playing'));
  const el = document.getElementById('mr-' + i);
  if (el) el.classList.add('playing');

  document.getElementById('nowTitle').textContent = t.title;
  document.getElementById('nowArtist').textContent = t.artist;

  // Show artwork
  const artEl = document.getElementById('nowArtwork');
  if (t.artwork) {
    artEl.style.cssText = 'position:relative;z-index:1;width:100%;height:100%;object-fit:cover;border-radius:8px;';
    artEl.outerHTML = `<img id="nowArtwork" src="${t.artwork}" style="position:relative;z-index:1;width:100%;height:100%;object-fit:cover;border-radius:8px;" onerror="this.outerHTML='<span id=nowArtwork style=position:relative;z-index:1;font-size:4rem>ğŸµ</span>'">`;
  } else {
    document.getElementById('nowArtwork').textContent = 'ğŸµ';
  }

  document.getElementById('lyricsPanel').innerHTML = `
    <div class="lyric-placeholder">â™¬ ${t.title}</div>
    <div class="lyric-placeholder" style="margin-top:6px;font-size:.6rem;">by ${t.artist}</div>
    <div class="lyric-placeholder" style="margin-top:6px;font-size:.58rem;color:#224433;">ğŸ’¿ ${t.album||''}</div>
    <div class="lyric-placeholder" style="margin-top:16px;font-size:.58rem;color:#1a3322;" id="musicSourceLabel">Loading full song...</div>`;

  // Try full song via YouTube first, fallback to iTunes 30s preview
  const videoId = await getYouTubeVideoId(t.searchQuery);
  if (videoId) {
    document.getElementById('musicSourceLabel').textContent = 'â–¶ Full song via YouTube';
    playYT(videoId);
    audioEl.pause(); // stop any preview
  } else if (t.preview) {
    document.getElementById('musicSourceLabel').textContent = 'â–¶ 30s preview Â· iTunes';
    if (ytPlayer) ytPlayer.stopVideo();
    audioEl.src = t.preview;
    audioEl.play();
    musicPlaying = true;
    document.getElementById('playPauseBtn').textContent = 'â¸';
    document.getElementById('waveformEl').classList.remove('paused');
  } else {
    document.getElementById('musicSourceLabel').textContent = 'âŒ No audio available';
  }
}

audioEl.addEventListener('timeupdate', () => {
  if (!audioEl.duration) return;
  const pct = (audioEl.currentTime / audioEl.duration) * 100;
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('timeCur').textContent = fmtTime(Math.floor(audioEl.currentTime));
  document.getElementById('timeTot').textContent = fmtTime(Math.floor(audioEl.duration));
});
audioEl.addEventListener('ended', () => { if (repeatMode) { audioEl.play(); return; } nextTrack(); });

function seekAudio(e) {
  const b = document.getElementById('progressBar');
  const pct = e.offsetX / b.offsetWidth;
  if (ytPlayer && musicPlaying && ytPlayer.getDuration) {
    ytPlayer.seekTo(ytPlayer.getDuration() * pct, true);
  } else {
    audioEl.currentTime = audioEl.duration * pct;
  }
}

function toggleMusicPlay() {
  if (musicPlaying) {
    if (ytPlayer && ytPlayer.getPlayerState && ytPlayer.getPlayerState() === 1) ytPlayer.pauseVideo();
    else { audioEl.pause(); musicPlaying=false; document.getElementById('playPauseBtn').textContent='â–¶'; document.getElementById('waveformEl').classList.add('paused'); }
  } else {
    if (ytPlayer && ytPlayer.getPlayerState && ytPlayer.getPlayerState() === 2) ytPlayer.playVideo();
    else { audioEl.play(); musicPlaying=true; document.getElementById('playPauseBtn').textContent='â¸'; document.getElementById('waveformEl').classList.remove('paused'); }
  }
}
function nextTrack() { if (musicQueue.length) playTrack((currentMusicIndex+1)%musicQueue.length); }
function prevTrack() { if (musicQueue.length) playTrack((currentMusicIndex-1+musicQueue.length)%musicQueue.length); }
function shuffleTrack() { if (musicQueue.length) playTrack(Math.floor(Math.random()*musicQueue.length)); }
function toggleRepeat() { repeatMode=!repeatMode; document.getElementById('repeatBtn').style.color=repeatMode?'var(--g)':''; }
function setMusicVol(v) {
  audioEl.volume = v/100;
  if (ytPlayer && ytPlayer.setVolume) ytPlayer.setVolume(v);
}
function fmtTime(s) { s=Math.floor(s)||0; return Math.floor(s/60)+':'+String(s%60).padStart(2,'0'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setAITool(id, btn) {
  document.querySelectorAll('.ai-tool-content').forEach(el=>el.classList.remove('active'));
  document.querySelectorAll('.ai-tool-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('aitool-'+id).classList.add('active');
  btn.classList.add('active');
}

function addMsg(container, role, text) {
  const d = document.createElement('div');
  d.className = 'msg ' + role;
  d.innerHTML = `<div class="msg-avatar">${role==='ai'?'ğŸ¤–':'ğŸ‘¤'}</div><div class="msg-bubble">${text}</div>`;
  document.getElementById(container).appendChild(d);
  document.getElementById(container).scrollTop = 99999;
  return d;
}

async function callClaude(prompt, system='') {
  const body = { model:'claude-sonnet-4-20250514', max_tokens:1000, messages:[{role:'user',content:prompt}] };
  if (system) body.system = system;
  const res = await fetch('https://api.anthropic.com/v1/messages', {
    method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body)
  });
  const data = await res.json();
  return data.content?.map(c=>c.text||'').join('')||'No response.';
}

async function sendChat() {
  const inp = document.getElementById('chatInput');
  const msg = inp.value.trim(); if (!msg) return;
  inp.value = '';
  addMsg('chatMessages','user',msg);
  const waiting = addMsg('chatMessages','ai','<div class="spinner"></div>');
  try {
    const reply = await callClaude(msg,'You are NEXUS AI, a fun helpful assistant for a gaming site. Keep answers concise and cool.');
    waiting.querySelector('.msg-bubble').innerHTML = reply;
  } catch(e) { waiting.querySelector('.msg-bubble').innerHTML = 'Error. Try again.'; }
}

function generateImage() {
  const prompt = document.getElementById('imgPrompt').value.trim(); if (!prompt) return;
  const out = document.getElementById('imgOutput');
  out.innerHTML = '<div class="spinner"></div><span style="font-size:.7rem;color:#446688;margin-top:8px;">Generating...</span>';
  const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=512&height=512&nologo=true&seed=${Date.now()}`;
  const img = new Image();
  img.onload = () => { out.innerHTML=''; out.appendChild(img); };
  img.onerror = () => { out.innerHTML='<span style="color:#556677;">Failed. Try another prompt.</span>'; };
  img.src = url;
  img.style.cssText = 'width:100%;height:100%;object-fit:cover;border-radius:8px;';
}

async function doTranslate() {
  const text = document.getElementById('translateIn').value.trim(); if (!text) return;
  document.getElementById('translateOut').value = 'Translating...';
  try {
    const to = document.getElementById('toLang').value;
    const from = document.getElementById('fromLang').value;
    const reply = await callClaude(`Translate${from!=='auto'?' from '+from:''} to ${to}. Reply ONLY with the translation:\n\n${text}`);
    document.getElementById('translateOut').value = reply;
  } catch(e) { document.getElementById('translateOut').value = 'Failed.'; }
}

async function doSummarize() {
  const text = document.getElementById('summarizeIn').value.trim(); if (!text) return;
  document.getElementById('summarizeOut').textContent = 'Summarizing...';
  try {
    const reply = await callClaude('Summarize in 3-5 bullet points:\n\n' + text);
    document.getElementById('summarizeOut').textContent = reply;
  } catch(e) { document.getElementById('summarizeOut').textContent = 'Failed.'; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APPS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const UNBLOCKER_URL = 'https://learn.szczech.com.ar/';

const apps = [
  {icon:'ğŸ”“',name:'UNBLOCKER',desc:'Equinox â€” YouTube, Discord, games & more',tag:'unblock',url:UNBLOCKER_URL,mode:'direct'},
  {icon:'ğŸ“º',name:'YOUTUBE',desc:'Watch videos & shorts',tag:'blocked',url:'https://www.youtube.com',mode:'routed'},
  {icon:'ğŸ’¬',name:'DISCORD',desc:'Chat with friends',tag:'blocked',url:'https://discord.com/app',mode:'routed'},
  {icon:'ğŸ®',name:'ROBLOX',desc:'Play Roblox online',tag:'blocked',url:'https://www.roblox.com',mode:'routed'},
  {icon:'ğŸµ',name:'SPOTIFY',desc:'Stream music',tag:'blocked',url:'https://open.spotify.com',mode:'routed'},
  {icon:'ğŸŸ ',name:'REDDIT',desc:'Browse communities',tag:'blocked',url:'https://www.reddit.com',mode:'routed'},
  {icon:'ğŸ¦',name:'TWITTER/X',desc:'Posts & trending news',tag:'blocked',url:'https://twitter.com',mode:'routed'},
  {icon:'ğŸ¬',name:'TWITCH',desc:'Live game streaming',tag:'blocked',url:'https://www.twitch.tv',mode:'routed'},
  {icon:'ğŸ“¸',name:'INSTAGRAM',desc:'Photos & reels',tag:'blocked',url:'https://www.instagram.com',mode:'routed'},
  {icon:'ğŸ¤–',name:'CHATGPT',desc:'OpenAI chatbot',tag:'blocked',url:'https://chat.openai.com',mode:'routed'},
  {icon:'ğŸµ',name:'TIKTOK',desc:'Short videos',tag:'blocked',url:'https://www.tiktok.com',mode:'routed'},
  {icon:'ğŸ‘»',name:'SNAPCHAT',desc:'Snaps & stories',tag:'blocked',url:'https://web.snapchat.com',mode:'routed'},
  {icon:'ğŸ®',name:'STEAM',desc:'PC gaming platform',tag:'blocked',url:'https://store.steampowered.com',mode:'routed'},
  {icon:'ğŸ¥',name:'NETFLIX',desc:'Stream movies & shows',tag:'blocked',url:'https://www.netflix.com',mode:'routed'},
  {icon:'ğŸ¥',name:'CINEBY',desc:'Free movies & shows',tag:'free',url:'https://www.cineby.gd',mode:'direct'},
  {icon:'ğŸ“½ï¸',name:'HEARTIVE',desc:'Movies, series & live TV',tag:'free',url:'https://heartiveloves.pages.dev',mode:'direct'},
  {icon:'ğŸ§®',name:'DESMOS',desc:'Graphing calculator',tag:'free',url:'https://www.desmos.com/calculator',mode:'direct'},
  {icon:'ğŸŒ',name:'WIKIPEDIA',desc:'All human knowledge',tag:'free',url:'https://en.m.wikipedia.org',mode:'direct'},
  {icon:'ğŸ“š',name:'KHAN ACADEMY',desc:'Free lessons & practice',tag:'free',url:'https://www.khanacademy.org',mode:'direct'},
  {icon:'ğŸ—ºï¸',name:'GOOGLE MAPS',desc:'Maps & directions',tag:'free',url:'https://maps.google.com/maps?output=embed',mode:'direct'},
  {icon:'ğŸ“–',name:'GUTENBERG',desc:'10,000+ free classic books',tag:'free',url:'https://www.gutenberg.org',mode:'direct'},
  {icon:'ğŸ®',name:'COOLMATHGAMES',desc:'Math & puzzle games',tag:'free',url:'https://www.coolmathgames.com',mode:'direct'},
  {icon:'ğŸ•¹ï¸',name:'POKI',desc:'100s of free browser games',tag:'free',url:'https://poki.com',mode:'direct'},
  {icon:'ğŸ“°',name:'GOOGLE SCHOLAR',desc:'Research & papers',tag:'free',url:'https://scholar.google.com',mode:'direct'},
  {icon:'ğŸŒ',name:'GOOGLE TRANSLATE',desc:'Translate any language',tag:'free',url:'https://translate.google.com',mode:'direct'},
  {icon:'ğŸ¨',name:'SKETCHPAD',desc:'Draw & create art online',tag:'free',url:'https://sketch.io/sketchpad/',mode:'direct'},
  {icon:'ğŸµ',name:'SOUNDCLOUD',desc:'Free music & podcasts',tag:'free',url:'https://soundcloud.com',mode:'direct'},
  {icon:'ğŸ“',name:'GOOGLE DOCS',desc:'Write & collaborate',tag:'free',url:'https://docs.google.com',mode:'direct'},
  {icon:'ğŸ“Š',name:'GOOGLE SLIDES',desc:'Make presentations',tag:'free',url:'https://slides.google.com',mode:'direct'},
  {icon:'ğŸ”¢',name:'GOOGLE SHEETS',desc:'Spreadsheets online',tag:'free',url:'https://sheets.google.com',mode:'direct'},
  {icon:'ğŸ”',name:'PERPLEXITY AI',desc:'AI-powered search',tag:'free',url:'https://www.perplexity.ai',mode:'direct'},
  {icon:'ğŸ’¡',name:'QUIZLET',desc:'Flashcards & study tools',tag:'free',url:'https://quizlet.com',mode:'direct'},
  {icon:'ğŸ§ ',name:'BRAINPOP',desc:'Educational videos & quizzes',tag:'free',url:'https://www.brainpop.com',mode:'direct'},
  {icon:'ğŸ¯',name:'GIMKIT',desc:'Fun learning games',tag:'free',url:'https://www.gimkit.com',mode:'direct'},
  {icon:'ğŸ•¹ï¸',name:'GAMEFLARE',desc:'Free HTML5 games',tag:'free',url:'https://gameflare.com',mode:'direct'},
];

let currentAppUrl = '';

// Proxy services that strip X-Frame-Options headers so sites load in iframes
const IFRAME_PROXIES = [
  url => `https://learn.szczech.com.ar/`,
  url => `https://corsproxy.io/?${encodeURIComponent(url)}`,
  url => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
];
let proxyIndex = 0;

function openApp(url, name, mode) {
  currentAppUrl = url;
  document.getElementById('appsListView').style.display = 'none';
  document.getElementById('appViewer').style.display = 'flex';
  document.getElementById('appViewerName').textContent = name;
  document.getElementById('appBlockedMsg').style.display = 'none';
  const frame = document.getElementById('appFrame');
  frame.style.display = 'block';
  if (mode === 'routed') {
    // Open blocked sites via Equinox unblocker
    frame.src = UNBLOCKER_URL;
    // After Equinox loads, user can navigate to the site inside it
    // Show a helpful tip
    setTimeout(() => {
      document.getElementById('appViewerName').textContent = name + ' â€” search it inside Equinox â†‘';
    }, 1500);
  } else {
    // Load direct
    frame.src = url;
  }
}

function loadInFrame(url) {
  document.getElementById('appFrame').src = url;
}

function tryNextProxy() {
  showAppBlocked();
}

function showAppBlocked() {
  document.getElementById('appFrame').style.display = 'none';
  document.getElementById('appBlockedMsg').style.display = 'flex';
}

function closeAppViewer() {
  const frame = document.getElementById('appFrame');
  clearTimeout(frame._timer);
  frame.src = 'about:blank';
  document.getElementById('appViewer').style.display = 'none';
  document.getElementById('appsListView').style.display = 'flex';
  document.getElementById('appBlockedMsg').style.display = 'none';
  frame.style.display = 'block';
}

function openCurrentAppNewTab() {
  window.open(currentAppUrl, '_blank');
}

document.getElementById('appsGrid').innerHTML = apps.map(a=>`
  <div class="app-card${a.tag==='unblock'?' featured':''}" onclick="openApp('${a.url}','${a.icon} ${a.name}','${a.mode}')">
    <div class="app-icon">${a.icon}</div>
    <div class="app-name">${a.name}</div>
    <div class="app-desc">${a.desc}</div>
    <span class="app-tag ${a.tag}">${
      a.tag==='unblock'?'âš¡ UNBLOCKER':
      a.tag==='blocked'?'ğŸ”“ VIA PROXY':
      'âœ… FREE'
    }</span>
  </div>`).join('');

// Focus the hidden input immediately
window.addEventListener('load', () => {
  document.getElementById('coverPass').focus();
  initSplash();
  initMatrix();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SPLASH SCREEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initSplash() {
  const bar = document.getElementById('splashBar');
  const splash = document.getElementById('splashScreen');
  let w = 0;
  const msgs = ['INITIALIZING...','LOADING GAMES...','STARTING MUSIC...','UNLOCKING...','READY'];
  let mi = 0;
  const verEl = splash.querySelector('.splash-ver');
  const iv = setInterval(() => {
    w += Math.random() * 18 + 6;
    if (w >= 100) { w = 100; clearInterval(iv); }
    bar.style.width = w + '%';
    if (w > mi * 20 && mi < msgs.length) {
      verEl.textContent = msgs[mi++];
    }
  }, 120);
  setTimeout(() => {
    splash.style.opacity = '0';
    setTimeout(() => splash.style.display = 'none', 500);
  }, 1800);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MATRIX RAIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initMatrix() {
  const canvas = document.getElementById('matrixCanvas');
  const ctx = canvas.getContext('2d');
  function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
  resize();
  window.addEventListener('resize', resize);
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()ï¾Šï¾‹ï½¼ï¾‚ï½³ï½¦ï¾…ï¾ï¾ï¾‘ï¾’ï½µï¾ï¾ï½±ï½»ï¾ï¾Šï½»ï½®ï½±ï½½ï¾’ï½´ï½¶ï½·ï½¸ï½¹ï½º';
  const fontSize = 13;
  let cols = Math.floor(canvas.width / fontSize);
  let drops = Array(cols).fill(1);
  const accent = getComputedStyle(document.documentElement).getPropertyValue('--g').trim() || '#00ff88';
  setInterval(() => {
    ctx.fillStyle = 'rgba(6,9,16,0.05)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = accent;
    ctx.font = fontSize + 'px Share Tech Mono, monospace';
    cols = Math.floor(canvas.width / fontSize);
    if (drops.length !== cols) drops = Array(cols).fill(1);
    for (let i = 0; i < drops.length; i++) {
      const char = chars[Math.floor(Math.random() * chars.length)];
      ctx.globalAlpha = Math.random() * 0.5 + 0.3;
      ctx.fillText(char, i * fontSize, drops[i] * fontSize);
      ctx.globalAlpha = 1;
      if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
      drops[i]++;
    }
  }, 50);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NEON LOADER BAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showLoader() {
  const bar = document.getElementById('neonLoader');
  bar.style.transition = 'none';
  bar.style.opacity = '1';
  bar.style.width = '0%';
  bar.offsetHeight;
  bar.style.transition = 'width 0.4s ease';
  bar.style.width = '70%';
  setTimeout(() => {
    bar.style.width = '100%';
    setTimeout(() => { bar.classList.add('done'); setTimeout(() => { bar.classList.remove('done'); bar.style.width='0%'; }, 500); }, 300);
  }, 400);
}

// Override switchPage to show loader
const _origSwitchPage = switchPage;
function switchPage(id, btn) {
  showLoader();
  setTimeout(() => _origSwitchPage(id, btn), 80);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST NOTIFICATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showToast(title, msg, color='var(--g)') {
  const container = document.getElementById('toastContainer');
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.style.borderColor = color;
  toast.style.boxShadow = `0 0 20px ${color}40`;
  toast.innerHTML = `<div class="toast-title" style="color:${color}">${title}</div>${msg}`;
  container.appendChild(toast);
  toast.addEventListener('click', () => toast.remove());
  setTimeout(() => { try { toast.remove(); } catch(e){} }, 4200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREWORKS / CONFETTI ON UNLOCK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function spawnFireworks() {
  const canvas = document.createElement('canvas');
  canvas.style.cssText = 'position:fixed;inset:0;z-index:99994;pointer-events:none;';
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  document.body.appendChild(canvas);
  const ctx = canvas.getContext('2d');
  const particles = [];
  const colors = ['#00ff88','#00cfff','#ff00aa','#ffcc00','#ff6600','#a855f7'];

  function spawnBurst(x, y) {
    for (let i = 0; i < 60; i++) {
      const angle = (Math.PI * 2 / 60) * i;
      const speed = Math.random() * 6 + 2;
      particles.push({
        x, y,
        vx: Math.cos(angle) * speed,
        vy: Math.sin(angle) * speed - Math.random() * 3,
        color: colors[Math.floor(Math.random() * colors.length)],
        alpha: 1,
        size: Math.random() * 4 + 2,
        gravity: 0.12,
      });
    }
  }

  // Spawn 5 bursts
  const bursts = [
    [window.innerWidth*0.3, window.innerHeight*0.4],
    [window.innerWidth*0.7, window.innerHeight*0.35],
    [window.innerWidth*0.5, window.innerHeight*0.5],
    [window.innerWidth*0.2, window.innerHeight*0.6],
    [window.innerWidth*0.8, window.innerHeight*0.55],
  ];
  let bi = 0;
  const burstIv = setInterval(() => {
    if (bi < bursts.length) { spawnBurst(...bursts[bi++]); }
    else clearInterval(burstIv);
  }, 220);

  let frame = 0;
  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach((p, i) => {
      p.x += p.vx; p.y += p.vy; p.vy += p.gravity;
      p.alpha -= 0.018; p.vx *= 0.99;
      ctx.globalAlpha = Math.max(0, p.alpha);
      ctx.fillStyle = p.color;
      ctx.shadowColor = p.color;
      ctx.shadowBlur = 6;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
      ctx.fill();
    });
    ctx.globalAlpha = 1; ctx.shadowBlur = 0;
    for (let i = particles.length-1; i >= 0; i--) {
      if (particles[i].alpha <= 0) particles.splice(i, 1);
    }
    frame++;
    if (frame < 180) requestAnimationFrame(animate);
    else canvas.remove();
  }
  animate();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PANIC BUTTON
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let panicMode = 'blank';
let panicActive = false;

function setPanic(mode) {
  panicMode = mode;
  localStorage.setItem('nx_panic', mode);
  document.querySelectorAll('.panic-opt').forEach(b => {
    b.style.background = 'none';
    b.style.borderColor = 'rgba(255,0,170,.15)';
    b.style.color = '#556677';
  });
  const el = document.getElementById('panic-' + mode);
  if (el) { el.style.background = 'rgba(255,0,170,.08)'; el.style.borderColor = 'rgba(255,0,170,.3)'; el.style.color = 'var(--p)'; }
}

function triggerPanic() {
  panicActive = true;
  const overlay = document.getElementById('panicOverlay');
  overlay.style.display = 'block';
  if (panicMode === 'classroom') {
    overlay.innerHTML = `<div style="background:#1967d2;color:#fff;padding:14px 24px;font-size:18px;font-weight:500;display:flex;align-items:center;gap:12px;"><div style="width:32px;height:32px;background:#fff;border-radius:4px;display:flex;align-items:center;justify-content:center;color:#1967d2;font-weight:700;font-size:16px;">G</div>Google Classroom</div><div style="background:#f8f9fa;min-height:calc(100vh - 52px);padding:30px 40px;"><div style="max-width:800px;"><div style="color:#202124;font-size:22px;font-weight:400;margin-bottom:20px;">Welcome back</div><div style="background:#fff;border:1px solid #e0e0e0;border-radius:8px;padding:20px;margin-bottom:14px;"><div style="color:#3c4043;font-size:14px;margin-bottom:8px;">ğŸ“š Period 3 â€” English Literature</div><div style="color:#80868b;font-size:12px;">Essay due tomorrow</div></div><div style="background:#fff;border:1px solid #e0e0e0;border-radius:8px;padding:20px;"><div style="color:#3c4043;font-size:14px;margin-bottom:8px;">ğŸ“ Period 5 â€” Algebra II</div><div style="color:#80868b;font-size:12px;">No upcoming work</div></div></div></div>`;
  } else if (panicMode === 'docs') {
    overlay.innerHTML = `<div style="border-bottom:1px solid #e0e0e0;padding:8px 16px;display:flex;align-items:center;gap:12px;background:#fff;"><div style="width:30px;height:30px;background:#4285f4;border-radius:4px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;">D</div><div><div style="color:#202124;font-size:14px;">My Essay Draft</div><div style="color:#80868b;font-size:11px;">Google Docs</div></div></div><div style="background:#fff;padding:60px 200px;min-height:100vh;"><div style="color:#202124;font-size:24px;font-weight:400;margin-bottom:20px;border-bottom:1px solid #e0e0e0;padding-bottom:10px;">My Essay Draft</div><div style="color:#3c4043;font-size:14px;line-height:2;">The topic of this essay explores the fundamental aspects of human nature and how modern society shapes individual identity. Throughout history, philosophers have debated the core question of what defines a person beyond their circumstances...</div></div>`;
  } else if (panicMode === 'search') {
    overlay.innerHTML = `<div style="background:#fff;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding-top:120px;"><img src="https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png" style="width:272px;margin-bottom:30px;"><div style="display:flex;gap:10px;"><div style="border:1px solid #dfe1e5;border-radius:24px;padding:12px 20px;width:500px;display:flex;align-items:center;gap:10px;box-shadow:0 1px 6px rgba(32,33,36,.28);"><span style="color:#9aa0a6;">ğŸ”</span><span style="color:#3c4043;font-size:14px;">how to write a good essay introduction</span></div></div><div style="margin-top:20px;color:#70757a;font-size:13px;">About 2,340,000,000 results</div></div>`;
  } else {
    overlay.innerHTML = '';
    overlay.style.background = '#fff';
  }
  // Press any key or click to dismiss
  const dismiss = (e) => {
    if (e.key === 'Escape' || e.type === 'click') {
      overlay.style.display = 'none';
      panicActive = false;
      document.removeEventListener('keydown', dismiss);
      overlay.removeEventListener('click', dismiss);
    }
  };
  setTimeout(() => {
    document.addEventListener('keydown', dismiss);
    overlay.addEventListener('click', dismiss);
  }, 100);
}

// ESC key triggers panic
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && !panicActive && document.getElementById('cover').style.display === 'none') {
    triggerPanic();
  }
});

// Load saved panic mode
(function() {
  const saved = localStorage.getItem('nx_panic');
  if (saved) setPanic(saved);
  else setPanic('blank');
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WALLPAPER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setWallpaper(url) {
  const app = document.getElementById('app');
  if (!url || url === 'none') {
    app.style.backgroundImage = '';
    app.style.backgroundSize = '';
    document.body.style.backgroundImage = '';
    localStorage.removeItem('nx_wallpaper');
  } else {
    const bg = `url('${url}')`;
    document.body.style.backgroundImage = bg;
    document.body.style.backgroundSize = 'cover';
    document.body.style.backgroundPosition = 'center';
    document.body.style.backgroundAttachment = 'fixed';
    localStorage.setItem('nx_wallpaper', url);
  }
}

// Load saved wallpaper
(function() {
  const saved = localStorage.getItem('nx_wallpaper');
  if (saved) setWallpaper(saved);
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WEATHER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchWeather() {
  const city = document.getElementById('weatherCity').value.trim();
  if (!city) return;
  const resultEl = document.getElementById('weatherResult');
  resultEl.textContent = 'Fetching weather...';
  try {
    // Use open-meteo geocoding + weather (totally free, no key)
    const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1&language=en&format=json`);
    const geoData = await geoRes.json();
    if (!geoData.results?.length) { resultEl.textContent = 'City not found.'; return; }
    const { latitude, longitude, name, country } = geoData.results[0];
    const wxRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,weathercode,windspeed_10m&temperature_unit=fahrenheit&windspeed_unit=mph`);
    const wxData = await wxRes.json();
    const temp = Math.round(wxData.current.temperature_2m);
    const wind = Math.round(wxData.current.windspeed_10m);
    const code = wxData.current.weathercode;
    const icon = code <= 1 ? 'â˜€ï¸' : code <= 3 ? 'â›…' : code <= 48 ? 'ğŸŒ«ï¸' : code <= 67 ? 'ğŸŒ§ï¸' : code <= 77 ? 'â„ï¸' : code <= 82 ? 'ğŸŒ¦ï¸' : 'â›ˆï¸';
    const desc = code === 0 ? 'Clear' : code <= 1 ? 'Mostly Clear' : code <= 3 ? 'Partly Cloudy' : code <= 48 ? 'Foggy' : code <= 55 ? 'Drizzle' : code <= 67 ? 'Rain' : code <= 77 ? 'Snow' : code <= 82 ? 'Showers' : 'Thunderstorm';
    const display = `${icon} ${name}, ${country} Â· ${temp}Â°F Â· ${desc} Â· Wind ${wind}mph`;
    resultEl.innerHTML = `<span style="color:var(--b)">${display}</span>`;
    // Update topbar badge
    const badge = document.getElementById('weatherBadge');
    badge.style.display = 'block';
    badge.textContent = `${icon} ${temp}Â°F ${name}`;
    localStorage.setItem('nx_weather_city', city);
  } catch(e) {
    resultEl.textContent = 'Weather fetch failed. Try again.';
  }
}

// Auto-load last weather city
(function() {
  const saved = localStorage.getItem('nx_weather_city');
  if (saved) {
    document.getElementById('weatherCity').value = saved;
    fetchWeather();
  }
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SECRET CHAT (uses public peerjs + localStorage sync trick)
// Real-time via free Firebase Realtime DB public demo
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let chatRoom = null;
let chatName = 'Anonymous';
let chatPollTimer = null;
const CHAT_BASE = 'https://nexus-chat-default-rtdb.firebaseio.com';

// Use a free public Firebase demo â€” messages auto-delete after 1hr
async function joinRoom() {
  const code = document.getElementById('roomCodeInput').value.trim().toLowerCase().replace(/[^a-z0-9]/g,'');
  const name = document.getElementById('chatNameInput').value.trim() || 'Anon';
  if (!code) return;
  chatRoom = code;
  chatName = name;
  document.getElementById('chatRoomName').textContent = `Room: #${code} â€” logged in as ${name}`;
  localStorage.setItem('nx_chat_name', name);
  clearInterval(chatPollTimer);
  loadMessages();
  chatPollTimer = setInterval(loadMessages, 2000); // poll every 2s
}

let lastMsgCount = 0;
async function loadMessages() {
  if (!chatRoom) return;
  try {
    const r = await fetch(`${CHAT_BASE}/rooms/${chatRoom}/messages.json?orderBy="time"&limitToLast=50`);
    const data = await r.json();
    if (!data) return;
    const msgs = Object.values(data).sort((a,b) => a.time - b.time);
    // Notify on new messages from others
    if (lastMsgCount > 0 && msgs.length > lastMsgCount) {
      const newMsgs = msgs.slice(lastMsgCount);
      newMsgs.forEach(m => {
        if (m.name !== chatName) showToast('ğŸ’¬ ' + m.name, m.text.slice(0,60), 'var(--p)');
      });
    }
    lastMsgCount = msgs.length;
    const log = document.getElementById('chatLog');
    const wasAtBottom = log.scrollTop + log.clientHeight >= log.scrollHeight - 20;
    log.innerHTML = msgs.map(m => `
      <div style="display:flex;flex-direction:${m.name===chatName?'row-reverse':'row'};gap:8px;align-items:flex-end;">
        <div style="font-size:.6rem;color:#334455;flex-shrink:0;">${m.name}</div>
        <div style="max-width:65%;padding:9px 13px;border-radius:6px;font-size:.72rem;line-height:1.6;letter-spacing:.4px;background:${m.name===chatName?'rgba(0,255,136,.08)':'rgba(255,0,170,.06)'};border:1px solid ${m.name===chatName?'rgba(0,255,136,.15)':'rgba(255,0,170,.12)'};color:${m.name===chatName?'#c0ddc0':'#c0c8dd'};">${escapeHtml(m.text)}</div>
      </div>`).join('');
    if (wasAtBottom) log.scrollTop = log.scrollHeight;
  } catch(e) {}
}

async function sendChatMsg() {
  if (!chatRoom) { alert('Join a room first!'); return; }
  const input = document.getElementById('chatMsgInput');
  const text = input.value.trim();
  if (!text) return;
  input.value = '';
  try {
    await fetch(`${CHAT_BASE}/rooms/${chatRoom}/messages.json`, {
      method: 'POST',
      body: JSON.stringify({ name: chatName, text, time: Date.now() })
    });
    loadMessages();
    // Auto-clean old messages after 100 in room
    cleanOldMessages();
  } catch(e) {}
}

async function cleanOldMessages() {
  try {
    const r = await fetch(`${CHAT_BASE}/rooms/${chatRoom}/messages.json?orderBy="time"&limitToLast=200`);
    const data = await r.json();
    if (!data) return;
    const keys = Object.keys(data);
    if (keys.length > 80) {
      // Delete oldest 30
      const toDelete = keys.slice(0, 30);
      for (const k of toDelete) {
        await fetch(`${CHAT_BASE}/rooms/${chatRoom}/messages/${k}.json`, { method: 'DELETE' });
      }
    }
  } catch(e) {}
}

function escapeHtml(str) {
  return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// Restore chat name
(function() {
  const saved = localStorage.getItem('nx_chat_name');
  if (saved) document.getElementById('chatNameInput').value = saved;
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentCover = 'loading';

// Load saved settings
(function() {
  const savedPass = localStorage.getItem('nx_pass');
  if (savedPass) currentPassword = savedPass;
  const savedUnblocker = localStorage.getItem('nx_unblocker');
  if (savedUnblocker) {
    UNBLOCKER_URL = savedUnblocker;
    document.getElementById('settingUnblocker').value = savedUnblocker;
    // Update the app card
    const app = apps.find(a => a.tag === 'unblock');
    if (app) app.url = savedUnblocker;
  }
  const savedCover = localStorage.getItem('nx_cover');
  if (savedCover) { currentCover = savedCover; applyCoverStyle(savedCover); }
  const savedTheme = localStorage.getItem('nx_theme');
  if (savedTheme) {
    const [g, b] = JSON.parse(savedTheme);
    applyTheme(g, b);
  }
})();

function saveUnblocker() {
  const val = document.getElementById('settingUnblocker').value.trim();
  const pass = document.getElementById('unblockerPassInput').value;
  const okEl = document.getElementById('unblockerSaved');
  const errEl = document.getElementById('unblockerError');
  okEl.style.display = 'none';
  errEl.style.display = 'none';
  if (!val) return;
  if (pass !== currentPassword) {
    errEl.style.display = 'block';
    document.getElementById('unblockerPassInput').value = '';
    setTimeout(() => errEl.style.display = 'none', 3000);
    return;
  }
  UNBLOCKER_URL = val;
  localStorage.setItem('nx_unblocker', val);
  const app = apps.find(a => a.tag === 'unblock');
  if (app) app.url = val;
  document.getElementById('unblockerPassInput').value = '';
  okEl.style.display = 'block';
  setTimeout(() => okEl.style.display = 'none', 2000);
}

function savePassword() {
  const oldP = document.getElementById('settingPassOld').value;
  const newP = document.getElementById('settingPassNew').value.trim();
  const errEl = document.getElementById('passError');
  const okEl = document.getElementById('passSaved');
  errEl.style.display = 'none'; okEl.style.display = 'none';
  if (oldP !== currentPassword) { errEl.style.display = 'block'; return; }
  if (!newP) return;
  currentPassword = newP;
  localStorage.setItem('nx_pass', newP);
  okEl.style.display = 'block';
  document.getElementById('settingPassOld').value = '';
  document.getElementById('settingPassNew').value = '';
  setTimeout(() => okEl.style.display = 'none', 2000);
}

function setTheme(g, b) {
  applyTheme(g, b);
  localStorage.setItem('nx_theme', JSON.stringify([g, b]));
  const el = document.getElementById('themeSaved');
  el.style.display = 'block';
  setTimeout(() => el.style.display = 'none', 2000);
}

function applyTheme(g, b) {
  document.documentElement.style.setProperty('--g', g);
  document.documentElement.style.setProperty('--b', b);
}

function setCover(type) {
  currentCover = type;
  localStorage.setItem('nx_cover', type);
  document.querySelectorAll('.cover-opt').forEach(el => {
    el.style.background = 'none';
    el.style.borderColor = 'rgba(255,0,170,.15)';
    el.style.color = '#556677';
  });
  const active = document.getElementById('cover-' + type);
  if (active) {
    active.style.background = 'rgba(255,0,170,.08)';
    active.style.borderColor = 'rgba(255,0,170,.3)';
    active.style.color = 'var(--p)';
  }
}

function applyCoverStyle(type) {
  const cover = document.getElementById('cover');
  if (type === 'classroom') {
    cover.style.background = '#fff';
    cover.innerHTML = `
      <div style="width:100%;max-width:800px;padding:20px;">
        <div style="background:#1967d2;color:#fff;padding:16px 24px;border-radius:8px 8px 0 0;font-family:Arial,sans-serif;font-size:18px;font-weight:500;">Google Classroom</div>
        <div style="background:#f8f9fa;border:1px solid #e0e0e0;border-top:none;padding:40px 24px;border-radius:0 0 8px 8px;font-family:Arial,sans-serif;">
          <div style="color:#3c4043;font-size:14px;margin-bottom:20px;">To-do</div>
          <div style="background:#fff;border:1px solid #e0e0e0;border-radius:4px;padding:16px;margin-bottom:12px;color:#5f6368;font-size:13px;">No work due soon</div>
          <div style="display:flex;align-items:center;gap:10px;margin-top:20px;"><div style="width:18px;height:18px;border:2px solid #dadce0;border-top-color:#1967d2;border-radius:50%;animation:cspin .9s linear infinite;"></div><span style="color:#5f6368;font-size:13px;">Loading assignments...</span></div>
        </div>
      </div>
      <input id="coverPass" type="password" autocomplete="off" style="position:absolute;opacity:0;pointer-events:none;width:1px;height:1px;">`;
  } else if (type === 'docs') {
    cover.style.background = '#fff';
    cover.innerHTML = `
      <div style="width:100%;max-width:900px;font-family:Arial,sans-serif;">
        <div style="background:#fff;border-bottom:1px solid #e0e0e0;padding:8px 16px;display:flex;align-items:center;gap:12px;">
          <div style="width:28px;height:28px;background:#4285f4;border-radius:2px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:14px;">D</div>
          <div style="color:#3c4043;font-size:16px;">Untitled document</div>
        </div>
        <div style="padding:60px 120px;min-height:400px;background:#fff;">
          <div style="width:100%;height:12px;background:#f1f3f4;border-radius:4px;margin-bottom:12px;"></div>
          <div style="width:80%;height:12px;background:#f1f3f4;border-radius:4px;margin-bottom:12px;"></div>
          <div style="width:90%;height:12px;background:#f1f3f4;border-radius:4px;margin-bottom:24px;"></div>
          <div style="display:flex;gap:8px;align-items:center;"><div style="width:16px;height:16px;border:2px solid #dadce0;border-top-color:#4285f4;border-radius:50%;animation:cspin .9s linear infinite;"></div><span style="color:#80868b;font-size:12px;">Loading...</span></div>
        </div>
      </div>
      <input id="coverPass" type="password" autocomplete="off" style="position:absolute;opacity:0;pointer-events:none;width:1px;height:1px;">`;
  } else if (type === 'blank') {
    cover.style.background = '#fff';
    cover.innerHTML = `<input id="coverPass" type="password" autocomplete="off" style="position:absolute;opacity:0;pointer-events:none;width:1px;height:1px;">`;
  } else {
    // default loading spinner
    cover.style.background = '#f1f3f4';
    cover.innerHTML = `
      <div class="cover-spinner"></div>
      <div class="cover-text">Loading resources...</div>
      <input id="coverPass" type="password" autocomplete="off" style="position:absolute;opacity:0;pointer-events:none;width:1px;height:1px;">`;
  }
  // Re-attach password listener after rebuilding cover HTML
  const inp = document.getElementById('coverPass');
  if (inp) {
    inp.addEventListener('input', function() {
      if (this.value === currentPassword) unlock();
    });
  }
}


</script>
</body>
</html>
